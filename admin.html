<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª–µ–π</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .admin-container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    .section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: #f9f9f9;
    }
    .section h2 {
      color: #555;
      margin-top: 0;
    }
    .form-group {
      margin: 15px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="password"], input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 3px;
      font-size: 16px;
    }
    button {
      background: #dc3545;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #c82333;
    }
    button.secondary {
      background: #6c757d;
    }
    button.secondary:hover {
      background: #545b62;
    }
    .alert {
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
      display: none;
    }
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .alert-danger {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .alert-warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .current-password {
      background: #e9ecef;
      padding: 10px;
      border-radius: 3px;
      font-family: monospace;
      margin: 10px 0;
    }
    .logout-info {
      background: #d1ecf1;
      color: #0c5460;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
    }
    
    .password-list {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 15px;
      margin: 15px 0;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .password-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
    }
    
    .password-item:last-child {
      border-bottom: none;
    }
    
    .password-item .login {
      font-weight: bold;
      color: #495057;
    }
    
    .password-item .password {
      color: #dc3545;
      font-weight: bold;
    }
    
    .password-item .copy-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .password-item .copy-btn:hover {
      background: #218838;
    }
    
    .password-item .delete-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      margin-left: 5px;
    }
    
    .password-item .delete-btn:hover {
      background: #c82333;
    }
    
    .password-item .delete-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h1>üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è–º–∏</h1>
    
    <div class="alert alert-success" id="successAlert"></div>
    <div class="alert alert-danger" id="errorAlert"></div>
    <div class="alert alert-warning" id="warningAlert"></div>

    <div class="section">
      <h2>üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h2>
      <div class="logout-info">
        <strong>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</strong>
        <div class="current-password" id="currentPassword">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <p><strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω—ã –∏ –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º.</p>
      </div>
    </div>

    <div class="section">
      <h2>üîë –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h2>
      <form id="passwordForm">
        <div class="form-group">
          <label for="currentPass">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å (–¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è):</label>
          <input type="password" id="currentPass" required>
        </div>
        <div class="form-group">
          <label for="newPass">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
          <input type="password" id="newPass" required minlength="6">
        </div>
        <div class="form-group">
          <label for="confirmPass">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
          <input type="password" id="confirmPass" required minlength="6">
        </div>
        <button type="submit">üîÑ –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å –≤—Å–µ—Ö</button>
      </form>
    </div>

    <div class="section">
      <h2>üö™ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
      <p>–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è. –û–Ω–∏ —Å–º–æ–≥—É—Ç –≤–æ–π—Ç–∏ —Å —Ç–µ–∫—É—â–∏–º –ø–∞—Ä–æ–ª–µ–º.</p>
      <button onclick="forceLogoutAll()" class="secondary">üö™ –†–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
    </div>

    <div class="section">
      <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
      <div id="userManagement">
        <div class="form-group">
          <label for="newUserName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
          <input type="text" id="newUserName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Æ–ª–∏—è, –†—É—Å–ª–∞–Ω, –û–ª—å–≥–∞" onkeypress="handleEnterKey(event)">
        </div>
        <button onclick="addNewUser()" class="secondary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <button onclick="regenerateAllPasswords()" class="secondary">üîÑ –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏</button>
        <button onclick="resetToDefault()" class="secondary">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º</button>
      </div>
    </div>

    <div class="section">
      <h2>üìã –°–ø–∏—Å–æ–∫ –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</h2>
      <div id="passwordsList">
        <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º:</p>
        <div class="password-list" id="passwordList"></div>
        <button onclick="copyAllPasswords()" class="secondary">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏</button>
      </div>
    </div>

    <div class="section">
      <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
      <div id="stats">
        <p><strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π:</strong> <span id="activeSessions">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p><strong>–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è:</strong> <span id="lastPasswordChange">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p><strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥:</strong> <span id="lastForceLogout">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
      </div>
    </div>

    <div class="section">
      <h2>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
      <button onclick="refreshStats()" class="secondary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
      <button onclick="goToCalculator()" class="secondary">üìä –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É</button>
      <button onclick="logoutAdmin()" class="secondary">üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</button>
    </div>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const ADMIN_CONFIG = {
      currentPassword: 'admin123', // –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
      storageKey: 'calculator_auth',
      passwordHistoryKey: 'password_history',
      sessionKey: 'active_sessions'
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
      if (!checkAdminAuth()) {
        showLoginForm();
        return;
      }
      
      loadCurrentPassword();
      loadStats();
      loadPasswordsList();
    });

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∞–¥–º–∏–Ω–∞
    function checkAdminAuth() {
      const currentUser = localStorage.getItem('houseCalcUser');
      return currentUser === 'admin';
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞
    function showLoginForm() {
      document.body.innerHTML = `
        <div class="admin-container">
          <h1>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
          <div class="alert alert-warning" style="display: block;">
            ‚ö†Ô∏è –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
          </div>
          <div class="section">
            <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <form id="adminLoginForm">
              <div class="form-group">
                <label for="adminLogin">–õ–æ–≥–∏–Ω:</label>
                <input type="text" id="adminLogin" value="admin" readonly>
              </div>
              <div class="form-group">
                <label for="adminPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" required>
              </div>
              <button type="submit">–í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
            </form>
            <p style="margin-top: 20px;">
              <a href="index.html" class="admin-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É</a>
            </p>
          </div>
        </div>
      `;
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
      document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const password = document.getElementById('adminPassword').value;
        
        if (password === 'NewAdmPassword123!') {
          localStorage.setItem('houseCalcUser', 'admin');
          location.reload();
        } else {
          alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
        }
      });
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
    function loadCurrentPassword() {
      const password = localStorage.getItem('admin_password') || ADMIN_CONFIG.currentPassword;
      document.getElementById('currentPassword').textContent = password;
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    function loadStats() {
      const activeSessions = getActiveSessions();
      const passwordHistory = getPasswordHistory();
      
      document.getElementById('activeSessions').textContent = activeSessions.length;
      
      if (passwordHistory.length > 0) {
        const lastChange = passwordHistory[passwordHistory.length - 1];
        document.getElementById('lastPasswordChange').textContent = 
          new Date(lastChange.timestamp).toLocaleString('ru-RU');
      } else {
        document.getElementById('lastPasswordChange').textContent = '–ù–∏–∫–æ–≥–¥–∞';
      }
      
      const lastForceLogout = localStorage.getItem('last_force_logout');
      if (lastForceLogout) {
        document.getElementById('lastForceLogout').textContent = 
          new Date(lastForceLogout).toLocaleString('ru-RU');
      } else {
        document.getElementById('lastForceLogout').textContent = '–ù–∏–∫–æ–≥–¥–∞';
      }
    }

    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
    function getActiveSessions() {
      const sessions = localStorage.getItem(ADMIN_CONFIG.sessionKey);
      return sessions ? JSON.parse(sessions) : [];
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
    function saveActiveSessions(sessions) {
      localStorage.setItem(ADMIN_CONFIG.sessionKey, JSON.stringify(sessions));
    }

    // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–∞—Ä–æ–ª–µ–π
    function getPasswordHistory() {
      const history = localStorage.getItem(ADMIN_CONFIG.passwordHistoryKey);
      return history ? JSON.parse(history) : [];
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–∞—Ä–æ–ª–µ–π
    function savePasswordHistory(history) {
      localStorage.setItem(ADMIN_CONFIG.passwordHistoryKey, JSON.stringify(history));
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const currentPass = document.getElementById('currentPass').value;
      const newPass = document.getElementById('newPass').value;
      const confirmPass = document.getElementById('confirmPass').value;
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (currentPass !== ADMIN_CONFIG.currentPassword) {
        showAlert('error', '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å!');
        return;
      }
      
      if (newPass !== confirmPass) {
        showAlert('error', '‚ùå –ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
        return;
      }
      
      if (newPass.length < 6) {
        showAlert('error', '‚ùå –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!');
        return;
      }
      
      if (newPass === currentPass) {
        showAlert('warning', '‚ö†Ô∏è –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ!');
        return;
      }
      
      // –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
      changePassword(newPass);
    });

    // –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
    function changePassword(newPassword) {
      try {
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å
        localStorage.setItem('admin_password', newPassword);
        ADMIN_CONFIG.currentPassword = newPassword;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        const history = getPasswordHistory();
        history.push({
          password: newPassword,
          timestamp: Date.now(),
          action: 'password_change'
        });
        savePasswordHistory(history);
        
        // –†–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        forceLogoutAllUsers();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        loadCurrentPassword();
        loadStats();
        
        showAlert('success', '‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω! –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω—ã.');
        
        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        document.getElementById('passwordForm').reset();
        
      } catch (error) {
        showAlert('error', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è: ' + error.message);
      }
    }

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    function forceLogoutAll() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?')) {
        forceLogoutAllUsers();
        localStorage.setItem('last_force_logout', Date.now());
        loadStats();
        showAlert('success', '‚úÖ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω—ã!');
      }
    }

    // –†–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    function forceLogoutAllUsers() {
      // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å–µ—Å—Å–∏–∏
      const sessions = getActiveSessions();
      sessions.forEach(session => {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        // –ù–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ WebSocket –∏–ª–∏ Server-Sent Events
      });
      
      // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å–µ—Å—Å–∏–∏
      saveActiveSessions([]);
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞
      localStorage.setItem('force_logout', Date.now());
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function refreshStats() {
      loadStats();
      showAlert('success', '‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É
    function goToCalculator() {
      window.location.href = 'index.html';
    }

    // –í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
    function logoutAdmin() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏?')) {
        localStorage.removeItem('houseCalcUser');
        window.location.href = 'index.html';
      }
    }

    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showAlert(type, message) {
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      document.querySelectorAll('.alert').forEach(alert => {
        alert.style.display = 'none';
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      const alert = document.getElementById(type + 'Alert');
      alert.textContent = message;
      alert.style.display = 'block';
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
      setTimeout(() => {
        alert.style.display = 'none';
      }, 5000);
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    function checkForceLogout() {
      const forceLogoutTime = localStorage.getItem('force_logout');
      if (forceLogoutTime) {
        // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥
        localStorage.removeItem('force_logout');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        alert('üîê –í–∞—à–∞ —Å–µ—Å—Å–∏—è –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.');
        
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
        window.location.href = 'index.html';
      }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞—Ä–æ–ª–µ–π
    function loadPasswordsList() {
      const passwordList = document.getElementById('passwordList');
      const passwords = getManagerPasswords();
      
      passwordList.innerHTML = '';
      
      passwords.forEach((user, index) => {
        const item = document.createElement('div');
        item.className = 'password-item';
        const adminBadge = user.isAdmin ? ' <span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px;">–ê–î–ú–ò–ù</span>' : '';
        const deleteBtn = user.isAdmin ? 
          '<button class="delete-btn" disabled title="–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞">üóëÔ∏è</button>' : 
          `<button class="delete-btn" onclick="deleteUser('${user.login}')" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">üóëÔ∏è</button>`;
        
        item.innerHTML = `
          <span class="login">${user.login}${adminBadge}</span>
          <span class="password">${user.password}</span>
          <div>
            <button class="copy-btn" onclick="copyPassword('${user.login}', '${user.password}')">üìã</button>
            ${deleteBtn}
          </div>
        `;
        passwordList.appendChild(item);
      });
    }

    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–æ–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (–∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞)
    function getManagerPasswords() {
      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
      const saved = getSavedPasswords();
      if (saved) {
        return saved;
      }
      
      // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
      const USERS = [
        {login:"admin",     password:"NewAdmPassword123!", isAdmin: true},
        {login:"–Æ–ª–∏—è",      password:"NewYuliaPass456!"},
        {login:"–†—É—Å–ª–∞–Ω",    password:"NewRuslanPass789!"},
        {login:"–û–ª—å–≥–∞",     password:"NewOlgaPass321!"},
        {login:"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞", password:"NewEkaterinaPass654!"},
        {login:"Manager6",  password:"NewManager6Pass987!"},
        {login:"Manager7",  password:"NewManager7Pass135!"},
        {login:"Manager8",  password:"NewManager8Pass246!"},
        {login:"Manager9",  password:"NewManager9Pass369!"},
        {login:"Manager10", password:"NewManager10Pass147!"}
      ];
      
      return USERS;
    }

    // –ö–æ–ø–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
    function copyPassword(login, password) {
      const text = `–õ–æ–≥–∏–Ω: ${login}\n–ü–∞—Ä–æ–ª—å: ${password}`;
      navigator.clipboard.writeText(text).then(() => {
        showAlert('success', `‚úÖ –ü–∞—Ä–æ–ª—å –¥–ª—è ${login} —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!`);
      }).catch(err => {
        showAlert('error', '‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message);
      });
    }

    // –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –ø–∞—Ä–æ–ª–∏
    function copyAllPasswords() {
      const passwords = getManagerPasswords();
      let text = 'üîê –ü–ê–†–û–õ–ò –î–õ–Ø –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê\n';
      text += '='.repeat(30) + '\n\n';
      
      passwords.forEach(user => {
        text += `–õ–æ–≥–∏–Ω: ${user.login}\n`;
        text += `–ü–∞—Ä–æ–ª—å: ${user.password}\n`;
        text += '-'.repeat(20) + '\n';
      });
      
      text += '\nüåê –°—Å—ã–ª–∫–∞: http://localhost:8000\n';
      text += 'üì± –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª index.html –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n\n';
      text += 'üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:\n';
      text += '1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n';
      text += '2. –í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞\n';
      text += '3. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"\n';
      text += '4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä\n\n';
      text += '‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø–∞—Ä–æ–ª–∏ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º!';
      
      navigator.clipboard.writeText(text).then(() => {
        showAlert('success', '‚úÖ –í—Å–µ –ø–∞—Ä–æ–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
      }).catch(err => {
        showAlert('error', '‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message);
      });
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function addNewUser() {
      const userName = document.getElementById('newUserName').value.trim();
      
      if (!userName) {
        showAlert('error', '‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!');
        return;
      }
      
      if (userName === 'admin') {
        showAlert('error', '‚ùå –ò–º—è "admin" –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ!');
        return;
      }
      
      const passwords = getManagerPasswords();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
      if (passwords.some(user => user.login === userName)) {
        showAlert('error', '‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
        return;
      }
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const newPassword = generateRandomPassword();
      const newUser = {
        login: userName,
        password: newPassword
      };
      
      passwords.push(newUser);
      saveNewPasswords(passwords);
      loadPasswordsList();
      
      // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
      document.getElementById('newUserName').value = '';
      
      showAlert('success', `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${userName}" –¥–æ–±–∞–≤–ª–µ–Ω!`);
    }

    // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function deleteUser(login) {
      if (login === 'admin') {
        showAlert('error', '‚ùå –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
        return;
      }
      
      if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${login}"?`)) {
        const passwords = getManagerPasswords();
        const filteredPasswords = passwords.filter(user => user.login !== login);
        
        saveNewPasswords(filteredPasswords);
        loadPasswordsList();
        
        showAlert('success', `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${login}" —É–¥–∞–ª–µ–Ω!`);
      }
    }

    // –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ –ø–∞—Ä–æ–ª–∏
    function regenerateAllPasswords() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏? –≠—Ç–æ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!')) {
        const passwords = getManagerPasswords();
        const newPasswords = passwords.map(user => ({
          ...user,
          password: user.isAdmin ? user.password : generateRandomPassword() // –ê–¥–º–∏–Ω–∞ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
        }));
        
        saveNewPasswords(newPasswords);
        loadPasswordsList();
        forceLogoutAllUsers();
        showAlert('success', '‚úÖ –í—Å–µ –ø–∞—Ä–æ–ª–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã! –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω—ã.');
      }
    }

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    function resetToDefault() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ—Ö —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!')) {
        const defaultUsers = [
          {login:"admin",     password:"NewAdmPassword123!", isAdmin: true},
          {login:"Manager1",  password:"NewManager1Pass123!"},
          {login:"Manager2",  password:"NewManager2Pass456!"},
          {login:"Manager3",  password:"NewManager3Pass789!"},
          {login:"Manager4",  password:"NewManager4Pass012!"},
          {login:"Manager5",  password:"NewManager5Pass345!"}
        ];
        
        saveNewPasswords(defaultUsers);
        loadPasswordsList();
        forceLogoutAllUsers();
        showAlert('success', '‚úÖ –°–±—Ä–æ—à–µ–Ω–æ –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º!');
      }
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
    function generateRandomPasswords() {
      const passwords = [];
      for (let i = 1; i <= 10; i++) {
        const password = generateRandomPassword();
        passwords.push({
          login: `Manager${i}`,
          password: password
        });
      }
      return passwords;
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–¥–∏–Ω —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å
    function generateRandomPassword() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
      let password = '';
      for (let i = 0; i < 12; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return password;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏
    function saveNewPasswords(passwords) {
      localStorage.setItem('manager_passwords', JSON.stringify(passwords));
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
      const history = getPasswordHistory();
      history.push({
        passwords: passwords,
        timestamp: Date.now(),
        action: 'password_generation'
      });
      savePasswordHistory(history);
    }

    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
    function getSavedPasswords() {
      const saved = localStorage.getItem('manager_passwords');
      return saved ? JSON.parse(saved) : null;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
    function handleEnterKey(event) {
      if (event.key === 'Enter') {
        addNewUser();
      }
    }

    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ
    window.checkForceLogout = checkForceLogout;
  </script>
</body>
</html>
