/* === 0. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ===================== */
// –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–Ω–∞—á–∞–ª–∞ –∏–∑ localStorage, –ø–æ—Ç–æ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ)
function getUsers() {
  const saved = localStorage.getItem('manager_passwords');
  if (saved) {
    return JSON.parse(saved);
  }
  
  // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  return [
    {login:"admin",     password:"NewAdmPassword123!", isAdmin: true},
  {login:"–Æ–ª–∏—è",      password:"NewYuliaPass456!"},
  {login:"–†—É—Å–ª–∞–Ω",    password:"NewRuslanPass789!"},
  {login:"–û–ª—å–≥–∞",     password:"NewOlgaPass321!"},
  {login:"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞", password:"NewEkaterinaPass654!"},
  {login:"Manager6",  password:"NewManager6Pass987!"},
  {login:"Manager7",  password:"NewManager7Pass135!"},
  {login:"Manager8",  password:"NewManager8Pass246!"},
  {login:"Manager9",  password:"NewManager9Pass369!"},
  {login:"Manager10", password:"NewManager10Pass147!"}
];
}

const USERS = getUsers();

/* === 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ==================== */
window.authenticate = function authenticate(){
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø–µ—Ä–µ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
  checkForceLogoutOnLoad();
  
  const login    = document.getElementById('login').value.trim();
  const password = document.getElementById('password').value.trim();
  const errBox   = document.getElementById('auth-error');

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞
  const forceLogoutTime = localStorage.getItem('force_logout');
  if (forceLogoutTime) {
    localStorage.removeItem('force_logout');
    alert('üîê –í–∞—à–∞ —Å–µ—Å—Å–∏—è –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.');
    return;
  }

  // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  const users = getUsers();
  const ok = users.some(u=>u.login===login && u.password===password);
  if(!ok){
    errBox.style.display='block';
    return;
  }

  // —É—Å–ø–µ—Ö
  errBox.style.display='none';
  localStorage.setItem('houseCalcUser', login);

  document.getElementById('auth-container').classList.add('hidden');
  document.getElementById('calc-container').classList.remove('hidden');

  // —Ç–≤–æ—è ¬´–ø–µ—Ä–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è¬ª —Ñ–æ—Ä–º—ã
  handleTypeChange();       // —Ä–∞–∑–º–µ—Ä—ã –∏ —Ç.–ø.
};

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function checkForceLogoutOnLoad() {
  const forceLogoutTime = localStorage.getItem('force_logout');
  if (forceLogoutTime) {
    localStorage.removeItem('force_logout');
    localStorage.removeItem('houseCalcUser');
    alert('üîê –í–∞—à–∞ —Å–µ—Å—Å–∏—è –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.');
    document.getElementById('auth-container').classList.remove('hidden');
    document.getElementById('calc-container').classList.add('hidden');
  }
}

/* === 2. –í—ã—Ö–æ–¥ ============================= */
function logout(){
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
  checkForceLogoutOnLoad();
  
  localStorage.removeItem('houseCalcUser');
  location.reload();        // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äì –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
}

/* === 2a. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±—Ä–∏–≥–∞–¥–µ ========= */
function showPileTeamModal() {
  const modal = document.getElementById('pileTeamModal');
  if (modal) {
    modal.classList.add('show');
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        closePileTeamModal();
      }
    });
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
    document.addEventListener('keydown', function escapeHandler(e) {
      if (e.key === 'Escape') {
        closePileTeamModal();
        document.removeEventListener('keydown', escapeHandler);
      }
    });
  }
}

function closePileTeamModal() {
  const modal = document.getElementById('pileTeamModal');
  if (modal) {
    modal.classList.remove('show');
  }
}

// –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ HTML
window.closePileTeamModal = closePileTeamModal;

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ –±—Ä–∏–≥–∞–¥–µ
let screwPileWarningShown = false;
let lastPileType = null; // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–∏–ø —Å–≤–∞–π –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–ª–∞–≥–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–π –±—Ä–∏–≥–∞–¥—ã
function requiresSpecialBrigade(dim, cnt) {
  const isOwnTeamType = (dim === "1.5√ó76" || dim === "2.0√ó76");
  const isOwnTeamCount = (cnt <= 12);
  return !isOwnTeamType || !isOwnTeamCount;
}

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ –±—Ä–∏–≥–∞–¥–µ
function checkScrewPileBrigade(dim, cnt, showWarning = true) {
  if (!showWarning) {
    return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É, –µ—Å–ª–∏ —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–æ
  }
  
  if (!requiresSpecialBrigade(dim, cnt)) {
    screwPileWarningShown = false;
    return;
  }
  
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ —Å–≤–∞–π
  if (lastPileType !== dim) {
    screwPileWarningShown = false;
    lastPileType = dim;
  }
  
  if (!screwPileWarningShown) {
    screwPileWarningShown = true;
    setTimeout(() => {
      showPileTeamModal();
    }, 100);
  }
}

/* === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ –ø—Ä–æ—Ñ–ª–∏—Å—Ç–∞ === */
// –ú–∞—Å—Å–∏–≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –ø—Ä–æ—Ñ–ª–∏—Å—Ç–∞
const PROF_COLORS = [
  { code: 'RAL 8017', name: '–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π', hex: '#4A3728' },
  { code: 'RR 32 / RAL 8019', name: '–¢—ë–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π –±–æ–ª–æ—Ç–Ω—ã–π', hex: '#2F1F14' },
  { code: 'RAL 6005', name: '–ó–µ–ª—ë–Ω—ã–π', hex: '#0F5132' },
  { code: 'RAL 3005', name: '–í–∏—à–Ω—ë–≤—ã–π', hex: '#721C24' },
  { code: 'RAL 7024', name: '–°–µ—Ä—ã–π –≥—Ä–∞—Ñ–∏—Ç', hex: '#474A50' },
  { code: 'RAL 5005', name: '–°–∏–Ω–∏–π', hex: '#0B3C5D' }
];

// –•—Ä–∞–Ω–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç
let selectedProfColor = null;

function openProfColorModal() {
  const modal = document.getElementById('profColorModal');
  if (!modal) return;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
  const modalTitle = document.getElementById('profColorModalTitle');
  const modalText = document.getElementById('profColorModalText');
  
  if (selRoofMat) {
    const materialTitles = {
      'profColor': '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –ø—Ä–æ—Ñ–ª–∏—Å—Ç–∞',
      'ondulin': '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –æ–Ω–¥—É–ª–∏–Ω–∞',
      'tile_lom': '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü—ã',
      'tile_gable': '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü—ã'
    };
    
    const materialNames = {
      'profColor': '—Ü–≤–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ñ–ª–∏—Å—Ç–∞',
      'ondulin': '–æ–Ω–¥—É–ª–∏–Ω–∞',
      'tile_lom': '–º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü—ã (–æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞)',
      'tile_gable': '–º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü—ã (–¥–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞)'
    };
    
    const materialTitle = materialTitles[selRoofMat.value] || '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç';
    const materialName = materialNames[selRoofMat.value] || '–º–∞—Ç–µ—Ä–∏–∞–ª–∞';
    
    if (modalTitle) {
      modalTitle.textContent = materialTitle;
    }
    if (modalText) {
      modalText.textContent = `–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç ${materialName} –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:`;
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ü–≤–µ—Ç–∞, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
  const grid = document.getElementById('profColorGrid');
  if (grid && grid.children.length === 0) {
    PROF_COLORS.forEach((color, index) => {
      const colorItem = document.createElement('div');
      colorItem.className = 'prof-color-item';
      colorItem.dataset.colorIndex = index;
      
      const swatch = document.createElement('div');
      swatch.className = 'prof-color-swatch';
      swatch.style.backgroundColor = color.hex;
      
      const code = document.createElement('div');
      code.className = 'prof-color-code';
      code.textContent = color.code;
      
      const name = document.createElement('div');
      name.className = 'prof-color-name';
      name.textContent = color.name;
      
      colorItem.appendChild(swatch);
      colorItem.appendChild(code);
      colorItem.appendChild(name);
      
      colorItem.addEventListener('click', () => {
        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.querySelectorAll('.prof-color-item').forEach(item => {
          item.classList.remove('selected');
        });
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π
        colorItem.classList.add('selected');
        selectedProfColor = color;
      });
      
      grid.appendChild(colorItem);
    });
  }
  
  // –ï—Å–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω —Ü–≤–µ—Ç —Ä–∞–Ω–µ–µ, –≤—ã–¥–µ–ª—è–µ–º –µ–≥–æ
  if (selectedProfColor) {
    const items = document.querySelectorAll('.prof-color-item');
    items.forEach((item, index) => {
      if (PROF_COLORS[index].code === selectedProfColor.code) {
        item.classList.add('selected');
      }
    });
  }
  
  modal.classList.add('show');
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
  modal.addEventListener('click', function modalClickHandler(e) {
    if (e.target === modal) {
      closeProfColorModal();
      modal.removeEventListener('click', modalClickHandler);
    }
  });
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
  const escapeHandler = function(e) {
    if (e.key === 'Escape') {
      closeProfColorModal();
      document.removeEventListener('keydown', escapeHandler);
    }
  };
  document.addEventListener('keydown', escapeHandler);
}

function closeProfColorModal() {
  const modal = document.getElementById('profColorModal');
  if (modal) {
    modal.classList.remove('show');
  }
  // –ï—Å–ª–∏ —Ü–≤–µ—Ç –Ω–µ –±—ã–ª –≤—ã–±—Ä–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–µ–ª–µ–∫—Ç –∫ –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω–æ–º—É –ø—Ä–æ—Ñ–ª–∏—Å—Ç—É
  if (!selectedProfColor && selRoofMat && selRoofMat.value !== 'galv') {
    selRoofMat.value = 'galv';
    // –ù–µ –≤—ã–∑—ã–≤–∞–µ–º calculate() –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ—Å—á–µ—Ç–æ–≤
  }
}

function confirmProfColor() {
  if (selectedProfColor) {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeProfColorModal();
    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ö–ü —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
    calculate();
  } else {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –ø—Ä–æ—Ñ–ª–∏—Å—Ç–∞');
  }
}

// –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
window.openProfColorModal = openProfColorModal;
window.closeProfColorModal = closeProfColorModal;
window.confirmProfColor = confirmProfColor;

/* === 3. –ê–≤—Ç–æ–≤—Ö–æ–¥ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ ========= */
window.addEventListener('DOMContentLoaded', ()=>{
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥
  checkForceLogoutOnLoad();
  
  if(localStorage.getItem('houseCalcUser')){
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    checkForceLogoutOnLoad();
    
    document.getElementById('auth-container').classList.add('hidden');
    document.getElementById('calc-container').classList.remove('hidden');
    handleTypeChange();
  }
});


/* ------------------------------------------------------------------
   0. –£—Ç–∏–ª–∏—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω —Å —Ç–æ—á–∫–æ–π
------------------------------------------------------------------ */
function formatPrice(n) {
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

/* --- 0a. –ö–æ–º–∏—Å—Å–∏—è –∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ --- */
const COMM = 0.10;                                  // 10%

// –ë—Ä—É—Ç—Ç–æ (—Å –∫–æ–º–∏—Å—Å–∏–µ–π), –¥–ª—è –ª—é–±—ã—Ö —Å—É–º–º/–º¬≤/—à—Ç:
const grossInt = x => Math.round(x * (1 + COMM));

// –ë—Ä—É—Ç—Ç–æ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –≤–≤–µ—Ä—Ö –∫ 50 ‚ÇΩ:
const gross50  = x => Math.ceil((x * (1 + COMM)) / 50) * 50;

/* –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –º–µ—Ç–∫–∏ —Å —Ü–µ–Ω–æ–π –≤ —Å–∫–æ–±–∫–∞—Ö ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å –∫–æ–º–∏—Å—Å–∏–µ–π.
   –ú–µ–Ω—è–µ—Ç –∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ ¬´‚Ä¶ ‚ÇΩ¬ª –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ ¬´‚Ä¶ ‚ÇΩ¬ª —Å –Ω–∞—à–µ–π –Ω–∞—Ü–µ–Ω–∫–æ–π. */
function labelGross(text){
  return text.replace(/(\d[\d\s.]*)\s*‚ÇΩ/g, (_, num) => {
    const n   = parseInt(String(num).replace(/[^\d]/g, ''), 10) || 0;
    const brut= grossInt(n);
    return `${formatPrice(brut)} ‚ÇΩ`;
  });
}

/* --- –≤—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω –∏ –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω -------------------------------- */
function getWallHeight(type, roof, ext = false) {
  // –ø—Ä–∏–±–∞–≤–∫–∞, –≤–≤–µ–¥—ë–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (—Å–º)
  const extraHcm = +inpExtraH.value || 0;
  const addM     = extraHcm / 100;              // –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –º–µ—Ç—Ä—ã

  // –±–∞–∑–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ (–º)
  let h;
  if (type === "house") {
    // —É –Ω–∏–∑–∫–æ–≥–æ —Å–∫–∞—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —á—É—Ç—å –Ω–∏–∂–µ, —Å–Ω–∞—Ä—É–∂–∏ ‚Äì –ø–æ —Å—Ç–æ–π–∫–µ
    h = (roof === "lom")
        ? (ext ? 2.4 : 2.3)   // –Ω–∞—Ä—É–∂–Ω—ã–µ —Å—Ç–µ–Ω—ã 2 ,4 –º, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ 2 ,3 –º
        : 2.4;                // –¥–≤—É—Å–∫–∞—Ç–Ω–∞—è ‚Äì 2 ,4 –º –≤–µ–∑–¥–µ
  } else {
    // –±—ã—Ç–æ–≤–∫–∞ / —Ö–æ–∑–±–ª–æ–∫: –¥–ª—è –¥–≤—É—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–∏ 2.4 –º, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö 2.1 –º
    h = (roof === "gable") ? 2.4 : 2.1;
  }

  return +(h + addM).toFixed(2);  // –∏—Ç–æ–≥–æ–≤–æ–µ —á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä 2.30
}




function wallArea(w, l, h){ return 2 * (w + l) * h; }  // 2*(W+L)*H

/* ------------------------------------------------------------------
   1. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
------------------------------------------------------------------ */
// –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–±–µ–ª–æ–≤ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –û–î–ò–ù —Ä–∞–∑ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
function normalizeSpaces(str) {
  if (!str) return '';
  return String(str)
    // –≤—Å–µ —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã -> –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–±–µ–ª
    .replace(/[\u00A0\u2000-\u200B\u202F\u205F\u3000]/g, ' ')
    // &nbsp; –∏–∑ contenteditable
    .replace(/&nbsp;/g, ' ')
    // –ª—é–±—ã–µ –ø–æ–¥—Ä—è–¥ –ø—Ä–æ–±–µ–ª—ã/—Ç–∞–±—ã/–ø–µ—Ä–µ–Ω–æ—Å—ã -> –æ–¥–∏–Ω –ø—Ä–æ–±–µ–ª
    .replace(/[ \t\r\n]+/g, ' ')
    // —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –ø–µ—Ä–µ–¥ –∑–Ω–∞–∫–∞–º–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è (–Ω–æ –ù–ï –ø–µ—Ä–µ–¥ —Å–∫–æ–±–∫–∞–º–∏)
    .replace(/\s+([:;,.])/g, '$1')
    .trim();
}

function getLabel(opt) {
  let text = opt.text.replace(/\s*\([^)]*‚ÇΩ[^)]*\)/g, "").trim();
  return normalizeSpaces(text);
}

// –ë–∞–∑–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã
const RATE    = { lom:{ base:10450 }, gable:{ base:13750 } };
// –õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ–º–æ–≤ –ø–æ –ø–ª–æ—â–∞–¥–∏ (–≤–∫–ª—é—á–∞—è –≤–µ—Ä–∞–Ω–¥—É)
// 1 –º–∞—à–∏–Ω–∞ = 18–º¬≤, –¥–∞–ª–µ–µ —à–∞–≥–æ–º +18–º¬≤ = +1 –º–∞—à–∏–Ω–∞, +100‚ÇΩ/–∫–º
function getHouseDeliveryRate(totalArea) {
  if (totalArea <= 24) return { vehicles: 1, rate: 180 };
  if (totalArea <= 42) return { vehicles: 2, rate: 200 };
  if (totalArea <= 60) return { vehicles: 3, rate: 300 };
  if (totalArea <= 78) return { vehicles: 4, rate: 400 };
  if (totalArea <= 96) return { vehicles: 5, rate: 500 };
  if (totalArea <= 114) return { vehicles: 6, rate: 600 };
  if (totalArea <= 132) return { vehicles: 7, rate: 700 };
  
  // –î–∞–ª—å—à–µ —à–∞–≥–æ–º +18–º¬≤, +1 –º–∞—à–∏–Ω–∞, +100‚ÇΩ/–∫–º
  const step = Math.floor((totalArea - 132) / 18) + 1;
  return { vehicles: 7 + step, rate: 700 + (step * 100) };
}
const MAX_KM = 250;      // –ª–∏–º–∏—Ç: 250 –∫–º –æ—Ç –ú–ö–ê–î
const DEPOT = [55.621800, 37.441432];   // —Ç–æ—á–∫–∞ –æ—Ç–≥—Ä—É–∑–∫–∏ (–æ–±—ã—á–Ω–∞—è –ª–∏–Ω–µ–π–∫–∞)
const DEPOT_ECONOMY = [55.443806, 37.296654];   // —Ç–æ—á–∫–∞ –æ—Ç–≥—Ä—É–∑–∫–∏ (—ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∞)

// –û–ø—Ü–∏–∏ –ø–æ –ø–ª–æ—â–∞–¥–∏
const INSUL   = { roll100:550, min150:2000, rock100:1000, basalt150:4000 };
const ROOFMAT = { galv:0, ondulin:0, profColor:750, tile_lom:800, tile_gable:1200 };
const VERANDA = { verRoof:7500, verGable:9000 };

function getHoblokBasePrice(w, l){
  const key = `${w}x${l === 2.5 ? 3 : l}`;
  return CONFIG.hoblok.basePrice[key] || 0;   // –ø—Ä–æ—Å—Ç–æ ¬´–≥–æ–ª—ã–π¬ª —Ö–æ–∑–±–ª–æ–∫
}

// –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞
const INREP = {
  osb_vag:120,
  osb_imit:350,
  vag_imitBC:250,
  vag_imitA:400,
  vag_block:1000,
  osb_vagA:500,
  vag_vagA:380,
  osb_block:1120
};
INREP['none'] = 0;  // –±–∞–∑–æ–≤–∞—è –û–°–ë-3
const OSB_PLAIN = 500;   // —Ü–µ–Ω–∞ 1 –º¬≤ –ø—Ä–æ—Å—Ç–æ–π –û–°–ë-3, –º–µ–Ω—è–π—Ç–µ –∑–¥–µ—Å—å
// ------------------------------------------------------------------
// –ü–ª–æ—â–∞–¥—å –û–°–ë –¥–ª—è —Ö–æ–∑–±–ª–æ–∫–∞ (—Å—Ç–µ–Ω—ã + –ø–æ—Ç–æ–ª–æ–∫), –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫ 3 –º¬≤ –≤–≤–µ—Ä—Ö
// ------------------------------------------------------------------
function getOsbArea(w, l) {
  const h = getWallHeight("hoblok", "lom", false);   // —É —Ö–æ–∑–±–ª–æ–∫–∞ –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–æ—Å–∫–∞—Ç
  const walls = wallArea(w, l, h);
  const ceil  = w * l;
  return Math.ceil((walls + ceil) / 3) * 3;          // —à–∞–≥ 3 –º¬≤
}

// –í–Ω–µ—à–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞
const OUTREP = {
  vag_ext:500,
  imitBC_ext:250,
  block_ext:1000,
  osb_extA:500,
  vag_extA:380
};
OUTREP['none'] = 500;  // –±–∞–∑–æ–≤–∞—è –≤–∞–≥–æ–Ω–∫–∞ B‚ÄìC

const FLOOR   = { floor:1000, mouse:400 };
// ‚ñ∂ —Ü–µ–Ω—ã —á–∏—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª–∞ (‚ÇΩ/–º¬≤)
const FLOOR_MAT = {
  plain: 0,
  osb: 500,
  board50x150: 1700,
  planed35x140: 1400
};
const FLOOR_CAPT = {
  plain: "–ü–æ–ª: –û–±—Ä–µ–∑–Ω–∞—è –¥–æ—Å–∫–∞ 25√ó150 –º–º",
  osb:   "–ü–æ–ª: –û–°–ë –≤–ª–∞–≥–æ—Å—Ç–æ–π–∫–∏–π",
  board50x150: "–ü–æ–ª: –®–ø—É–Ω—Ç –¥–æ—Å–∫–∞ —á–∏—Å—Ç–æ–≤–æ–π 50√ó150 –º–º",
  planed35x140: "–ü–æ–ª: –°—Ç—Ä–æ–≥–∞–Ω–∞—è 35√ó140 –º–º"
};
const RAMP = 2000; // –ø–∞–Ω–¥—É—Å

// –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
const PART       = { p1:2500, p2:3200, p3:4000 };
const PART_TITLE = {
  p1: "–°—Ç–µ–Ω–∞ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è",
  p2: "–°—Ç–µ–Ω–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è",
  p3: "–°—Ç–µ–Ω–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å —É—Ç–µ–ø–ª–µ–Ω–∏–µ–º 100 –º–º"
};

// –°–≤–∞–∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ª–∏–Ω–µ–µ–∫ (–ë–ï–ó –Ω–∞—Ü–µ–Ω–∫–∏ 10%)
// –ù–∞—à–∞ –±—Ä–∏–≥–∞–¥–∞: 76/1500 –¥–æ 16 —à—Ç, 76/2000 –¥–æ 9 —à—Ç
// –û—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞: 76/1500 –æ—Ç 17 —à—Ç, 76/2000 –æ—Ç 10 —à—Ç, –≤—Å–µ 89/108
const PILES_STANDARD = {
  "1.5√ó76":3350, // –¥–æ 16 —à—Ç - –Ω–∞—à–∞ –±—Ä–∏–≥–∞–¥–∞, –æ—Ç 17 —à—Ç - –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
  "2.0√ó76":3800, // –¥–æ 9 —à—Ç - –Ω–∞—à–∞ –±—Ä–∏–≥–∞–¥–∞, –æ—Ç 10 —à—Ç - –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
  "2.5√ó76":3800,
  "3.0√ó76":4100,
  "2.0√ó89":3700, // –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
  "2.5√ó89":4000, // –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
  "3.0√ó89":4400, // –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
  "2.0√ó108":4500, // –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
  "2.5√ó108":4900, // –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
  "3.0√ó108":5400  // –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞
};

// –°–≤–∞–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–µ–∫ (—Å 10% –Ω–∞—Ü–µ–Ω–∫–æ–π)
const PILES_ECONOMY = {
  "1.5√ó76":3300, "2.0√ó76":4000, "2.5√ó76":4100, "3.0√ó76":4450,
  "2.0√ó89":4000, "2.5√ó89":4400, "3.0√ó89":4750,
  "2.0√ó108":4800, "2.5√ó108":5200, "3.0√ó108":5500
};
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –õ–û–ì–ò–ö–ê –†–ê–°–ß–ï–¢–ê –°–í–ê–ô –ü–û –†–Ø–î–ê–ú (—Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
const L_MAX = 3.0;  // –ü—Ä–µ–¥–µ–ª—å–Ω—ã–π —à–∞–≥ —Ä—è–¥–æ–≤ –ø–æ –¥–ª–∏–Ω–µ, –º
const W_MAX = 2.0;  // –ü—Ä–µ–¥–µ–ª—å–Ω—ã–π —à–∞–≥ —Å–≤–∞–π –≤ —Ä—è–¥—É –ø–æ —à–∏—Ä–∏–Ω–µ, –º
const EPSILON = 1e-6;  // –ß–∏—Å–ª–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

/**
 * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 305+)
 * 
 * –ö–õ–Æ–ß–ï–í–û–ï –ü–†–ê–í–ò–õ–û: –ù–ò–ö–û–ì–î–ê –Ω–µ –º–µ–Ω—è—Ç—å L –∏ W –º–µ—Å—Ç–∞–º–∏!
 * - L (length) - –¥–ª–∏–Ω–∞, –≤–¥–æ–ª—å –∫–æ—Ç–æ—Ä–æ–π —Å—Ç–∞–≤—è—Ç—Å—è –†–Ø–î–´ —Å–≤–∞–π
 * - W (width) - —à–∏—Ä–∏–Ω–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —Å—á–∏—Ç–∞–µ–º –°–í–ê–ò –í –†–Ø–î–£
 * 
 * –§–æ—Ä–º—É–ª—ã –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:
 * - rows = ceil(L / L_MAX) + 1  (—Ä—è–¥—ã —á–µ—Ä–µ–∑ ‚â§3–º, –Ω–∞ –∫—Ä–∞—è—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
 * - piles_in_row = max(2, ceil(W / W_MAX) + 1)  (—Å–≤–∞–∏ —á–µ—Ä–µ–∑ ‚â§2–º, –º–∏–Ω–∏–º—É–º 2)
 * - total = rows √ó piles_in_row
 * 
 * @param {number} length - –î–ª–∏–Ω–∞ (L) - –≤–¥–æ–ª—å —ç—Ç–æ–π –æ—Å–∏ —Å—Ç–∞–≤—è—Ç—Å—è —Ä—è–¥—ã
 * @param {number} width - –®–∏—Ä–∏–Ω–∞ (W) - –ø–æ —ç—Ç–æ–π –æ—Å–∏ —Å—á–∏—Ç–∞–µ–º —Å–≤–∞–∏ –≤ —Ä—è–¥—É
 * @param {number} verandaWidth - –®–∏—Ä–∏–Ω–∞ –≤–µ—Ä–∞–Ω–¥—ã (–º), 0 –µ—Å–ª–∏ –Ω–µ—Ç
 * @param {boolean} isInsideVeranda - –í–µ—Ä–∞–Ω–¥–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è (–Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∏—Ä–∏–Ω—É)
 * @returns {number} –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π
 */
/**
 * –£—Å—Ç–æ–π—á–∏–≤–æ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö (–∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Å—Ç—Ä–æ–∫–∏ 334-337)
 * –ï—Å–ª–∏ —á–∏—Å–ª–æ –ø–æ—á—Ç–∏ —Ü–µ–ª–æ–µ (|x ‚àí n| ‚â§ Œµ), —Å—á–∏—Ç–∞—Ç—å –µ–≥–æ —Ä–æ–≤–Ω–æ n
 */
function stableCeil(x) {
  const rounded = Math.round(x);
  if (Math.abs(x - rounded) <= EPSILON) {
    return rounded;
  }
  return Math.ceil(x);
}

function calculatePilesByRows(length, width, verandaWidth = 0, isInsideVeranda = false) {
  // –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º max/min! –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–ø—Ä—è–º—É—é –∫–∞–∫ L –∏ W
  const L = length;
  const W = width;
  
  // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –≤–¥–æ–ª—å –¥–ª–∏–Ω—ã L
  // –§–æ—Ä–º—É–ª–∞: rows = ceil(L / L_MAX) + 1
  // –†—è–¥—ã –±—É–¥—É—Ç –Ω–∞ 0, L_MAX, 2*L_MAX, ... –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ L
  const rows = stableCeil(L / L_MAX) + 1;
  
  // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É (—Å –≤–µ—Ä–∞–Ω–¥–æ–π, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è)
  let localWidth = W;
  if (verandaWidth > 0 && !isInsideVeranda) {
    localWidth += verandaWidth;
  }
  
  // 3. –°–≤–∞–∏ –≤ —Ä—è–¥—É –ø–æ —à–∏—Ä–∏–Ω–µ: ceil(W / W_MAX) + 1, –º–∏–Ω–∏–º—É–º 2
  // –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É —Å–≤–∞—è–º–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å ‚â§ W_MAX (2–º)
  const intervals = stableCeil(localWidth / W_MAX);
  const pilesPerRow = Math.max(2, intervals + 1);
  
  // 4. –ò—Ç–æ–≥–æ —Å–≤–∞–π
  const totalPiles = rows * pilesPerRow;
  
  return totalPiles;
}

/**
 * –£–°–¢–ê–†–ï–í–®–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è - –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–æ–π
 * –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ calculatePilesByRows()
 */
function getPileCount(type, w, l) {
  // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º)
  const cfg = CONFIG[type];
  if (cfg && cfg.isEconomy) {
    // –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∞
    const PILE_COUNT_ECONOMY = {
      "2x2":4,  "2x2.5":4, "2x3":4,
      "2x4":6,  "2x5":6,   "2x6":6,
      "3x2":4,  "3x2.5":4, "3x3":9,
      "3x4":9,  "3x5":9,   "3x6":9,
      "2.5x2":4, "2.5x2.5":4, "2.5x3":4,
      "2.5x4":6, "2.5x5":6, "2.5x6":6,
      "2x2.5":4,
      "3x2.5":6, "4x2.5":6, "5x2.5":6, "6x2.5":6
    };
    
    const k1 = `${w}x${l}`;
    const k2 = `${l}x${w}`;
    
    if (PILE_COUNT_ECONOMY[k1] !== undefined) return PILE_COUNT_ECONOMY[k1];
    if (PILE_COUNT_ECONOMY[k2] !== undefined) return PILE_COUNT_ECONOMY[k2];
    return 6; // –¥–µ—Ñ–æ–ª—Ç –¥–ª—è —ç–∫–æ–Ω–æ–º–∞
  }
  
  // –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
  return calculatePilesByRows(l, w, 0, false);
}



// –û–∫–Ω–∞ –ü–í–• / –¥–≤–µ—Ä–∏ –ü–í–• (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–∏–Ω–µ–π–∫–∞)
const WINDOWS = {
  "50√ó50":{1:5500},
  "60√ó90":{1:7500},
  "60√ó120":{1:10000},
  "60√ó180":{1:12000},
  "100√ó100":{1:9000},
  "100√ó120":{1:11000,2:14000},
  "120√ó120":{1:13000},
  "100√ó140":{1:14000},
  "100√ó150":{1:15000},
  "120√ó150":{1:16500},
  "140√ó150":{1:17000},
  "150√ó150":{1:17500},
  "150√ó100":{1:15000},
  "150√ó190":{1:25000},
  "180√ó190":{1:26000},
  "90√ó205 –¥–≤–µ—Ä—å –ü–í–•":{2:32000}
};
const WOOD_PRICES = {
  win: {                // –æ–∫–Ω–∞
    "60√ó90": 2000,
    "80√ó80": 3000,
    "100√ó100": 3500
  },
  door: {               // –¥–≤–µ—Ä–∏
    std:        2000,   // –æ–±—ã—á–Ω–∞—è
    hinge:      2000,   // —Ä–∞—Å–ø–∞—à–Ω–∞—è
    hingeWarm:  3000,    // —Ä–∞—Å–ø–∞—à–Ω–∞—è —É—Ç–µ–ø–ª—ë–Ω–Ω–∞—è
    filen:      6000   
  }
};
const METAL_PRICES = {
  rf:         12000,   // –î–≤–µ—Ä—å –†–§
  rfThermo:   30000,   // –†–§ —Å —Ç–µ—Ä–º–æ—Ä–∞–∑—Ä—ã–≤–æ–º
  thermoLux:  35000    // –¢–µ—Ä–º–æ –õ—é–∫—Å
};

// –¶–µ–Ω—ã –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ (–∏–∑ –ø—Ä–∞–π—Å–∞ + 10%)
const ECONOMY_WINDOWS = {
  // –û–∫–Ω–∞ –ü–í–• (–∏–∑ –ø—Ä–∞–π—Å–∞ + 10%)
  "40√ó40": {1: 4950},      // 4500 + 10%
  "60√ó90": {1: 6050},      // 5500 + 10%
  "970√ó1160": {1: 10450},  // 9500 + 10%
  "1500√ó1800": {1: 18150}, // 16500 + 10%
  "1800√ó1800": {1: 21450}, // 19500 + 10%
  "90√ó205 –¥–≤–µ—Ä—å –ü–í–•": {2: 38500} // 35000 + 10%
};

const ECONOMY_WOOD_PRICES = {
  win: {                // –æ–∫–Ω–∞ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ (–∏–∑ –ø—Ä–∞–π—Å–∞ + 10%)
    "55√ó80": 1100,      // 1000 + 10%
    "30√ó30": 550        // 500 + 10%
  },
  door: {               // –¥–≤–µ—Ä–∏ (–∏–∑ –ø—Ä–∞–π—Å–∞ + 10%)
    wooden_set: 3300,      // –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –Ω–∞–±–æ—Ä–Ω–∞—è 75√ó175 (3000 + 10%)
    wooden_swing: 5500,    // —Ä–∞—Å–ø–∞—à–Ω–∞—è (—à–∏—Ä–∏–Ω–∞ 160) (5000 + 10%)
    interior_pine: 13200   // –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è —Å–æ—Å–Ω–æ–≤–∞—è (12000 + 10%)
  }
};

const ECONOMY_METAL_PRICES = {
  metal_rf: 14300       // –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –†–§ (13000 + 10%)
};

/* ------------------------------------------------------------------
   2. –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è —Ç—Ä—ë—Ö —Ç–∏–ø–æ–≤ —Å—Ç—Ä–æ–µ–Ω–∏–π
------------------------------------------------------------------ */

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–µ—Ä–∞–Ω–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–π—Å–∞ (—Ü–µ–Ω—ã –£–ñ–ï —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
const VERANDA_CONFIG = {
  // –•–æ–∑–±–ª–æ–∫–∏ —Å –≤–µ—Ä–∞–Ω–¥–∞–º–∏
  hoblok: {
    '3x3': { main: '3x2', veranda: '3x1', price: 89100 }, // 81000 + 10%
    '4x3': { main: '4x2', veranda: '4x1', price: 102300 }, // 93000 + 10%
    '4x4': { main: '4x2', veranda: '4x2', price: 134200 }, // 122000 + 10%
    '4x4_alt': { main: '4x3', veranda: '4x1', price: 148500 }, // 135000 + 10%
    '5x3': { main: '5x2', veranda: '5x1', price: 128700 }, // 117000 + 10%
    '5x4': { main: '5x2', veranda: '5x2', price: 141900 }, // 129000 + 10%
    '5x5': { main: '5x3', veranda: '5x2', price: 207900 }, // 189000 + 10%
    '5x5_alt': { main: '5x2.5', veranda: '5x2.5', price: 201300 }, // 183000 + 10%
    '6x3': { main: '6x2', veranda: '6x1', price: 128700 }, // 117000 + 10%
    '6x4': { main: '6x3', veranda: '6x1', price: 172700 }, // 157000 + 10%
    '6x4_alt': { main: '6x2', veranda: '6x2', price: 141900 }, // 129000 + 10%
    '6x4.5': { main: '6x2.5', veranda: '6x2', price: 213400 }, // 194000 + 10%
    '6x5': { main: '6x3', veranda: '6x2', price: 221100 }, // 201000 + 10%
    '6x6': { main: '6x3', veranda: '6x3', price: 258500 }, // 235000 + 10%
    '6x6_alt': { main: '6x4', veranda: '6x2', price: 323400 } // 294000 + 10%
  },
  // –ë—ã—Ç–æ–≤–∫–∏ —Å –≤–µ—Ä–∞–Ω–¥–∞–º–∏
  bytovka: {
    '3x3': { main: '3x2', veranda: '3x1', price: 95700 }, // 87000 + 10%
    '4x3': { main: '4x2', veranda: '4x1', price: 107800 }, // 98000 + 10%
    '4x4': { main: '4x2', veranda: '4x2', price: 140800 }, // 128000 + 10%
    '4x4_alt': { main: '4x3', veranda: '4x1', price: 152900 }, // 139000 + 10%
    '5x3': { main: '5x2', veranda: '5x1', price: 133100 }, // 121000 + 10%
    '5x4': { main: '5x2', veranda: '5x2', price: 145200 }, // 132000 + 10%
    '5x5': { main: '5x3', veranda: '5x2', price: 235400 }, // 214000 + 10%
    '5x5_alt': { main: '5x2.5', veranda: '5x2.5', price: 213400 }, // 194000 + 10%
    '6x3': { main: '6x2', veranda: '6x1', price: 136400 }, // 124000 + 10%
    '6x4': { main: '6x3', veranda: '6x1', price: 183700 }, // 167000 + 10%
    '6x4_alt': { main: '6x2', veranda: '6x2', price: 154000 }, // 140000 + 10%
    '6x4.5': { main: '6x2.5', veranda: '6x2', price: 225500 }, // 205000 + 10%
    '6x5': { main: '6x3', veranda: '6x2', price: 232100 }, // 211000 + 10%
    '6x6': { main: '6x3', veranda: '6x3', price: 271700 }, // 247000 + 10%
    '6x6_alt': { main: '6x4', veranda: '6x2', price: 341000 } // 310000 + 10%
  }
};
const CONFIG = {
  hoblok: {
    widths:[2,2.5,3,4,5,6,7,8],       // –ò–°–ü–†–ê–í–õ–ï–ù–û: —à–∏—Ä–∏–Ω–∞ (–±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è)
    lengths:[2,2.1,2.3,2.5,3,4],      // –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–ª–∏–Ω–∞ (–º–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è + —Å–∏–Ω–æ–Ω–∏–º—ã)
    basePrice:{
      "2x2":52800,"3x2":58300,"4x2":64900,"5x2":73700,"6x2":78100,
      "3x3":68200,"4x3":82500,"5x3":93500,"6x3":99000
    },
    delivery:{ perKm1:80, perKm2:140, min:5000 },
    verandaPrice:7500,
    isEconomy: false
  },
  bytovka: {
    widths:[2,2.5,3,4,5,6,7,8],       // –ò–°–ü–†–ê–í–õ–ï–ù–û: —à–∏—Ä–∏–Ω–∞ (–±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è)
    lengths:[2,2.1,2.3,2.5,3,4],      // –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–ª–∏–Ω–∞ (–º–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è + —Å–∏–Ω–æ–Ω–∏–º—ã)

    basePrice:{
      "2x2":70400,"3x2":79200,"4x2":89100,"5x2":99000,"6x2":103400,
      "3x3":95700,"4x3":108900,"5x3":136400,"6x3":139700
    },
    delivery:{ perKm1:100, perKm2:180, min:6000 },
    verandaPrice:7500,
    isEconomy: false
  },
  house: {
    widths:[6,7,8,9,10],
    lengths:[4,5,6,7,8,9,10],
    rates: RATE,
    isEconomy: false
  },
  // –ù–û–í–ê–Ø –≠–ö–û–ù–û–ú-–õ–ò–ù–ï–ô–ö–ê (—Ü–µ–Ω—ã –∏–∑ –ø—Ä–∞–π—Å–∞)
  hoblok_economy: {
    widths:[2,2.2,2.5,3,4,5,6,7],
    lengths:[2,2.2,2.5,2.7,3,4,5,6],
    basePrice:{
      // –•–æ–∑–±–ª–æ–∫–∏ (–≤–Ω—É—Ç—Ä–∏ –±–µ–∑ –æ—Ç–¥–µ–ª–∫–∏ –∏ —É—Ç–µ–ø–ª–µ–Ω–∏—è; 1 –æ–∫–Ω–æ) - —Ü–µ–Ω—ã –∏–∑ –ø—Ä–∞–π—Å–∞ + 10%
      "2x2":30800,"2x2.2":33000,"2x2.5":48400,
      "3x2":40700,"3x2.2":44000,"3x2.5":56100,"3x3":64900,
      "4x2":46200,"4x2.2":49500,"4x2.5":64900,"4x3":77000,"4x4":116600,
      "5x2":51150,"5x2.2":54450,"5x2.5":73700,"5x3":97900,"5x4":152900,
      "6x2":54450,"6x2.2":56650,"6x2.5":78100,"6x2.7":96800,"6x3":100100,"6x4":158400,
      "7x2":78100,"7x2.2":82500,"7x2.5":93500,"7x3":118800
    },
    // –•–æ–∑–±–ª–æ–∫–∏ —Å –≤–µ—Ä–∞–Ω–¥–æ–π —Å–ø–µ—Ä–µ–¥–∏ (—Ü–µ–Ω—ã –∏–∑ –ø—Ä–∞–π—Å–∞ + 10%)
    verandaPrice:{
      "3x3":89100,"4x3":102300,"4x4":134200,"4x4_alt":148500,
      "5x3":128700,"5x4":141900,"5x5":207900,"5x5_alt":201300,
      "6x3":128700,"6x4":172700,"6x4_alt":141900,"6x4.5":213400,
      "6x5":221100,"6x6":258500,"6x6_alt":323400
    },
    delivery:{ perKm:130, min:7000, assembly:7000 },
    // –°–≤–∞–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
    svai: {
      // –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º (–º–∏–Ω–∏–º—É–º 6 —à—Ç—É–∫)
      recommendations: {
        "2x2": 6, "2x2.2": 6, "2x2.5": 6,
        "3x2": 6, "3x2.2": 6, "3x2.5": 6, "3x3": 6,
        "4x2": 6, "4x2.2": 6, "4x2.5": 6, "4x3": 6, "4x4": 6,
        "5x2": 6, "5x2.2": 6, "5x2.5": 9, "5x3": 9, "5x4": 9,
        "6x2": 6, "6x2.2": 6, "6x2.5": 9, "6x2.7": 9, "6x3": 9, "6x4": 9,
        "7x2": 6, "7x2.2": 6, "7x2.5": 9, "7x3": 9
      },
      // –¶–µ–Ω—ã –Ω–∞ —Å–≤–∞–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ –Ω–∞–ø—Ä—è–º—É—é
    },
    isEconomy: true
  },
bytovka_economy: {
  widths:[2,2.2,2.5,3,4,5,6,7],
  lengths:[2,2.2,2.4,2.5,2.7,3,4,5,6],
  basePrice:{
    // –ë—ã—Ç–æ–≤–∫–∏ (—É—Ç–µ–ø–ª–µ–Ω–∏–µ 50 –º–º —Å—Ç–µ–Ω—ã+–ø–æ–ª; –≤–Ω—É—Ç—Ä–∏ –æ—Ä–≥–∞–ª–∏—Ç; 1 –æ–∫–Ω–æ) - –¶–ï–ù–´ –° –ù–ê–¶–ï–ù–ö–û–ô 10%
    "2x2":37400,"2x2.2":40700,"2x2.5":53900,
    "3x2":47850,"3x2.2":51150,"3x2.5":67100,"3x3":72600,
    "4x2":54450,"4x2.2":57750,"4x2.5":73700,"4x3":81400,"4x4":127600,
    "5x2":57200,"5x2.2":60500,"5x2.5":80300,"5x3":105600,"5x4":159500,
    "6x2":62590,"6x2.2":65450,"6x2.5":84150,"6x2.7":104500,"6x3":113300,"6x4":166100,
    "7x2":82500,"7x2.2":88000,"7x2.4":95700,"7x2.5":99000,"7x3":124300
  },
  // –ë—ã—Ç–æ–≤–∫–∏ —Å –≤–µ—Ä–∞–Ω–¥–æ–π —Å–ø–µ—Ä–µ–¥–∏ (—Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
  verandaPrice:{
    "3x3":95700,"4x3":107800,"4x4":140800,"4x4_alt":152900,
    "5x3":133100,"5x4":145200,"5x5":235400,"5x5_alt":213400,
    "6x3":136400,"6x4":183700,"6x4_alt":154000,"6x4.5":225500,
    "6x5":232100,"6x6":271700,"6x6_alt":341000
  },
  delivery:{ perKm:130, min:7000, assembly:7000 },
  // –°–≤–∞–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ - –¢–û–ß–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ò–ó –ü–†–ê–ô–°–ê
  svai: {
    // –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º (–º–∏–Ω–∏–º—É–º 6 —à—Ç—É–∫)
    recommendations: {
      "2x2": 6, "2x2.2": 6, "2x2.5": 6,
      "3x2": 6, "3x2.2": 6, "3x2.5": 6, "3x3": 6,
      "4x2": 6, "4x2.2": 6, "4x2.5": 6, "4x3": 6, "4x4": 6,
      "5x2": 6, "5x2.2": 6, "5x2.5": 9, "5x3": 9, "5x4": 9,
      "6x2": 6, "6x2.2": 6, "6x2.5": 9, "6x2.7": 9, "6x3": 9, "6x4": 9,
      "7x2": 6, "7x2.2": 6, "7x2.4": 6, "7x2.5": 9, "7x3": 9
    },
    // –¶–µ–Ω—ã –Ω–∞ —Å–≤–∞–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ –Ω–∞–ø—Ä—è–º—É—é
  },
  isEconomy: true
  }
};
// —Ü–µ–Ω–∞ 1 –º¬≤ –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
const NONSTD_RATE = {
  bytovka: 8800,   // ‚ÇΩ/–º¬≤ (—Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
  hoblok:  6050    // ‚ÇΩ/–º¬≤ (—Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
};
// –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ü–¶–ò–ò –î–õ–Ø –≠–ö–û–ù–û–ú-–õ–ò–ù–ï–ô–ö–ò (–¶–ï–ù–´ –° –ù–ê–¶–ï–ù–ö–û–ô 10%)
const ECONOMY_EXTRAS = {
  // –£—Ç–µ–ø–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–ª–∫–∞ 50 –º–º (—Ñ–∏–∫—Å-—Ü–µ–Ω—ã –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
  ceilingInsulation: {
    "2x2": 1100, "2x2.2": 1100, "2x2.5": 1650,
    "3x2": 2200, "3x2.2": 2200, "3x2.5": 2750, "3x3": 2750,
    "4x2": 3300, "4x2.2": 3300, "4x2.5": 3850, "4x3": 3850, "4x4": 3850,
    "5x2": 4400, "5x2.2": 4400, "5x2.5": 4400, "5x3": 4400, "5x4": 4400,
    "6x2": 4400, "6x2.2": 4400, "6x2.5": 4950, "6x3": 4950, "6x4": 4950,
    "7x2": 5500, "7x2.2": 5500, "7x2.5": 6050, "7x3": 6050
  },
  
  // –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ - —Ü–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ –Ω–∞–ø—Ä—è–º—É—é
  
  // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ (—Å—Ç–µ–Ω—ã + –ø–æ—Ç–æ–ª–æ–∫, –ø–æ –≤—Å–µ–º—É –æ–±—ä—ë–º—É) - —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
  interiorFinish: {
    // –û–°–ü-9
    osb: {
      "2x2": 7700, "2x2.2": 7700, "2x2.5": 9350,
      "3x2": 9900, "3x2.2": 9900, "3x2.5": 12100, "3x3": 14850,
      "4x2": 12650, "4x2.2": 12650, "4x2.5": 14850, "4x3": 16500, "4x4": 16500,
      "5x2": 14300, "5x2.2": 14300, "5x2.5": 16500, "5x3": 19800, "5x4": 22000,
      "6x2": 16500, "6x2.2": 16500, "6x2.5": 18700, "6x3": 20900, "6x4": 27500,
      "7x2": 19250, "7x2.2": 19250, "7x2.5": 20350, "7x3": 26400
    },
    // –í–∞–≥–æ–Ω–∫–∞ "–°"
    vagonka: {
      "2x2": 19800, "2x2.2": 19800, "2x2.5": 23100,
      "3x2": 25300, "3x2.2": 25300, "3x2.5": 28600, "3x3": 30800,
      "4x2": 30800, "4x2.2": 30800, "4x2.5": 34650, "4x3": 36300, "4x4": 36300,
      "5x2": 31900, "5x2.2": 31900, "5x2.5": 36300, "5x3": 39600, "5x4": 44000,
      "6x2": 33000, "6x2.2": 33000, "6x2.5": 38500, "6x3": 42900, "6x4": 52800,
      "7x2": 38500, "7x2.2": 38500, "7x2.5": 43450, "7x3": 48400
    }
  },
  
  // –û–∫–Ω–∞ / –¥–≤–µ—Ä–∏ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ) - —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
  windowsDoors: {
    // –û–∫–Ω–∞ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ
    woodWindows: { "55x80": 1100, "30x30": 550 },
    // –û–∫–Ω–∞ –ü–í–• (—Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–∞–π—Å–∞)
    pvcWindows: { "40x40": 4950, "60x90": 6050, "970x1160": 10450, "1500x1800": 18150, "1800x1800": 21450 },
    // –î–≤–µ—Ä–∏ (—Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–∞–π—Å–∞)
    woodDoors: { 
      "75x175": 3300,      // –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –Ω–∞–±–æ—Ä–Ω–∞—è 75√ó175
      "160": 5500          // —Ä–∞—Å–ø–∞—à–Ω–∞—è (—à–∏—Ä–∏–Ω–∞ 160)
    },
    metalDoors: {
      "rf": 14300          // –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –†–§
    },
    interiorDoors: {
      "pine": 13200        // –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è —Å–æ—Å–Ω–æ–≤–∞—è
    }
  },
  
  // –ü—Ä–æ—á–µ–µ - —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
  misc: {
    "steps": 2200,           // –°—Ç—É–ø–µ–Ω–∏
    "ramp_75": 3300,         // –ø–∞–Ω–¥—É—Å 75 —Å–º
    "ramp_160_180": 5500,    // –ø–∞–Ω–¥—É—Å 160‚Äì180 —Å–º
    "block_20x20x40": 385,   // –±–ª–æ–∫ 20√ó20√ó40 (–∑–∞ —à—Ç)
    "plate_50x50": 495       // –ø–ª–∏—Ç–∞ 50√ó50 (–∑–∞ —à—Ç)
  },
  
  // –£—Ç–µ–ø–ª–µ–Ω–∏–µ 100 –º–º (—Å—Ç–µ–Ω—ã/–ø–æ–ª/–ø–æ—Ç–æ–ª–æ–∫; –∫–∞—Ä–∫–∞—Å 40√ó100) - —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
  insulation100: {
    "2x2": 11000, "2x2.2": 11000, "2x2.5": 13200,
    "3x2": 12100, "3x2.2": 12100, "3x2.5": 14300, "3x3": 14300,
    "4x2": 13200, "4x2.2": 13200, "4x2.5": 15400, "4x3": 15400, "4x4": 15400,
    "5x2": 14300, "5x2.2": 14300, "5x2.5": 16500, "5x3": 16500, "5x4": 16500,
    "6x2": 15400, "6x2.2": 15400, "6x2.5": 17600, "6x3": 17600, "6x4": 17600,
    "7x2": 16500, "7x2.2": 16500, "7x2.5": 18700, "7x3": 18700
  },
  
  // –û–≥–Ω–µ–±–∏–æ–∑–∞—â–∏—Ç–∞ - —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
  fireProtection: {
    // –ü–æ–ª
    floor: {
      "2x2": 1650, "2x2.2": 1650, "2x2.5": 1650,
      "3x2": 2200, "3x2.2": 2200, "3x2.5": 2200, "3x3": 2200,
      "4x2": 2750, "4x2.2": 2750, "4x2.5": 2750, "4x3": 2750, "4x4": 4400,
      "5x2": 3300, "5x2.2": 3300, "5x2.5": 3300, "5x3": 3300, "5x4": 4400,
      "6x2": 3850, "6x2.2": 3850, "6x2.5": 3850, "6x3": 3850, "6x4": 5500,
      "7x2": 4950, "7x2.2": 4950, "7x2.5": 4950, "7x3": 4950
    },
    // –ö–∞—Ä–∫–∞—Å
    frame: {
      "2x2": 3850, "2x2.2": 3850, "2x2.5": 3850,
      "3x2": 4400, "3x2.2": 4400, "3x2.5": 4400, "3x3": 4400,
      "4x2": 4950, "4x2.2": 4950, "4x2.5": 4950, "4x3": 4950, "4x4": 0, // –≤ –ø–æ–¥–∞—Ä–æ–∫
      "5x2": 5500, "5x2.2": 5500, "5x2.5": 5500, "5x3": 5500, "5x4": 0, // –≤ –ø–æ–¥–∞—Ä–æ–∫
      "6x2": 5500, "6x2.2": 5500, "6x2.5": 5500, "6x3": 5500, "6x4": 0, // –≤ –ø–æ–¥–∞—Ä–æ–∫
      "7x2": 6600, "7x2.2": 6600, "7x2.5": 6600, "7x3": 6600
    }
  },
  
  // –ü–∞—Ä–æ- –∏ –≤–µ—Ç—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è (–ø–æ –∫—Ä—É–≥—É) - —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
  vaporBarrier: {
    "2x2": 2750, "2x2.2": 2750, "2x2.5": 2750,
    "3x2": 4400, "3x2.2": 4400, "3x2.5": 4400, "3x3": 4400,
    "4x2": 5500, "4x2.2": 5500, "4x2.5": 5500, "4x3": 5500, "4x4": 5500,
    "5x2": 6050, "5x2.2": 6050, "5x2.5": 6050, "5x3": 6050, "5x4": 6050,
    "6x2": 7150, "6x2.2": 7150, "6x2.5": 7150, "6x3": 7150, "6x4": 7150
  }
};


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å–≤–∞–π –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
function populateEconomyPileOptions() {
  const type = selType.value;
  const cfg = CONFIG[type];
  if (!cfg.isEconomy) return;
  
  const w = parseFloat(inpWidth.value) || 0;
  const l = parseFloat(inpLength.value) || 0;
  const sizeKey = `${w}x${l}`;
  
  const recommendation = cfg.svai.recommendations[sizeKey];
  const selEconomySvaiType = document.getElementById('selEconomySvaiType');
  
  if (selEconomySvaiType) {
    
    // –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∑–∞–Ω–æ–≤–æ
    selEconomySvaiType.innerHTML = '';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏—é "–Ω–µ—Ç"
    selEconomySvaiType.innerHTML = '<option value="">‚Äî –Ω–µ—Ç ‚Äî</option>';
    
    if (recommendation) {
      // –ü—Ä–æ—Å—Ç—ã–µ —Ü–µ–Ω—ã –∏–∑ –ø—Ä–∞–π—Å–∞ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
      const prices = [
        { key: "76x150", price: 4840, text: "√ò76√ó1,5 –º" },
        { key: "76x200", price: 5390, text: "√ò76√ó2,0 –º" },
        { key: "89x200", price: 6050, text: "√ò89√ó2,0 –º" },
        { key: "89x250", price: 6490, text: "√ò89√ó2,5 –º" },
        { key: "89x300", price: 7150, text: "√ò89√ó3,0 –º" }
      ];
      
      prices.forEach(item => {
        const totalPrice = item.price * recommendation;
        selEconomySvaiType.innerHTML += 
          `<option value="${item.key}">${item.text} ‚Äî ${item.price.toLocaleString()} ‚ÇΩ/—à—Ç √ó ${recommendation} —à—Ç = ${totalPrice.toLocaleString()} ‚ÇΩ</option>`;
      });
    }
    
    
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Å–≤–∞—è–º –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
function updateSvaiRecommendation() {
  const type = selType.value;
  const cfg = CONFIG[type];
  if (!cfg.isEconomy) return;
  
  const w = parseFloat(inpWidth.value) || 0;
  const l = parseFloat(inpLength.value) || 0;
  const sizeKey = `${w}x${l}`;
  
  const recommendation = cfg.svai.recommendations[sizeKey];
  const selSvaiType = document.getElementById('selSvaiType');
  if (selSvaiType && recommendation) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ —Å–≤–∞–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
    const options = selSvaiType.querySelectorAll('option');
    options.forEach(option => {
      if (option.value) {
        const price = option.textContent.match(/‚Äî (\d+[\s,]*\d*) ‚ÇΩ/);
        if (price) {
          const totalPrice = parseInt(price[1].replace(/\s/g, '')) * recommendation;
          option.textContent = option.textContent.replace(/‚Äî \d+[\s,]*\d* ‚ÇΩ/, `‚Äî ${totalPrice.toLocaleString()} ‚ÇΩ (${recommendation} —à—Ç)`);
        }
      }
    });
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// 3. –ñ—ë—Å—Ç–∫–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ –æ—Ç–¥–µ–ª–∫–∏ –ø–æ —Ç–∏–ø—É –∏ –∫—Ä—ã—à–µ
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FINISH_PROFILES = {
  house_lom: {
    inner: [
      ["none",     "‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî"],
      ["osb_vag",  "–û–°–ë ‚Üí –≤–∞–≥–æ–Ω–∫–∞ B‚ÄìC (120 ‚ÇΩ/–º¬≤)"],
      ["osb_imit", "–û–°–ë ‚Üí –∏–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ (350 ‚ÇΩ/–º¬≤)"],
      ["osb_vagA", "–û–°–ë ‚Üí –≤–∞–≥–æ–Ω–∫–∞ A (500 ‚ÇΩ/–º¬≤)"],
      ["osb_block","–û–°–ë ‚Üí –±–ª–æ–∫-—Ö–∞—É—Å (1120 ‚ÇΩ/–º¬≤)"]
    ],
    outer: [
      ["none",      "‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî"],
      ["vag_ext",   "–í–∞–≥–æ–Ω–∫–∞ B‚ÄìC (500 ‚ÇΩ/–º¬≤)"],
      ["imitBC_ext","–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ B‚ÄìC (250 ‚ÇΩ/–º¬≤)"],
      ["imitA_ext", "–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ A (400 ‚ÇΩ/–º¬≤)"],
      ["block_ext", "–ë–ª–æ–∫-—Ö–∞—É—Å (1000 ‚ÇΩ/–º¬≤)"],
      ["osb_extA",  "–í–∞–≥–æ–Ω–∫–∞ A (500 ‚ÇΩ/–º¬≤)"]
    ]
  },
  house_gable: {
    inner: [
      ["none",      "‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî"],
      ["vag_imitBC","–í–∞–≥–æ–Ω–∫–∞ ‚Üí –∏–º–∏—Ç–∞—Ü–∏—è B‚ÄìC (250 ‚ÇΩ/–º¬≤)"],
      ["vag_imitA", "–í–∞–≥–æ–Ω–∫–∞ ‚Üí –∏–º–∏—Ç–∞—Ü–∏—è A (400 ‚ÇΩ/–º¬≤)"],
      ["vag_block", "–í–∞–≥–æ–Ω–∫–∞ ‚Üí –±–ª–æ–∫-—Ö–∞—É—Å (1000 ‚ÇΩ/–º¬≤)"],
      ["vag_vagA",  "–í–∞–≥–æ–Ω–∫–∞ B‚ÄìC ‚Üí –≤–∞–≥–æ–Ω–∫–∞ A (380 ‚ÇΩ/–º¬≤)"]
    ],
    outer: [
      ["none",      "‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî"],
      ["imitBC_ext","–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ B‚ÄìC (250 ‚ÇΩ/–º¬≤)"],
      ["imitA_ext", "–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ A (400 ‚ÇΩ/–º¬≤)"],
      ["block_ext", "–ë–ª–æ–∫-—Ö–∞—É—Å (1000 ‚ÇΩ/–º¬≤)"],
      ["vag_extA",  "–í–∞–≥–æ–Ω–∫–∞ B‚ÄìC ‚Üí –≤–∞–≥–æ–Ω–∫–∞ A (380 ‚ÇΩ/–º¬≤)"]
    ]
  },
  bytovka_lom: {
    inner: [
      ["none",     "‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî"],
      ["osb_vag",  "–û–°–ë ‚Üí –≤–∞–≥–æ–Ω–∫–∞ B‚ÄìC (120 ‚ÇΩ/–º¬≤)"],
      ["osb_imit", "–û–°–ë ‚Üí –∏–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ (350 ‚ÇΩ/–º¬≤)"],
      ["osb_vagA", "–û–°–ë ‚Üí –≤–∞–≥–æ–Ω–∫–∞ A (500 ‚ÇΩ/–º¬≤)"],
      ["osb_block","–û–°–ë ‚Üí –±–ª–æ–∫-—Ö–∞—É—Å (1120 ‚ÇΩ/–º¬≤)"]
    ],
    outer: [
      ["none",      "‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî"],
      ["vag_ext",   "–í–∞–≥–æ–Ω–∫–∞ B‚ÄìC (500 ‚ÇΩ/–º¬≤)"],
      ["imitBC_ext","–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ B‚ÄìC (250 ‚ÇΩ/–º¬≤)"],
      ["imitA_ext", "–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ A (400 ‚ÇΩ/–º¬≤)"],
      ["block_ext", "–ë–ª–æ–∫-—Ö–∞—É—Å (1000 ‚ÇΩ/–º¬≤)"],
      ["osb_extA",  "–í–∞–≥–æ–Ω–∫–∞ A (500 ‚ÇΩ/–º¬≤)"],
      ["profGalv", "–ü—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π (750 ‚ÇΩ/–º¬≤)"]
    ]
  },
    hoblok_lom: {
    inner: [
      ["none",     "‚Äî –±–µ–∑ –æ—Ç–¥–µ–ª–∫–∏ ‚Äî"],
      ["osb_only","–û–°–ë-3 –ø–ª–∏—Ç–∞"],
      ["osb_vag",  "–û–°–ë ‚Üí –≤–∞–≥–æ–Ω–∫–∞ B‚ÄìC (120 ‚ÇΩ/–º¬≤)"],
      ["osb_imit", "–û–°–ë ‚Üí –∏–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ (350 ‚ÇΩ/–º¬≤)"],
      ["osb_vagA", "–û–°–ë ‚Üí –≤–∞–≥–æ–Ω–∫–∞ A (500 ‚ÇΩ/–º¬≤)"],
      ["osb_block","–û–°–ë ‚Üí –±–ª–æ–∫-—Ö–∞—É—Å (1120 ‚ÇΩ/–º¬≤)"]
    ],
    outer: [
      ["none",       "‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî"],
      ["vag_ext",    "–í–∞–≥–æ–Ω–∫–∞ B‚ÄìC (500 ‚ÇΩ/–º¬≤)"],
      ["imitBC_ext", "–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ B‚ÄìC (250 ‚ÇΩ/–º¬≤)"],
      ["imitA_ext",  "–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ A (400 ‚ÇΩ/–º¬≤)"],
      ["block_ext",  "–ë–ª–æ–∫-—Ö–∞—É—Å (1000 ‚ÇΩ/–º¬≤)"],
      ["osb_extA",   "–í–∞–≥–æ–Ω–∫–∞ A (500 ‚ÇΩ/–º¬≤)"],
      ["profGalv", "–ü—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π (750 ‚ÇΩ/–º¬≤)"]
    ]
  },
  
};

// alias –¥–ª—è –¥–≤—É—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–∏ –±—ã—Ç–æ–≤–∫–∏ –∏ —Ö–æ–∑–±–ª–æ–∫–∞
FINISH_PROFILES.bytovka_gable = FINISH_PROFILES.bytovka_lom;
FINISH_PROFILES.hoblok_gable  = FINISH_PROFILES.hoblok_lom;


/* ------------------------------------------------------------------
   3. –ü–æ–ª—É—á–∞–µ–º DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
------------------------------------------------------------------ */
const selType      = document.getElementById("selType");
const inpWidth     = document.getElementById("inpWidth");
const inpLength    = document.getElementById("inpLength");
const inpAddr      = document.getElementById("inpAddr");
const btnCalc      = document.getElementById("btnCalc");
const out          = document.getElementById("out");

const chkRamp = document.getElementById("chkRamp");

const selInsul     = document.getElementById("selInsul");
const selRoofMat   = document.getElementById("selRoofMat");
const selInRep     = document.getElementById("selInRep");
const selOutRep    = document.getElementById("selOutRep");
const selFloor   = document.getElementById("selFloor");   // –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª–∞
const inpExtraH  = document.getElementById("inpExtraH");  // –ø–æ–ª–µ –≤—ã—Å–æ—Ç—ã
const chkMouse     = document.getElementById("chkMouseNew");

const selPart      = document.getElementById("selPart");
const inpPartLen   = document.getElementById("inpPartLen");

const selPile      = document.getElementById("selPile");

const btnAddWindow     = document.getElementById("btnAddWindow");
const windowsContainer = document.getElementById("windowsContainer");
const tmplWindowRow    = document.getElementById("tmplWindowRow");
const roofContainer    = document.getElementById("roofContainer");

const inpVerWidth  = document.getElementById("verWidth");
const inpVerDepth  = document.getElementById("verDepth");
const btnReset     = document.getElementById("btnReset");
const btnClearAddr = document.getElementById("btnClearAddr");


/* ------------------------------------------------------------------
   4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
------------------------------------------------------------------ */
let map;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
function initMap() {
  const mapElement = document.getElementById('map');
  if (!mapElement) return;
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
  mapElement.innerHTML = '<div style="padding: 20px; text-align: center; color: #666; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</div>';
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É API
  const checkAPI = () => {
    if (typeof ymaps !== 'undefined') {
      try {
ymaps.ready(() => {
          // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
          mapElement.innerHTML = '';
          
          // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
  map = new ymaps.Map("map", {
            center: DEPOT,
            zoom: 9,
            controls: ['zoomControl', 'typeSelector', 'fullscreenControl']
          });
          
          // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –±–∞–∑—ã
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —Ç–æ—á–∫—É (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–∏–Ω–µ–π–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
          const baseMarker = new ymaps.Placemark(DEPOT, {
            balloonContent: '–û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–∏–Ω–µ–π–∫–∞)',
            isBaseMarker: true
          }, {
            preset: 'islands#redDotIcon'
          });
          map.geoObjects.add(baseMarker);
        });
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã:', error);
        mapElement.innerHTML = '<div style="padding: 20px; text-align: center; color: #666; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">–ö–∞—Ä—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</div>';
      }
    } else {
      // –ï—Å–ª–∏ API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º –µ—â–µ
      setTimeout(checkAPI, 1000);
    }
  };
  
  // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
  setTimeout(checkAPI, 1000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
initMap();

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Ä–∞–Ω–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏)
document.addEventListener('DOMContentLoaded', function() {
  if (typeof updateVerandaOptions === 'function') {
updateVerandaOptions();
  }
});

  // ‚îÄ‚îÄ‚îÄ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∞–¥—Ä–µ—Å–∞, –∫–∞–∫ –≤ —Ç–µ–ø–ª–∏—á–Ω–æ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const addrInput   = document.getElementById('inpAddr');
const suggBox     = document.getElementById('suggestions');
// –î–µ–±–∞—É–Ω—Å –¥–ª—è –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞
let addressInputTimeout;
// –ö—ç—à –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
const routeCache = new Map();
const MAX_CACHE_SIZE = 100;
const CACHE_EXPIRY = 30 * 60 * 1000; // 30 –º–∏–Ω—É—Ç
// –°—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–º–∏—Ç–æ–≤ API)
let requestCount = 0;
const MAX_REQUESTS_PER_MINUTE = 10;
let lastRequestTime = 0;

// Debounce –¥–ª—è calculate() - –∑–∞—â–∏—Ç–∞ –æ—Ç —á–∞—Å—Ç—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å–∞
let calculateTimeout = null;
let lastCalculateAddress = '';

// –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è calculate() —Å debounce –¥–ª—è –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
function calculateWithDebounce() {
  const currentAddress = inpAddr.value.trim();
  const addressChanged = currentAddress !== lastCalculateAddress;
  
  // –ï—Å–ª–∏ –∞–¥—Ä–µ—Å –∏–∑–º–µ–Ω–∏–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º debounce (500ms)
  // –ï—Å–ª–∏ –∞–¥—Ä–µ—Å –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è (–∏–∑–º–µ–Ω–∏–ª–∏—Å—å –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã), –≤—ã–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É
  if (addressChanged && currentAddress.length > 0) {
    lastCalculateAddress = currentAddress;
    clearTimeout(calculateTimeout);
    calculateTimeout = setTimeout(() => {
      calculate();
    }, 500);
  } else {
    // –î–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—ã–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É
    clearTimeout(calculateTimeout);
    calculate();
  }
}

addrInput.addEventListener('input', () => {
    const q = addrInput.value.trim();
    if (q.length < 3) {            // –º–µ–Ω—å—à–µ 3-—Ö —Å–∏–º–≤–æ–ª–æ–≤ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
        suggBox.style.display = 'none';
        return;
    }

    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
    clearTimeout(addressInputTimeout);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–∞—É—Ç (500–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞)
    addressInputTimeout = setTimeout(() => {
        if (typeof ymaps !== 'undefined') {
        ymaps.geocode(q, { results: 5 }).then(res => {
        const items = res.geoObjects.toArray();
        if (!items.length) {
            suggBox.style.display = 'none';
            return;
        }

        suggBox.innerHTML = '';            // —á–∏—Å—Ç–∏–º —Å—Ç–∞—Ä—ã–µ
        suggBox.style.display = 'block';

        items.forEach(item => {
            const div  = document.createElement('div');
            div.className = 'suggestion';

            const addr = item.getAddressLine();
            // –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—É—é —á–∞—Å—Ç—å
            const re   = new RegExp(`(${q})`, 'ig');
            div.innerHTML = addr.replace(re, '<span class="highlight">$1</span>');

            div.onclick = () => {
                addrInput.value      = addr;      // –≤—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
                suggBox.style.display = 'none';   // –ø—Ä—è—á–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
                lastCalculateAddress = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º, —á—Ç–æ–±—ã calculate() –≤—ã–∑–≤–∞–ª—Å—è
                calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∞–¥—Ä–µ—Å–∞
             };

            suggBox.appendChild(div);
        });
        }).catch(err => {
            console.warn('–û—à–∏–±–∫–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ):', err.message || err);
            suggBox.style.display = 'none';
        });
        }
    }, 500); // 500–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞
});

// –∫–ª–∏–∫ –º–∏–º–æ –±–ª–æ–∫–∞ ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
document.addEventListener('click', e => {
    if (!e.target.closest('.address-container')) suggBox.style.display = 'none';
});



  // —Å–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è
  selType.addEventListener("change", function() {
    handleTypeChange();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞ —Å—Ç—Ä–æ–µ–Ω–∏—è
  });
  document.querySelectorAll('input[name="roof"]').forEach(r => {
    r.addEventListener("change", function() {
      handleTypeChange();
      calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞ –∫—Ä—ã—à–∏
    });
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–∫–æ–Ω/–¥–≤–µ—Ä–µ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
  if (btnAddWindow) {
  btnAddWindow.addEventListener("click", addWindowRow);
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const btnAddWindowEconomy = document.getElementById("btnAddWindowEconomy");
  if (btnAddWindowEconomy) {
    btnAddWindowEconomy.addEventListener("click", addWindowRowEconomy);
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const btnAddPartition = document.getElementById("btnAddPartition");
  if (btnAddPartition) {
    btnAddPartition.addEventListener("click", addPartitionRow);
  }
  
  [inpWidth, inpLength].forEach(el => {
    el.addEventListener("change", () => {
      const type = selType.value;
      const cfg = CONFIG[type];
      if (!cfg.isEconomy) {
        populatePileOptions();
      } else {
        populateEconomyPileOptions();
      }
      updateVerandaOptions();
      calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤
    });
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  document.addEventListener('change', function(e) {
    if (e.target.name === 'deliveryType') {
      // –õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ calculate()
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    }
  });
  
  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é-–æ–±–µ—Ä—Ç–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
  if (btnCalc) {
    btnCalc.addEventListener("click", function() {
      if (typeof calculate === 'function') {
        calculate();
      } else {
        console.error('–§—É–Ω–∫—Ü–∏—è calculate –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
      }
    });
  } else {
    console.error('–ö–Ω–æ–ø–∫–∞ btnCalc –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }
  
  if (btnReset) {
    btnReset.addEventListener("click", function() {
      if (typeof resetFilters === 'function') {
        resetFilters();
      } else {
        console.error('–§—É–Ω–∫—Ü–∏—è resetFilters –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
      }
    });
  } else {
    console.error('–ö–Ω–æ–ø–∫–∞ btnReset –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ/–ø–æ–ª–Ω–æ–≥–æ –ö–ü (–∫–Ω–æ–ø–∫–∞)
  const btnShortKP = document.getElementById("btnShortKP");
  let isShortKPActive = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –ö–ü
  if (btnShortKP) {
    // –û—Ç—Ä–∞–∑–∏–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    btnShortKP.classList.add("active");
    btnShortKP.textContent = "–ü–æ–ª–Ω–æ–µ –ö–ü";
    btnShortKP.addEventListener("click", function() {
      isShortKPActive = !isShortKPActive;
      if (isShortKPActive) {
        btnShortKP.classList.add("active");
        btnShortKP.textContent = "–ü–æ–ª–Ω–æ–µ –ö–ü";
      } else {
        btnShortKP.classList.remove("active");
        btnShortKP.textContent = "–ö–æ—Ä–æ—Ç–∫–æ–µ –ö–ü";
      }
      if (out.textContent.trim()) {
        calculate(); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞
      }
    });
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –ö–ü (WhatsApp/–ê–≤–∏—Ç–æ)
  window.kpFormat = 'whatsapp'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é WhatsApp
  const formatSwitcher = document.getElementById('kpFormatSwitcher');
  if (formatSwitcher) {
    const formatButtons = formatSwitcher.querySelectorAll('.format-btn');
    formatButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        const format = this.getAttribute('data-format');
        window.kpFormat = format;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        formatButtons.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ö–ü –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –±—ã–ª–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ
        if (out.textContent.trim()) {
          calculate();
        }
      });
    });
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
  const chkMouseNew = document.getElementById('chkMouseNew');
  if (chkMouseNew) {
    chkMouseNew.addEventListener("change", calculate);
  }
  const chkRampLocal = document.getElementById('chkRamp');
  if (chkRampLocal) {
    chkRampLocal.addEventListener("change", calculate);
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ –∏ –ø–æ–ª–µ–π
  selFloor.addEventListener("change", calculate);
  inpExtraH.addEventListener("change", calculate);
  inpExtraH.addEventListener("input", calculate);

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ–ª–µ–∫—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
  if (selInsul) selInsul.addEventListener("change", calculate);
  if (selRoofMat) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ—Ç–∫–∞—Ç–∞
    let prevRoofMatValue = selRoofMat.value;
    
    selRoofMat.addEventListener("change", function(e) {
      // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ª—é–±–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª –∫—Ä–æ–≤–ª–∏ –∫—Ä–æ–º–µ –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–ª–∏—Å—Ç–∞, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      if (e.target.value !== "galv") {
        prevRoofMatValue = selRoofMat.value;
        openProfColorModal();
      } else {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–ª–∏—Å—Ç–∞
        selectedProfColor = null;
        prevRoofMatValue = e.target.value;
        calculate();
      }
    });
  }
  
  if (selInRep) selInRep.addEventListener("change", calculate);
  if (selOutRep) selOutRep.addEventListener("change", calculate);
  
  const chkInVer = document.getElementById('chkInVer');
  const verWidth = document.getElementById('verWidth');
  const verDepth = document.getElementById('verDepth');
  const verRoofType = document.querySelectorAll('input[name="verRoofType"]');
  const deliveryType = document.querySelectorAll('input[name="deliveryType"]');

  if (chkInVer) chkInVer.addEventListener("change", calculate);
  if (verWidth) {
    verWidth.addEventListener("change", function() {
      // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä–∞–Ω–¥—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ë–ï–ó –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      window.__updatePilesWithoutWarning = true;
      calculate();
      window.__updatePilesWithoutWarning = false;
    });
    verWidth.addEventListener("input", function() {
      // –ü—Ä–∏ –≤–≤–æ–¥–µ –≤–µ—Ä–∞–Ω–¥—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ë–ï–ó –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      window.__updatePilesWithoutWarning = true;
      calculate();
      window.__updatePilesWithoutWarning = false;
    });
  }
  if (verDepth) {
    verDepth.addEventListener("change", function() {
      // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä–∞–Ω–¥—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ë–ï–ó –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      window.__updatePilesWithoutWarning = true;
      calculate();
      window.__updatePilesWithoutWarning = false;
    });
    verDepth.addEventListener("input", function() {
      // –ü—Ä–∏ –≤–≤–æ–¥–µ –≤–µ—Ä–∞–Ω–¥—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ë–ï–ó –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      window.__updatePilesWithoutWarning = true;
      calculate();
      window.__updatePilesWithoutWarning = false;
    });
  }
  if (verRoofType.length > 0) {
    verRoofType.forEach(radio => radio.addEventListener("change", calculate));
  }
  if (deliveryType.length > 0) {
    deliveryType.forEach(radio => radio.addEventListener("change", calculate));
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
  const selPartitionType = document.getElementById('selPartitionType');
  const inpPartitionLength = document.getElementById('inpPartitionLength');
  if (selPartitionType) selPartitionType.addEventListener("change", calculate);
  if (inpPartitionLength) {
    inpPartitionLength.addEventListener("change", calculate);
    inpPartitionLength.addEventListener("input", calculate);
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–≤–∞–π
  const selSvaiType = document.getElementById('selSvaiType');
  if (selSvaiType) {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Å–≤–∞–π –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    // –í–ê–ñ–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
    if (!selSvaiType.hasAttribute('data-pile-handler-added')) {
      selSvaiType.setAttribute('data-pile-handler-added', 'true');
      
      selSvaiType.addEventListener("change", function(e) {
        // –ö–†–ò–¢–ò–ß–ù–û: –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –≤—ã–∑–≤–∞–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ (–ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–ø—Ü–∏–π)
        if (selSvaiType.hasAttribute('data-updating')) {
          return;
        }
        
        const currentValue = selSvaiType.value || '';
        if (!currentValue) {
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–≤–∞–π
          screwPileWarningShown = false;
          lastPileType = null;
          calculate();
          return;
        }
        
        // –í—ã–∑—ã–≤–∞–µ–º calculate() –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –≤–Ω—É—Ç—Ä–∏ calculate() —á–µ—Ä–µ–∑ checkScrewPileBrigade()
        calculate();
      });
    }
  }
  if (selEconomySvaiType) selEconomySvaiType.addEventListener("change", calculate);
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const chkSteps = document.getElementById('chkSteps');
  const chkRamp75 = document.getElementById('chkRamp75');
  const chkRamp160 = document.getElementById('chkRamp160');
  const chkVaporBarrier = document.getElementById('chkVaporBarrier');
  const chkInteriorFinish = document.getElementById('chkInteriorFinish');
  const selVeranda = document.getElementById('selVeranda');
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const chkInteriorOSB = document.getElementById('chkInteriorOSB');
  const chkInteriorVagonka = document.getElementById('chkInteriorVagonka');
  const chkFireProtectionFloor = document.getElementById('chkFireProtectionFloor');
  const chkFireProtectionFrame = document.getElementById('chkFireProtectionFrame');
  const chkInsulation100 = document.getElementById('chkInsulation100');
  const chkCeilingInsulation = document.getElementById('chkCeilingInsulation');

  if (chkSteps) chkSteps.addEventListener("change", calculate);
  if (chkRamp75) chkRamp75.addEventListener("change", calculate);
  if (chkRamp160) chkRamp160.addEventListener("change", calculate);
  if (chkVaporBarrier) chkVaporBarrier.addEventListener("change", calculate);
  if (chkInteriorFinish) chkInteriorFinish.addEventListener("change", calculate);
  if (selVeranda) selVeranda.addEventListener("change", calculate);
  
  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø—Ü–∏–π —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—Ç–¥–µ–ª–∫–∏ (—Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏)
  const interiorFinishInputs = document.querySelectorAll('input[name="interiorFinish"]');
  interiorFinishInputs.forEach(input => {
    input.addEventListener("change", calculate);
  });
  if (chkFireProtectionFloor) chkFireProtectionFloor.addEventListener("change", calculate);
  if (chkFireProtectionFrame) chkFireProtectionFrame.addEventListener("change", calculate);
  if (chkInsulation100) chkInsulation100.addEventListener("change", calculate);
  if (chkCeilingInsulation) chkCeilingInsulation.addEventListener("change", calculate);
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–∏–ø–∞ –∫—Ä—ã—à–∏ —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const economyRoofInputs = document.querySelectorAll('input[name="economyRoof"]');
  economyRoofInputs.forEach(input => {
    input.addEventListener("change", calculate);
  });
btnClearAddr.addEventListener("click", function() {
  clearDelivery();
  calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–æ—Å—Ç–∞–≤–∫–∏
});
updateStaticPriceLabels(); 

  handleTypeChange();
  
  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–≤–∞–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  setTimeout(() => {
    const type = selType.value;
    const cfg = CONFIG[type];
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ —Å–≤–∞–π
    const standardPilesBlock = document.getElementById('standardPilesBlock');
    const economyPilesBlock = document.getElementById('economyPilesBlock');
    
    if (!cfg.isEconomy) {
      if (standardPilesBlock) standardPilesBlock.style.display = 'block';
      if (economyPilesBlock) economyPilesBlock.style.display = 'none';
      populatePileOptions();
    } else {
      if (standardPilesBlock) standardPilesBlock.style.display = 'none';
      if (economyPilesBlock) economyPilesBlock.style.display = 'block';
      populateEconomyPileOptions();
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è chkMouseNew –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const chkMouseNew = document.getElementById('chkMouseNew');
    if (chkMouseNew) {
      chkMouseNew.addEventListener("change", function() {
        calculate();
      });
    } else {
      console.error('chkMouseNew element not found (delayed)!');
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è chkRamp –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const chkRampDelayed = document.getElementById('chkRamp');
    if (chkRampDelayed) {
      chkRampDelayed.addEventListener("change", function() {
        calculate();
      });
    } else {
      console.error('chkRamp element not found (delayed)!');
    }
  }, 100);

// –ö–Ω–æ–ø–∫–∞ ¬´–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ö–ü¬ª
const btnCopy = document.getElementById("btnCopy");
if (btnCopy) {
  btnCopy.addEventListener("click", () => {
    const text = out.innerText;
    if (!text) return alert("–ù–µ—á–µ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å.");
    navigator.clipboard.writeText(text)
      .then(() => {
        btnCopy.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
        setTimeout(() => btnCopy.textContent = "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ö–ü", 1500);
      })
      .catch(() => alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞."));
  });
}
// –ö–Ω–æ–ø–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å PDF¬ª - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ generatePDF
/**
 * –ñ—ë—Å—Ç–∫–æ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Å–µ–ª–µ–∫—Ç—ã –æ—Ç–¥–µ–ª–∫–∏ –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
 * @param {"hoblok"|"bytovka"|"house"} type
 * @param {"lom"|"gable"} roof
 */
function updateFinishSelects(type, roof) {
  const key     = `${type}_${roof}`;
  const profile = FINISH_PROFILES[key] || {};

  // –±–µ—Ä—ë–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã, –¥–∞–∂–µ –µ—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ—Ç
  const inner = profile.inner || [];
  const outer = profile.outer || [];

  // ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è ‚Äî
  selInRep.innerHTML = "";
  inner.forEach(([value, label]) => {
    const opt = document.createElement("option");
    opt.value = value;
    opt.textContent = labelGross(label);
    selInRep.appendChild(opt);
  });

  // ‚Äî –≤–Ω–µ—à–Ω—è—è ‚Äî
  selOutRep.innerHTML = "";
  outer.forEach(([value, label]) => {
    const opt = document.createElement("option");
    opt.value = value;
    opt.textContent = labelGross(label);
    selOutRep.appendChild(opt);
  });

  // **–í–æ–∑–≤—Ä–∞—â–∞–µ–º default, –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø—Ü–∏–π**
  if (inner.length === 0) selInRep.value  = "none";
  if (outer.length === 0) selOutRep.value = "none";

  // –µ—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—Ç–¥–µ–ª–∫–∏ –Ω–µ—Ç ‚Äî –ø—Ä—è—á–µ–º label
  if (selInRep?.closest("label")) {
  selInRep.closest("label").style.display =
    inner.length === 0 ? "none" : "";
  }
}

/* ------------------------------------------------------------------
   5. handleTypeChange: –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ —Å—Ç—Ä–æ–µ–Ω–∏—è
------------------------------------------------------------------ */
/* –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤–∏–¥–∏–º—ã–µ —Ü–µ–Ω—ã –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–ª–µ–∫—Ç–∞—Ö/–ª–µ–π–±–ª–∞—Ö –ø–æ–¥ –Ω–∞—à—É –Ω–∞—Ü–µ–Ω–∫—É */
function updateStaticPriceLabels(){
  // 1) –£—Ç–µ–ø–ª–µ–Ω–∏–µ (—Å–µ–ª–µ–∫—Ç selInsul)
  Array.from(selInsul.options).forEach(opt => {
    if (opt.value === "none") return;
    const p = INSUL[opt.value];
    if (!p && p!==0) return;
    opt.textContent = opt.textContent.replace(/\(.*?‚ÇΩ\/–º¬≤\)/, `(${formatPrice(grossInt(p))} ‚ÇΩ/–º¬≤)`);
  });

  // 2) –ö—Ä–æ–≤–ª—è –ø–æ –ø–ª–æ—â–∞–¥–∏ (selRoofMat)
  Array.from(selRoofMat.options).forEach(opt => {
    const p = ROOFMAT[opt.value] || 0;
    if (p > 0){
      opt.textContent = opt.textContent.replace(/\(.*?‚ÇΩ\/–º¬≤\)/, `(${formatPrice(grossInt(p))} ‚ÇΩ/–º¬≤)`);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü—ã
    if (opt.value === 'tile_lom') {
      opt.textContent = `–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞ (–æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞) (${formatPrice(grossInt(p))} ‚ÇΩ/–º¬≤)`;
    } else if (opt.value === 'tile_gable') {
      opt.textContent = `–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞ (–¥–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞) (${formatPrice(grossInt(p))} ‚ÇΩ/–º¬≤)`;
    }
  });

  // 3) –ü–æ–ª (selFloor)
  Array.from(selFloor.options).forEach(opt => {
    const p = FLOOR_MAT[opt.value];
    if (p > 0){
      opt.textContent = opt.textContent.replace(/‚Äî .*?‚ÇΩ\/–º¬≤\)/, `‚Äî ${formatPrice(grossInt(p))} ‚ÇΩ/–º¬≤)`);
    }
  });

  // 4) –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ (selPart)
  if (selPart) {
  Array.from(selPart.options).forEach(opt => {
    const p = PART[opt.value];
    if (p){
      opt.textContent = opt.textContent.replace(/\(.*?‚ÇΩ\/–ø–æ–≥\.–º\)/, `(${formatPrice(grossInt(p))} ‚ÇΩ/–ø–æ–≥.–º)`);
    }
  });
  }

  // 5) –°–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª (–ª–µ–π–±–ª —Å —á–µ–∫–±–æ–∫—Å–æ–º #chkMouse)
  const mouseLbl = document.querySelector('label input#chkMouse')?.parentElement;
  if (mouseLbl){
    mouseLbl.innerHTML = mouseLbl.innerHTML.replace(/\(.*?‚ÇΩ\/–º¬≤\)/, `(${formatPrice(grossInt(FLOOR.mouse))} ‚ÇΩ/–º¬≤)`);
  }

  // 6) –ü–∞–Ω–¥—É—Å (–ª–µ–π–±–ª —Å —á–µ–∫–±–æ–∫—Å–æ–º #chkRamp)
  const rampLbl = document.querySelector('label input#chkRamp')?.parentElement;
  if (rampLbl){
    rampLbl.innerHTML = rampLbl.innerHTML.replace(/\(.*?‚ÇΩ\)/, `(${formatPrice(grossInt(RAMP))} ‚ÇΩ)`);
  }

  // 7) –í–µ—Ä–∞–Ω–¥–∞ ‚Äî —Ä–∞–¥–∏–æ ¬´–æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è/–¥–≤—É—Å–∫–∞—Ç–Ω–∞—è¬ª
  document.querySelectorAll('input[name="verRoofType"]').forEach(inp => {
    const lbl = inp.closest('label');
    if (!lbl) return;
    const p = VERANDA[inp.value];                  // 7500 / 9000
    lbl.innerHTML = lbl.innerHTML.replace(/\(.*?‚ÇΩ\/–º¬≤\)/, `(${formatPrice(grossInt(p))} ‚ÇΩ/–º¬≤)`);
  });
}


function handleTypeChange() {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ç–∏–ø–∞
  checkForceLogoutOnLoad();
  
  const type = selType.value;
  const cfg  = CONFIG[type];
  const isEconomy = cfg.isEconomy || false;
  

  // —Ç–µ–∫—É—â–∞—è –∫—Ä—ã—à–∞
  const roof = document.querySelector('input[name="roof"]:checked').value;
  updateFinishSelects(type, roof);

  // ‚îÄ‚îÄ‚îÄ 1) —à–∏—Ä–∏–Ω–∞ / –¥–ª–∏–Ω–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// 1. –ó–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –±—ã–ª–æ –≤—ã–±—Ä–∞–Ω–æ –¥–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
const prevW = +inpWidth.value || null;
const prevL = +inpLength.value || null;

// 2. –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —à–∏—Ä–∏–Ω
let availableWidths, availableLengths;

if (cfg.isEconomy) {
  // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —Ä–∞–∑–º–µ—Ä—ã, —á—Ç–æ –µ—Å—Ç—å –≤ basePrice
  availableWidths = [...new Set(Object.keys(cfg.basePrice).map(key => key.split('x')[0]))].sort((a, b) => parseFloat(a) - parseFloat(b));
  availableLengths = [...new Set(Object.keys(cfg.basePrice).map(key => key.split('x')[1]))].sort((a, b) => parseFloat(a) - parseFloat(b));
  
  inpWidth.innerHTML = availableWidths.map(w => `<option>${w}</option>`).join("");
  inpLength.innerHTML = availableLengths.map(l => `<option>${l}</option>`).join("");
} else {
  // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Ç—Ä–æ–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ —Ä–∞–∑–º–µ—Ä—ã
  availableWidths = cfg.widths;
  availableLengths = cfg.lengths;
  
inpWidth.innerHTML = cfg.widths.map(w => `<option>${w}</option>`).join("");
  inpLength.innerHTML = cfg.lengths.map(l => `<option>${l}</option>`).join("");
}

// 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
if (prevW && availableWidths.includes(prevW.toString())) {
  inpWidth.value = prevW;
} else {
  inpWidth.value = availableWidths[0]; // —Ä–µ–∑–µ—Ä–≤ –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é
}

// 5. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–µ–∂–Ω—é—é –¥–ª–∏–Ω—É, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
if (prevL && availableLengths.includes(prevL.toString())) {
  inpLength.value = prevL;
} else {
  inpLength.value = availableLengths[0];
}

// 6. –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª–∏–Ω –ø—Ä–∏ —Å–º–µ–Ω–µ —à–∏—Ä–∏–Ω—ã
if (cfg.isEconomy) {
  // –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–ª–∏–Ω—É –¥–æ –≤—ã–±–æ—Ä–∞ —à–∏—Ä–∏–Ω—ã
  inpLength.disabled = true;
  inpLength.innerHTML = '<option>‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —à–∏—Ä–∏–Ω—É ‚Äî</option>';
  
  inpWidth.addEventListener('change', updateAvailableLengths);
  // –í—ã–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –¥–ª–∏–Ω
  updateAvailableLengths();
} else {
  // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Ç—Ä–æ–µ–Ω–∏–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –¥–ª–∏–Ω—É
  inpLength.disabled = false;
}


  // 2) –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ ¬´–¢–∏–ø –∫—Ä—ã—à–∏¬ª –∏ –º–µ–Ω—è–µ–º –ø–æ–¥–ø–∏—Å–∏
  roofContainer.querySelectorAll("label").forEach(lbl => {
  const inp = lbl.querySelector("input[name='roof']");
  if (!inp) return;
  const gableSurcharge = formatPrice(grossInt(1800)); // 1800 ‚Üí 1980 ‚ÇΩ/–º¬≤
  lbl.childNodes[1].nodeValue = inp.value === "lom"
    ? (type==="house" ? " –ù–∏–∑–∫–∏–π —Å–∫–∞—Ç" : " –û–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è (–±–∞–∑–æ–≤–∞—è)")
    : (type==="house" ? " –î–≤—É—Å–∫–∞—Ç–Ω–∞—è" : ` –î–≤—É—Å–∫–∞—Ç–Ω–∞—è (+${gableSurcharge} ‚ÇΩ/–º¬≤)`);
});


  // 8) —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç—ã –∏ —á–µ–∫–±–æ–∫—Å—ã
[selInsul, selRoofMat, selInRep, selOutRep, selPart].forEach(sel => {
  if (!sel) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
  
  // 1. —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏
  Array.from(sel.options).forEach(o => o.disabled = false);

  // 2. —Å—Ç–∞–≤–∏–º –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  if (sel.options.length) sel.value = sel.options[0].value;

  // 3. –ø–æ–∫–∞–∑—ã–≤–∞–µ–º label (–µ—Å–ª–∏ –≤–¥—Ä—É–≥ –±—ã–ª —Å–∫—Ä—ã—Ç)
  if (sel.closest('label')) {
  sel.closest('label').style.display = 'block';
  }
});
// -------------------------
// —É–∂–µ –∑–∞—Ç–µ–º ‚Äì —Ç–æ, —á—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º
// -------------------------
selFloor.value = "plain";        // –±–∞–∑–æ–≤—ã–π –ø–æ–ª


// –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ö–æ–∑–±–ª–æ–∫ ‚Äì –ø—Ä—è—á–µ–º —É—Ç–µ–ø–ª–µ–Ω–∏–µ
if (selType.value === 'hoblok' && selInsul) {
  selInsul.value = 'none';                       // —Å—Ç–∞–≤–∏–º ¬´–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π¬ª
  if (selInsul.closest('label')) {
  selInsul.closest('label').style.display = 'none'; // —Å–∞–º label –ø—Ä—è—á–µ–º
  }
} else if (selInsul && selInsul.closest('label')) {
  selInsul.closest('label').style.display = '';  // –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–µ–Ω–∏—è—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
}
// –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º –í–°–ï —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è
if (isEconomy) {
  // –°–∫—Ä—ã–≤–∞–µ–º –í–°–ï —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è - —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
  if (selInRep?.closest('label')) selInRep.closest('label').style.display = 'none';
  if (selOutRep?.closest('label')) selOutRep.closest('label').style.display = 'none';
  const verandaBlock = document.querySelector('.extras--veranda');
  if (verandaBlock) verandaBlock.style.display = 'none';
  const roofBlock = document.querySelector('input[name="roof"]')?.closest('.roof');
  if (roofBlock) roofBlock.style.display = 'none';
  // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –±–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –∫—Ä—ã—à–∏
  const oldRoofContainer = document.getElementById('roofContainer');
  if (oldRoofContainer) oldRoofContainer.style.display = 'none';
  if (selRoofMat?.closest('label')) selRoofMat.closest('label').style.display = 'none';
  if (selFloor?.closest('label')) selFloor.closest('label').style.display = 'none';
  const heightBlock = document.getElementById('inpExtraH')?.closest('.opt-box');
  if (heightBlock) heightBlock.style.display = 'none';
  if (chkMouse?.closest('label')) chkMouse.closest('label').style.display = 'none';
  
  // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏" –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
  const standardExtrasCards = document.querySelectorAll('.section-card h2');
  standardExtrasCards.forEach(h2 => {
    if (h2.textContent === '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏' && !h2.textContent.includes('—ç–∫–æ–Ω–æ–º')) {
      h2.closest('.section-card').style.display = 'none';
    }
  });
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±–ª–æ–∫ —ç–∫–æ–Ω–æ–º-–æ–ø—Ü–∏–π
  const economyExtras = document.getElementById('economyExtras');
  if (economyExtras) {
    economyExtras.style.display = 'block';
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const economyDeliveryOptions = document.getElementById('economyDeliveryOptions');
  if (economyDeliveryOptions) {
    economyDeliveryOptions.style.display = 'block';
  }
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π —Ç–æ–ª—å–∫–æ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–µ–∫
  if (cfg.isEconomy) {
    updateSvaiRecommendation();
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–µ—Ä–∞–Ω–¥
  updateVerandaOptions();
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤–∞–∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ª–∏–Ω–µ–µ–∫
  if (!cfg.isEconomy) {
    populatePileOptions();
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä–∞–Ω–¥—ã –∏ —Å–≤–∞–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–µ–Ω–∏–π
  [inpWidth, inpLength].forEach(el => {
    el.addEventListener("change", () => {
      updateVerandaOptions();
      if (!cfg.isEconomy) {
        populatePileOptions();
      } else {
        populateEconomyPileOptions();
      }
    });
    el.addEventListener("input", () => {
      updateVerandaOptions();
      if (!cfg.isEconomy) {
        populatePileOptions();
      } else {
        populateEconomyPileOptions();
      }
    });
  });
  
  // –°–∫—Ä—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ —É—Ç–µ–ø–ª–µ–Ω–∏—è –¥–ª—è —Ö–æ–∑–±–ª–æ–∫–æ–≤ —ç–∫–æ–Ω–æ–º
  if (type === 'hoblok_economy') {
    const insulationOptions = document.querySelectorAll('#chkCeilingInsulation, #chkInsulation100, #chkVaporBarrier');
    insulationOptions.forEach(option => {
      if (option?.closest('label')) {
        option.closest('label').style.display = 'none';
      }
    });
  } else if (type === 'bytovka_economy') {
    // –î–ª—è –±—ã—Ç–æ–≤–æ–∫ —ç–∫–æ–Ω–æ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ —É—Ç–µ–ø–ª–µ–Ω–∏—è
    const insulationOptions = document.querySelectorAll('#chkCeilingInsulation, #chkInsulation100, #chkVaporBarrier');
    insulationOptions.forEach(option => {
      if (option?.closest('label')) {
        option.closest('label').style.display = '';
      }
    });
  }
} else {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –¥–ª—è –æ–±—ã—á–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
  if (selInRep?.closest('label')) selInRep.closest('label').style.display = '';
  if (selOutRep?.closest('label')) selOutRep.closest('label').style.display = '';
  const verandaBlock = document.querySelector('.extras--veranda');
  if (verandaBlock) verandaBlock.style.display = 'block';
  const roofBlock = document.querySelector('input[name="roof"]')?.closest('.roof');
  if (roofBlock) roofBlock.style.display = 'block';
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –±–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –∫—Ä—ã—à–∏ –¥–ª—è –æ–±—ã—á–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
  const oldRoofContainer = document.getElementById('roofContainer');
  if (oldRoofContainer) oldRoofContainer.style.display = 'block';
  if (selRoofMat?.closest('label')) selRoofMat.closest('label').style.display = 'block';
  if (selFloor?.closest('label')) selFloor.closest('label').style.display = 'block';
  const heightBlock = document.getElementById('inpExtraH')?.closest('.opt-box');
  if (heightBlock) heightBlock.style.display = 'block';
  if (chkMouse?.closest('label')) chkMouse.closest('label').style.display = 'block';
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏" –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
  const standardExtrasCards = document.querySelectorAll('.section-card h2');
  standardExtrasCards.forEach(h2 => {
    if (h2.textContent === '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏' && !h2.textContent.includes('—ç–∫–æ–Ω–æ–º')) {
      h2.closest('.section-card').style.display = 'block';
    }
  });
  
  // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ —ç–∫–æ–Ω–æ–º-–æ–ø—Ü–∏–π
  const economyExtras = document.getElementById('economyExtras');
  if (economyExtras) economyExtras.style.display = 'none';
  
  // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const economyDeliveryOptions = document.getElementById('economyDeliveryOptions');
  if (economyDeliveryOptions) {
    economyDeliveryOptions.style.display = 'none';
  }
}


  // 9) –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ –ø–æ —Ç–∏–ø—É —Å—Ç—Ä–æ–µ–Ω–∏—è
  if (type === "house") {
    // selInsul.querySelector('option[value="roll100"]').disabled = true;
  }
  // selRoofMat.querySelector('option[value="galv"]').disabled = true;
  if (type==="house") {
    const roof = document.querySelector('input[name="roof"]:checked').value;
    selOutRep.querySelector(`option[value="${roof==="lom"?"vag_ext":"imitBC_ext"}"]`).disabled = true;
  } else {
    // selOutRep.querySelector('option[value="vag_ext"]').disabled = true;
  }

  // (–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–≥–¥–∞)
  // 10) —Å–±—Ä–æ—Å –≤–µ—Ä–∞–Ω–¥—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π
  inpVerWidth.value = "";
  inpVerDepth.value = "";
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ —Å–≤–∞–π
  const standardPilesBlock = document.getElementById('standardPilesBlock');
  const economyPilesBlock = document.getElementById('economyPilesBlock');
  
  if (!cfg.isEconomy) {
    if (standardPilesBlock) standardPilesBlock.style.display = 'block';
    if (economyPilesBlock) economyPilesBlock.style.display = 'none';
  populatePileOptions();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ª–∏–Ω–µ–µ–∫
    const pileHint = document.getElementById('pileHint');
    if (pileHint) {
      pileHint.textContent = 'üí° –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ä–∞–∑–º–µ—Ä—É —Å—Ç—Ä–æ–µ–Ω–∏—è';
    }
  } else {
    if (standardPilesBlock) standardPilesBlock.style.display = 'none';
    if (economyPilesBlock) economyPilesBlock.style.display = 'block';
    populateEconomyPileOptions();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–µ–∫
    const economyPileHint = document.getElementById('economyPileHint');
    if (economyPileHint) {
      economyPileHint.textContent = 'üí° –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–±–∏—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞–∑–º–µ—Ä—É';
    }
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –±–∞–∑—ã –Ω–∞ –∫–∞—Ä—Ç–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
  updateBaseMarkerOnMap(type);
  
  updateStaticPriceLabels();
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–∞ –±–∞–∑—ã –Ω–∞ –∫–∞—Ä—Ç–µ
function updateBaseMarkerOnMap(type) {
  if (typeof map === 'undefined' || !map) return;
  
  // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –º–∞—Ä–∫–µ—Ä—ã –±–∞–∑—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç –µ—Å–ª–∏ –µ—Å—Ç—å)
  const objectsToRemove = [];
  
  // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ geoObjects –≤ Yandex Maps
  map.geoObjects.each(function(obj) {
    try {
      if (obj.properties && obj.properties.get && obj.properties.get('isBaseMarker')) {
      objectsToRemove.push(obj);
      }
    } catch (e) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–≤–æ–π—Å—Ç–≤
    }
  });
  
  objectsToRemove.forEach(obj => {
    try {
      map.geoObjects.remove(obj);
    } catch (e) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
    }
  });
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –±–∞–∑—É
  const isEconomy = type.includes('economy');
  const depot = isEconomy ? DEPOT_ECONOMY : DEPOT;
  const baseName = isEconomy ? '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —ç–∫–æ–Ω–æ–º-—Å—Ç—Ä–æ–µ–Ω–∏–π' : '–û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞';
  
  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä –±–∞–∑—ã
  const baseMarker = new ymaps.Placemark(depot, {
    balloonContent: baseName,
    isBaseMarker: true
  }, {
    preset: 'islands#redDotIcon'
  });
  map.geoObjects.add(baseMarker);
}


/* ------------------------------------------------------------------
   6. populatePileOptions ‚Äî –Ω–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç —Å–≤–∞—è–º–∏
------------------------------------------------------------------ */
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ –≤ —Å–µ–ª–µ–∫—Ç–µ —Å–≤–∞–π
function updatePileSelectText(selSvaiType, dim, cnt, pricePerPile) {
  if (!selSvaiType || !selSvaiType.value || selSvaiType.value !== dim) return;
  
  const selectedOption = Array.from(selSvaiType.options).find(opt => opt.value === dim);
  if (!selectedOption) return;
  
  // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ change
  selSvaiType.setAttribute('data-updating', 'true');
  
  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—É
  let totalPrice;
  let priceWithMarkup;
  
  if (dim === "1.5√ó76" && cnt >= 16) {
    priceWithMarkup = grossInt(3350); // 3350‚ÇΩ/—à—Ç –¥–ª—è 16+ —à—Ç—É–∫ + 10%
    totalPrice = priceWithMarkup * cnt;
  } else {
    priceWithMarkup = grossInt(pricePerPile); // —Ü–µ–Ω–∞ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
    totalPrice = priceWithMarkup * cnt;
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ–ø—Ü–∏–∏
  selectedOption.textContent = `${dim} √ó ${cnt} —à—Ç ‚Äî ${formatPrice(totalPrice)} ‚ÇΩ (${formatPrice(priceWithMarkup)} ‚ÇΩ/—à—Ç)`;
  
  // –í–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—Ä–∞—Ç–Ω–æ
  selSvaiType.removeAttribute('data-updating');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –æ–ø—Ü–∏–π –≤ —Å–µ–ª–µ–∫—Ç–µ —Å–≤–∞–π —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
function updateAllPileOptions(selSvaiType, verandaWidthForPiles, isInsideVeranda, l, w) {
  if (!selSvaiType || !selSvaiType.options || selSvaiType.options.length === 0) return;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  const currentValue = selSvaiType.value;
  const currentIndex = selSvaiType.selectedIndex;
  
  // –ö–†–ò–¢–ò–ß–ù–û: –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ change, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≤—ã–∑–æ–≤–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  // –ø—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ value
  selSvaiType.setAttribute('data-updating', 'true');
  
  // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö —Ç–µ–∫—Å—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–≤–∞–π
  Array.from(selSvaiType.options).forEach(option => {
    if (!option.value) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
    
    const dim = option.value;
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π —Å —É—á–µ—Ç–æ–º –≤–µ—Ä–∞–Ω–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø—Ü–∏–∏
    const cnt = calculatePilesByRows(l, w, verandaWidthForPiles, isInsideVeranda);
    
    // –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –∑–∞ —Å–≤–∞—é (–ë–ï–ó –Ω–∞—Ü–µ–Ω–∫–∏)
    const pricePerPile = PILES_STANDARD[dim];
    if (!pricePerPile) return;
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—É
    let totalPrice;
    let priceWithMarkup;
    
    if (dim === "1.5√ó76" && cnt >= 16) {
      priceWithMarkup = grossInt(3350); // 3350‚ÇΩ/—à—Ç –¥–ª—è 16+ —à—Ç—É–∫ + 10%
      totalPrice = priceWithMarkup * cnt;
    } else {
      priceWithMarkup = grossInt(pricePerPile); // —Ü–µ–Ω–∞ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
      totalPrice = priceWithMarkup * cnt;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ–ø—Ü–∏–∏
    option.textContent = `${dim} √ó ${cnt} —à—Ç ‚Äî ${formatPrice(totalPrice)} ‚ÇΩ (${formatPrice(priceWithMarkup)} ‚ÇΩ/—à—Ç)`;
  });
  
  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ selectedIndex (—ç—Ç–æ –Ω–µ –≤—ã–∑–æ–≤–µ—Ç change)
  if (currentIndex >= 0 && currentIndex < selSvaiType.options.length) {
    selSvaiType.selectedIndex = currentIndex;
  } else if (currentValue) {
    const option = Array.from(selSvaiType.options).find(opt => opt.value === currentValue);
    if (option) {
      selSvaiType.selectedIndex = Array.from(selSvaiType.options).indexOf(option);
    }
  }
  
  // –í–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—Ä–∞—Ç–Ω–æ
  selSvaiType.removeAttribute('data-updating');
}

function populatePileOptions () {
  const type = selType.value;
  const w    = +inpWidth.value;
  const l    = +inpLength.value;


  // –ü–†–û–í–ï–†–Ø–ï–ú: –µ—Å–ª–∏ —ç—Ç–æ —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∞, –ù–ï –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–≤–∞–∏ –∑–¥–µ—Å—å!
  const cfg = CONFIG[type];
  if (cfg.isEconomy) {
    return;
  }

  // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–µ—Ä–∞–Ω–¥—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–∞–π
  const inpVerWidth = document.getElementById('verWidth');
  const inpVerDepth = document.getElementById('verDepth');
  const chkInVer = document.getElementById('chkInVer');
  const vw = inpVerWidth ? (parseFloat(inpVerWidth.value) || 0) : 0;
  const isInsideVer = chkInVer ? chkInVer.checked : false;
  
  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –≤–µ—Ä–∞–Ω–¥—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–≤–∞–π
  let verandaWidthForPiles = 0;
  if (type === 'house' && vw > 0 && !isInsideVer) {
    verandaWidthForPiles = vw;
  }

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ —Å–≤–∞–π –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –° –£–ß–ï–¢–û–ú –í–ï–†–ê–ù–î–´
  // –í –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ: w = —à–∏—Ä–∏–Ω–∞ (inpWidth), l = –¥–ª–∏–Ω–∞ (inpLength)
  // –§—É–Ω–∫—Ü–∏—è calculatePilesByRows –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ä—è–¥–æ–≤
  // (–≤–¥–æ–ª—å –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã), –ø–æ—ç—Ç–æ–º—É –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω
  const cnt = calculatePilesByRows(l, w, verandaWidthForPiles, isInsideVer);

  // üëâ  –¥–ª—è –¥–æ–º–æ–≤ √ò76 –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º (–µ—Å–ª–∏ –±–æ–ª—å—à–µ 12 —Å–≤–∞–π)
  const skip76 = (type === "house" && cnt > 12);

  const selSvaiType = document.getElementById('selSvaiType');
  if (selSvaiType) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–ø—Ü–∏–π
    const currentValue = selSvaiType.value;
    
    selSvaiType.innerHTML = '<option value="">‚Äî –±–µ–∑ —Å–≤–∞–π ‚Äî</option>';

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º PILES_STANDARD –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ª–∏–Ω–µ–µ–∫ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
    Object.entries(PILES_STANDARD).forEach(([dim, pricePerUnit]) => {
      if (skip76 && dim.includes("√ó76")) return;
      if (dim === "1.5√ó76" && cnt > 12) return;

      const priceWithMarkup = grossInt(pricePerUnit); // —Ü–µ–Ω–∞ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
      const totalPrice = priceWithMarkup * cnt; // –∏—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ –∑–∞ –≤—Å–µ —Å–≤–∞–∏
      
      selSvaiType.innerHTML +=
        `<option value="${dim}">${dim} √ó ${cnt} —à—Ç ‚Äî ${formatPrice(totalPrice)} ‚ÇΩ (${formatPrice(priceWithMarkup)} ‚ÇΩ/—à—Ç)</option>`;
    });
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ü–∏–π
    if (currentValue) {
      const option = Array.from(selSvaiType.options).find(opt => opt.value === currentValue);
      if (option) {
        // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ change –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è
        selSvaiType.setAttribute('data-updating', 'true');
        selSvaiType.value = currentValue;
        selSvaiType.removeAttribute('data-updating');
      }
    }
    
    // –ö–†–ò–¢–ò–ß–ù–û: –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ü–∏–π –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö —Å —É—á–µ—Ç–æ–º –≤–µ—Ä–∞–Ω–¥—ã
    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–µ—Ä–∞–Ω–¥—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
    const inpVerWidth = document.getElementById('verWidth');
    const chkInVer = document.getElementById('chkInVer');
    const vw = inpVerWidth ? (parseFloat(inpVerWidth.value) || 0) : 0;
    const isInsideVer = chkInVer ? chkInVer.checked : false;
    let verandaWidthForPiles = 0;
    if (type === 'house' && vw > 0 && !isInsideVer) {
      verandaWidthForPiles = vw;
    }
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –≤–µ—Ä–∞–Ω–¥—ã
    updateAllPileOptions(selSvaiType, verandaWidthForPiles, isInsideVer, l, w);
  }
}

/* ------------------------------------------------------------------
   7. addWindowRow ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É ¬´–û–∫–Ω–æ / –¥–≤–µ—Ä—å¬ª
------------------------------------------------------------------ */
function addWindowRow () {
  const clone = tmplWindowRow.content.cloneNode(true);
  const row   = clone.querySelector(".window-row");

  const selType = row.querySelector(".win-type");   // pvcWin | woodWin | pvcDoor | woodDoor
  const selCam  = row.querySelector(".win-cam");    // 1-–∫–∞–º / 2-–∫–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –ü–í–•-–æ–∫–æ–Ω)
  const selSize = row.querySelector(".win-size");   // —Ä–∞–∑–º–µ—Ä—ã / –≤–∞—Ä–∏–∞–Ω—Ç—ã
  const qtyInp  = row.querySelector(".win-qty");
  const btnX    = row.querySelector(".btnRemoveWindow");

  const DOOR_CAPTION = {
    std:"–û–±—ã—á–Ω–∞—è", hinge:"–†–∞—Å–ø–∞—à–Ω–∞—è", hingeWarm:"–†–∞—Å–ø–∞—à–Ω–∞—è —É—Ç–µ–ø–ª—ë–Ω–Ω–∞—è", filen:"–§–∏–ª–µ–Ω—á–∞—Ç–∞—è"
  };

  function rebuild () {
    const t = selType.value;
    selCam.style.display = (t === "pvcWin") ? "" : "none";
    selSize.innerHTML = '<option value="">‚Äî —Ä–∞–∑–º–µ—Ä / —Ç–∏–ø ‚Äî</option>';

    if (t === "pvcWin") {
      const cam = selCam.value;
      Object.entries(WINDOWS).forEach(([sz, cams]) => {
        if (cams[cam]) {
          const pGross = grossInt(cams[cam]);
          selSize.innerHTML += `<option value="${sz}">${sz} (${formatPrice(pGross)} ‚ÇΩ)</option>`;
        }
      });

    } else if (t === "pvcDoor") {
      Object.entries(WINDOWS).forEach(([sz, cams]) => {
        if (sz.includes("–¥–≤–µ—Ä—å –ü–í–•")) {
          const p = cams[2] || cams[1];
          const pGross = grossInt(p);
          selSize.innerHTML += `<option value="${sz}">${sz} (${formatPrice(pGross)} ‚ÇΩ)</option>`;
        }
      });

    } else if (t === "woodWin") {
      Object.entries(WOOD_PRICES.win).forEach(([sz, p]) => {
        selSize.innerHTML += `<option value="${sz}">${sz} (${formatPrice(grossInt(p))} ‚ÇΩ)</option>`;
      });

    } else if (t === "woodDoor") {
      Object.entries(WOOD_PRICES.door).forEach(([key, p]) => {
        selSize.innerHTML +=
          `<option value="${key}">${DOOR_CAPTION[key]} (${formatPrice(grossInt(p))} ‚ÇΩ)</option>`;
      });

    } else if (t === "metalDoor") {
      const CAPTION = {
        rf:"–î–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¢—É–ª–∞",
        rfThermo:"–î–≤–µ—Ä—å –†–§ (—Ç–µ—Ä–º–æ)",
        thermoLux:"–î–≤–µ—Ä—å —Ç–µ—Ä–º–æ–ª—é–∫—Å"
      };
      Object.entries(METAL_PRICES).forEach(([code, p]) => {
        selSize.innerHTML +=
          `<option value="${code}">${CAPTION[code]} (${formatPrice(grossInt(p))} ‚ÇΩ)</option>`;
      });
    }
  }

  selType.addEventListener("change", function() {
    rebuild();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  selCam.addEventListener("change", function() {
    rebuild();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  selSize.addEventListener("change", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  qtyInp.addEventListener("change", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  qtyInp.addEventListener("input", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –≤–≤–æ–¥–µ
  });
  btnX.addEventListener("click", function() {
    row.remove();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
  });

  rebuild();
  windowsContainer.appendChild(row);
}

/* ------------------------------------------------------------------
   7a. addPartitionRow ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
------------------------------------------------------------------ */
function addPartitionRow() {
  const clone = document.getElementById("tmplPartitionRowEconomy").content.cloneNode(true);
  const row = clone.querySelector(".partition-row");
  
  const materialSelect = row.querySelector(".partition-material");
  const sizeSelect = row.querySelector(".partition-size");
  const qtyInput = row.querySelector(".partition-qty");
  const removeBtn = row.querySelector(".btnRemovePartition");
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞
  materialSelect.addEventListener("change", function() {
    updatePartitionSizesInRow(row);
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
  sizeSelect.addEventListener("change", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
  qtyInput.addEventListener("change", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  qtyInput.addEventListener("input", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –≤–≤–æ–¥–µ
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è
  removeBtn.addEventListener("click", function() {
    row.remove();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
  });
  
  // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
  document.getElementById("partitionsContainerEconomy").appendChild(row);
}

/* ------------------------------------------------------------------
   7b. updatePartitionSizesInRow ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
------------------------------------------------------------------ */
function updatePartitionSizesInRow(row) {
  const material = row.querySelector(".partition-material").value;
  const sizeSelect = row.querySelector(".partition-size");
  
  // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–∑–º–µ—Ä–æ–≤
  sizeSelect.innerHTML = '<option value="">‚Äî —Ä–∞–∑–º–µ—Ä ‚Äî</option>';
  
  if (!material) {
    sizeSelect.disabled = true;
    return;
  }
  
  // –í–∫–ª—é—á–∞–µ–º –≤—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞
  sizeSelect.disabled = false;
  
  // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞
  const sizes = {
    'organlit': [
      { value: '2', text: '2–º(2,2) ‚Äî 6 600‚ÇΩ' },
      { value: '2.5', text: '2,5–º ‚Äî 7 700‚ÇΩ' },
      { value: '3', text: '3–º ‚Äî 8 250‚ÇΩ' }
    ],
    'osb': [
      { value: '2', text: '2–º(2,2) ‚Äî 7 700‚ÇΩ' },
      { value: '2.5', text: '2,5–º ‚Äî 8 800‚ÇΩ' },
      { value: '3', text: '3–º ‚Äî 9 900‚ÇΩ' }
    ],
    'vagonka': [
      { value: '2', text: '2–º(2,2) ‚Äî 13 200‚ÇΩ' },
      { value: '2.5', text: '2,5–º ‚Äî 15 950‚ÇΩ' },
      { value: '3', text: '3–º ‚Äî 16 500‚ÇΩ' }
    ],
    'hoblok': [
      { value: '2', text: '2–º(2,2) ‚Äî 5 500‚ÇΩ' },
      { value: '2.5', text: '2,5–º ‚Äî 7 150‚ÇΩ' },
      { value: '3', text: '3–º ‚Äî 8 250‚ÇΩ' }
    ]
  };
  
  const materialSizes = sizes[material] || [];
  materialSizes.forEach(size => {
    const option = document.createElement('option');
    option.value = `${material}_${size.value}`;
    option.textContent = size.text;
    sizeSelect.appendChild(option);
  });
}
/* ------------------------------------------------------------------
   7b. addWindowRowEconomy ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É ¬´–û–∫–Ω–æ / –¥–≤–µ—Ä—å¬ª –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
------------------------------------------------------------------ */
function addWindowRowEconomy () {
  const clone = tmplWindowRowEconomy.content.cloneNode(true);
  const row   = clone.querySelector(".window-row");

  const selType = row.querySelector(".win-type");   // pvcWin | woodWin | pvcDoor | woodDoor
  const selCam  = row.querySelector(".win-cam");    // 1-–∫–∞–º / 2-–∫–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –ü–í–•-–æ–∫–æ–Ω)
  const selSize = row.querySelector(".win-size");   // —Ä–∞–∑–º–µ—Ä—ã / –≤–∞—Ä–∏–∞–Ω—Ç—ã
  const qtyInp  = row.querySelector(".win-qty");
  const btnX    = row.querySelector(".btnRemoveWindow");

  const DOOR_CAPTION = {
    wooden_set:"–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –Ω–∞–±–æ—Ä–Ω–∞—è 75√ó175", 
    wooden_swing:"–†–∞—Å–ø–∞—à–Ω–∞—è (—à–∏—Ä–∏–Ω–∞ 160)", 
    interior_pine:"–ú–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è —Å–æ—Å–Ω–æ–≤–∞—è"
  };

  function rebuild () {
    const t = selType.value;
    selCam.style.display = (t === "pvcWin") ? "" : "none";
    selSize.innerHTML = '<option value="">‚Äî —Ä–∞–∑–º–µ—Ä / —Ç–∏–ø ‚Äî</option>';

    if (t === "pvcWin") {
      const cam = selCam.value;
      // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–∫–∞–º–µ—Ä–Ω—ã–µ –æ–∫–Ω–∞
      if (cam === "1") {
        Object.entries(ECONOMY_WINDOWS).forEach(([sz, cams]) => {
          if (cams[cam]) {
            const pGross = cams[cam]; // —É–∂–µ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%
            selSize.innerHTML += `<option value="${sz}">${sz} (${formatPrice(pGross)} ‚ÇΩ)</option>`;
          }
        });
      }

    } else if (t === "pvcDoor") {
      Object.entries(ECONOMY_WINDOWS).forEach(([sz, cams]) => {
        if (sz.includes("–¥–≤–µ—Ä—å –ü–í–•")) {
          const p = cams[2] || cams[1];
          selSize.innerHTML += `<option value="${sz}">${sz} (${formatPrice(p)} ‚ÇΩ)</option>`;
        }
      });

    } else if (t === "woodWin") {
      Object.entries(ECONOMY_WOOD_PRICES.win).forEach(([sz, p]) => {
        selSize.innerHTML += `<option value="${sz}">${sz} (${formatPrice(p)} ‚ÇΩ)</option>`;
      });

    } else if (t === "woodDoor") {
      Object.entries(ECONOMY_WOOD_PRICES.door).forEach(([key, p]) => {
        selSize.innerHTML +=
          `<option value="${key}">${DOOR_CAPTION[key]} (${formatPrice(p)} ‚ÇΩ)</option>`;
      });

    } else if (t === "metalDoor") {
      Object.entries(ECONOMY_METAL_PRICES).forEach(([code, p]) => {
        selSize.innerHTML +=
          `<option value="${code}">–î–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¢—É–ª–∞ (${formatPrice(p)} ‚ÇΩ)</option>`;
      });
    }
  }

  selType.addEventListener("change", function() {
    rebuild();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  selCam.addEventListener("change", function() {
    rebuild();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  selSize.addEventListener("change", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  qtyInp.addEventListener("change", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  });
  qtyInp.addEventListener("input", function() {
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ –≤–≤–æ–¥–µ
  });
  btnX.addEventListener("click", function() {
    row.remove();
    calculate(); // –û–±–Ω–æ–≤–ª—è–µ–º –ö–ü –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
  });

  rebuild();
  document.getElementById("windowsContainerEconomy").appendChild(row);
}

// –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
const MATERIAL_NAME = {
  osb:"–û–°–ë –≤–ª–∞–≥–æ—Å—Ç–æ–π–∫–∞—è",
  vagBC:"–í–∞–≥–æ–Ω–∫–∞ B –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è",
  vagA:"–í–∞–≥–æ–Ω–∫–∞ A (–æ—Ç–±–æ—Ä–Ω–∞—è)",
  imitB:"–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ B —Å—Ç–∞–Ω–¥–∞—Ä—Ç",
  imitA:"–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ A (–æ—Ç–±–æ—Ä–Ω—ã–π)",
  block:"–ë–ª–æ–∫-—Ö–∞—É—Å",
  profGalv: "–ü—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π"

};
// –ü—Ä—è–º—ã–µ —Ü–µ–Ω—ã –∑–∞–º–µ–Ω—ã (‚ÇΩ/–º¬≤)
const REPLACEMENT_PRICES = {
  osb:   { vagBC:120, vagA:500, imitB:350, imitA:520, block:1120 },
  vagBC: { vagA:380, imitB:250, imitA:400, block:1000, profGalv:750 },
  imitB: { imitA:750, block:600, vagA:150 }
};

// ‚ñ∏ –¥–æ–ø–ª–∞—Ç–∞ –∑–∞ –∫–∞–∂–¥—ã–µ 10 —Å–º –≤—ã—Å–æ—Ç—ã, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–ª–æ—â–∞–¥–∏ —Å—Ç—Ä–æ–µ–Ω–∏—è
function pricePer10cm(area){          // —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ–º –≥–æ—Ç–æ–≤—ã–µ –º¬≤
  if (area <= 17) return 5000;
  if (area <= 23) return 10000;
  if (area <= 47) return 13000;
  return 16000;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// –í–°–¢–ê–í–õ–Ø–ï–ú –ó–î–ï–°–¨ ‚Äî –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ calculate()
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MODULES = [3, 2.5, 2];   // —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ¬´–∫—É—Å–∫–∏¬ª –¥–ª–∏–Ω—ã

/**
 * –°–æ–±–∏—Ä–∞–µ—Ç —Ü–µ–Ω—É –∏–∑ –º–æ–¥—É–ª–µ–π 3 / 2.5 / 2 –º.
 * @param {"bytovka"|"hoblok"} type
 * @param {number} w  ‚Äì —à–∏—Ä–∏–Ω–∞ (3-6 –º)
 * @param {number} l  ‚Äì –Ω—É–∂–Ω–∞—è –¥–ª–∏–Ω–∞ (2-6 –º + ‚Ä¶)
 * @returns {number|null} ‚Äì —Å—É–º–º–∞ –∏–ª–∏ null, –µ—Å–ª–∏ —Å–æ–±—Ä–∞—Ç—å –Ω–µ–ª—å–∑—è
 */
function getModPrice(type, w, l) {
  const tbl = (type === "hoblok")
              ? CONFIG.hoblok.basePrice
              : CONFIG.bytovka.basePrice;

  let rest = l, sum = 0;

  for (const m of MODULES) {
    while (rest >= m - 0.001) {
      const key   = `${w}x${m}`;
      const price = tbl[key];
      if (!price) return null;         // –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –∫—É—Å–∫–∞ ‚áí –æ—Ç–±–æ–π
      sum  += price;
      rest -= m;
      rest  = +rest.toFixed(2);        // —É–±–∏—Ä–∞–µ–º —Ö–≤–æ—Å—Ç—ã 1e-15
    }
  }
  return rest < 0.01 ? sum : null;     // –µ—Å–ª–∏ ¬´—Ö–≤–æ—Å—Ç¬ª –æ—Å—Ç–∞–ª—Å—è ‚áí null
}

// –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –≥—Ä—É–ø–ø–∞–º
function groupKomplektatsiya(pkg, format = 'whatsapp') {
  if (!pkg || pkg.length === 0) return [];
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–≤–µ–∑–¥–æ—á–∫–∏ –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
  const useBold = format === 'whatsapp';
  
  // –ì—Ä—É–ø–ø—ã –≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–≤–æ–¥–∞
  const groups = {
    karkas: [],           // 1. –ö–∞—Ä–∫–∞—Å –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ
    fundament: [],        // 2. –§—É–Ω–¥–∞–º–µ–Ω—Ç
    uteplenie: [],        // 3. –£—Ç–µ–ø–ª–µ–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞
    krysha: [],           // 4. –ö—Ä—ã—à–∞ –∏ –∫—Ä–æ–≤–ª—è
    otdelka: {            // 5. –û—Ç–¥–µ–ª–∫–∞ (–æ—Å–æ–±–∞—è –≥—Ä—É–ø–ø–∞ —Å –ø–æ–¥–ø—É–Ω–∫—Ç–∞–º–∏)
      naruzhnaya: [],
      vnutrennyaya: []
    },
    steny: [],            // 6. –°—Ç–µ–Ω—ã –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    oknaDveri: [],        // 7. –û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏
    pol: [],              // 8. –ü–æ–ª
    veranda: [],          // 9. –í–µ—Ä–∞–Ω–¥—ã –∏ –ø—Ä–∏—Å—Ç—Ä–æ–π–∫–∏
    razmery: [],          // 10. –†–∞–∑–º–µ—Ä—ã –∏ –≤—ã—Å–æ—Ç–∞
    prochee: []           // 11. –ü—Ä–æ—á–µ–µ
  };
  
  // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –≥—Ä—É–ø–ø–∞–º
  pkg.forEach(item => {
    const lower = item.toLowerCase();
    const trimmed = item.trim();
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "‚Äì " –∏–ª–∏ "- " –∏ –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ
    const clean = trimmed.replace(/^[‚Äì-]\s*/, '').replace(/^\s+/, '').trim();
    const cleanLower = clean.toLowerCase();
    
    // 1) –û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏ (–ø–µ—Ä–≤—ã–º–∏!)
    if (lower.includes('–æ–∫–Ω–æ') || lower.includes('–¥–≤–µ—Ä—å') || lower.includes('–¥–≤–µ—Ä–∏')) {
      groups.oknaDveri.push(item);
    
    // 2) –û—Ç–¥–µ–ª–∫–∞ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –î–û –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –ø–æ–¥–ø—É–Ω–∫—Ç—ã)
    } else if (trimmed === '‚Äì –û—Ç–¥–µ–ª–∫–∞' || trimmed === '- –û—Ç–¥–µ–ª–∫–∞') {
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–û—Ç–¥–µ–ª–∫–∞" - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º, –æ–Ω –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏ –≤—ã–≤–æ–¥–µ
    } else if (cleanLower.startsWith('–Ω–∞—Ä—É–∂–Ω–∞—è:')) {
      // –ü–æ–¥–ø—É–Ω–∫—Ç –Ω–∞—Ä—É–∂–Ω–æ–π –æ—Ç–¥–µ–ª–∫–∏ (–ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç: "  –ù–∞—Ä—É–∂–Ω–∞—è:", "‚Äì –ù–∞—Ä—É–∂–Ω–∞—è:", "–ù–∞—Ä—É–∂–Ω–∞—è:")
      const text = clean.replace(/^–Ω–∞—Ä—É–∂–Ω–∞—è\s*:\s*/i, '').trim();
      if (text) groups.otdelka.naruzhnaya.push(text);
    } else if (cleanLower.startsWith('–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è:')) {
      // –ü–æ–¥–ø—É–Ω–∫—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—Ç–¥–µ–ª–∫–∏ (–ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç: "  –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è:", "‚Äì –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è:", "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è:")
      const text = clean.replace(/^–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è\s*:\s*/i, '').trim();
      if (text) groups.otdelka.vnutrennyaya.push(text);
    } else if (lower.includes('–Ω–∞—Ä—É–∂–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞') || 
               (lower.includes('–Ω–∞—Ä—É–∂–Ω–∞—è') && lower.includes('–æ—Ç–¥–µ–ª–∫–∞') && !lower.includes('–¥–≤–µ—Ä—å'))) {
      const text = clean.replace(/^–Ω–∞—Ä—É–∂–Ω–∞—è\s+–æ—Ç–¥–µ–ª–∫–∞\s*:\s*/i, '').trim();
      if (text) groups.otdelka.naruzhnaya.push(text);
    } else if (lower.includes('–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞') || 
               (lower.includes('–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è') && lower.includes('–æ—Ç–¥–µ–ª–∫–∞') && !lower.includes('–¥–≤–µ—Ä—å')) || 
               lower.includes('–æ—Ä–≥–∞–ª–∏—Ç')) {
      const text = clean.replace(/^–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è\s+–æ—Ç–¥–µ–ª–∫–∞\s*:\s*/i, '').trim();
      if (text) groups.otdelka.vnutrennyaya.push(text);
    
    // 3) –§—É–Ω–¥–∞–º–µ–Ω—Ç
    } else if (lower.includes('—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç') || lower.includes('—Å–≤–∞–π–Ω')) {
      groups.fundament.push(item);
    
    // 4) –í–µ—Ä–∞–Ω–¥—ã –∏ –ø—Ä–∏—Å—Ç—Ä–æ–π–∫–∏
    } else if (lower.includes('–≤–µ—Ä–∞–Ω–¥–∞') || lower.includes('—Ç–µ—Ä—Ä–∞—Å–∞') || lower.includes('–ø—Ä–∏—Å—Ç—Ä–æ–π')) {
      groups.veranda.push(item);
    
    // 5) –°—Ç–µ–Ω—ã –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    } else if (lower.includes('–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞') || (lower.includes('—Å—Ç–µ–Ω–∞') && !lower.includes('–ø–æ–ª–æ–∑—å—è'))) {
      groups.steny.push(item);
    
    // 6) –ö–∞—Ä–∫–∞—Å –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –î–û –ø–æ–ª–∞, —á—Ç–æ–±—ã –ø–æ–ª–æ–∑—å—è –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –ø–æ–ª)
    } else if (lower.includes('–æ–±–≤—è–∑–æ—á–Ω—ã–π –±—Ä—É—Å') || lower.startsWith('‚Äì –∫–∞—Ä–∫–∞—Å') || 
               lower.includes('–ø–æ–ª–æ–∑—å—è') || (lower.includes('–∫–∞—Ä–∫–∞—Å') && !lower.includes('–æ—Ç–¥–µ–ª–∫–∞'))) {
      groups.karkas.push(item);
    
    // 7) –ü–æ–ª (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ–ª–æ–∑—å—è)
    } else if ((lower.startsWith('‚Äì –ø–æ–ª') || lower.includes('–ø–æ–ª:')) && !lower.includes('–ø–æ–ª–æ–∑—å—è')) {
      groups.pol.push(item);
    
    // 8) –£—Ç–µ–ø–ª–µ–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞
    } else if (lower.includes('—É—Ç–µ–ø–ª–µ–Ω–∏–µ') || lower.includes('–≤–∞—Ç–∞') || 
               lower.includes('–≤–µ—Ç—Ä–æ') || lower.includes('–ø–∞—Ä–æ-') || 
               lower.includes('—Å–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª') || lower.includes('—Å–µ—Ç–∫–∞ "–∞–Ω—Ç–∏-–º—ã—à—å"')) {
      groups.uteplenie.push(item);
    
    // 9) –ö—Ä—ã—à–∞ –∏ –∫—Ä–æ–≤–ª—è
    } else if (lower.includes('–∫—Ä—ã—à–∞') || lower.includes('–∫—Ä–æ–≤–ª—è') || 
               lower.includes('–ø—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª') || lower.includes('–º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞') || 
               lower.includes('–æ–Ω–¥—É–ª–∏–Ω') || lower.includes('–ø—Ä–æ—Ñ–ª–∏—Å—Ç')) {
      groups.krysha.push(item);
    
    // 10) –†–∞–∑–º–µ—Ä—ã –∏ –≤—ã—Å–æ—Ç–∞
    } else if (lower.includes('–≤—ã—Å–æ—Ç–∞') || lower.includes('–≤—ã—Å–æ—Ç—É') || 
               lower.includes('+0,') || lower.includes('+ 0,') || 
               lower.includes('–ø–ª–æ—â–∞–¥—å') || lower.includes('—Ç—ë–ø–ª–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ')) {
      groups.razmery.push(item);
    
    // 11) –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ü—Ä–æ—á–µ–µ (–∏—Å–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
    } else {
      // –ò—Å–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–æ —Å–≤–∞–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫—É - –æ–Ω–∏ –∏–¥—É—Ç –≤ –±–ª–æ–∫ "–í–∞–∂–Ω–æ:"
      if (!lower.includes('–≤–Ω–∏–º–∞–Ω–∏–µ') && !lower.includes('–º–æ–Ω—Ç–∞–∂ —Å–≤–∞–π') && 
          !lower.includes('–¥–æ—Å—Ç–∞–≤–∫–∞: 60') && !lower.includes('–¥–æ—Å—Ç–∞–≤–∫–∞ 60')) {
        groups.prochee.push(item);
      }
      // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º - –æ–Ω–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –≤ importantNotes
    }
  });
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –≥—Ä—É–ø–ø
  const result = [];
  let isFirstGroup = true;
  
  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≥—Ä—É–ø–ø—ã
  const formatGroupTitle = (title) => {
    return useBold ? `‚Ä¢ *${title}*` : `‚Ä¢ ${title}`;
  };
  
  // 1. –ö–∞—Ä–∫–∞—Å –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ
  if (groups.karkas.length > 0) {
    if (!isFirstGroup) result.push(''); // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–µ—Ä–µ–¥ –≥—Ä—É–ø–ø–æ–π
    result.push(formatGroupTitle('–ö–∞—Ä–∫–∞—Å –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ'));
    result.push(...groups.karkas);
    isFirstGroup = false;
  }
  
  // 2. –§—É–Ω–¥–∞–º–µ–Ω—Ç
  if (groups.fundament.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–§—É–Ω–¥–∞–º–µ–Ω—Ç'));
    result.push(...groups.fundament);
    isFirstGroup = false;
  }
  
  // 3. –£—Ç–µ–ø–ª–µ–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞
  if (groups.uteplenie.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–£—Ç–µ–ø–ª–µ–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞'));
    result.push(...groups.uteplenie);
    isFirstGroup = false;
  }
  
  // 4. –ö—Ä—ã—à–∞ –∏ –∫—Ä–æ–≤–ª—è
  if (groups.krysha.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–ö—Ä—ã—à–∞ –∏ –∫—Ä–æ–≤–ª—è'));
    result.push(...groups.krysha);
    isFirstGroup = false;
  }
  
  // 5. –û—Ç–¥–µ–ª–∫–∞ (–æ—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
  if (groups.otdelka.naruzhnaya.length > 0 || groups.otdelka.vnutrennyaya.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–û—Ç–¥–µ–ª–∫–∞'));
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ª–∏ –Ω–∞—Ä—É–∂–Ω–∞—è –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞
    const naruzh = groups.otdelka.naruzhnaya[0] || '';
    const vnutr = groups.otdelka.vnutrennyaya[0] || '';
    
    if (naruzh && vnutr && naruzh.trim() === vnutr.trim()) {
      // –ï—Å–ª–∏ –æ—Ç–¥–µ–ª–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è - –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
      result.push(`  ${naruzh} –≤–Ω—É—Ç—Ä–∏ –∏ —Å–Ω–∞—Ä—É–∂–∏`);
    } else {
      // –ï—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ - –≤—ã–≤–æ–¥–∏–º –æ—Ç–¥–µ–ª—å–Ω–æ
      if (groups.otdelka.naruzhnaya.length > 0) {
        groups.otdelka.naruzhnaya.forEach(item => {
          result.push(`  –ù–∞—Ä—É–∂–Ω–∞—è: ${item}`);
        });
      }
      if (groups.otdelka.vnutrennyaya.length > 0) {
        groups.otdelka.vnutrennyaya.forEach(item => {
          result.push(`  –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è: ${item}`);
        });
      }
    }
    isFirstGroup = false;
  }
  
  // 6. –°—Ç–µ–Ω—ã
  if (groups.steny.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–°—Ç–µ–Ω—ã'));
    result.push(...groups.steny);
    isFirstGroup = false;
  }
  
  // 7. –û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏
  if (groups.oknaDveri.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏'));
    result.push(...groups.oknaDveri);
    isFirstGroup = false;
  }
  
  // 8. –ü–æ–ª
  if (groups.pol.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–ü–æ–ª'));
    // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ "–ü–æ–ª:" –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    groups.pol.forEach(item => {
      let cleanItem = item.replace(/^[‚Äì-]\s*–ø–æ–ª\s*:\s*/i, '‚Äì ').trim();
      if (!cleanItem.startsWith('‚Äì')) cleanItem = '‚Äì ' + cleanItem;
      result.push(cleanItem);
    });
    isFirstGroup = false;
  }
  
  // 9. –í–µ—Ä–∞–Ω–¥—ã –∏ –ø—Ä–∏—Å—Ç—Ä–æ–π–∫–∏
  if (groups.veranda.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–í–µ—Ä–∞–Ω–¥—ã –∏ –ø—Ä–∏—Å—Ç—Ä–æ–π–∫–∏'));
    result.push(...groups.veranda);
    isFirstGroup = false;
  }
  
  // 10. –†–∞–∑–º–µ—Ä—ã –∏ –≤—ã—Å–æ—Ç–∞
  if (groups.razmery.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–†–∞–∑–º–µ—Ä—ã –∏ –≤—ã—Å–æ—Ç–∞'));
    result.push(...groups.razmery);
    isFirstGroup = false;
  }
  
  // 11. –ü—Ä–æ—á–µ–µ
  if (groups.prochee.length > 0) {
    if (!isFirstGroup) result.push('');
    result.push(formatGroupTitle('–ü—Ä–æ—á–µ–µ'));
    result.push(...groups.prochee);
    isFirstGroup = false;
  }
  
  return result;
}

/* ------------------------------------------------------------------
   8. calculate ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞
------------------------------------------------------------------ */
async function calculate(){
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ä–∞—Å—á–µ—Ç–æ–º
  checkForceLogoutOnLoad();
  
  // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ü–†–Ø–ú–û –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ change —Å–µ–ª–µ–∫—Ç–∞ —Å–≤–∞–π
  // –ó–¥–µ—Å—å –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–ª–∞–≥–∏ - –æ–Ω–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–∏–º –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –ö–ü (—á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É)
  // –ö–æ–≥–¥–∞ –∫–Ω–æ–ø–∫–∞ –ù–ï –∞–∫—Ç–∏–≤–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ–µ –ö–ü (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  // –ö–æ–≥–¥–∞ –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ (–∫–ª–∞—Å—Å active) - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –ö–ü
  const btnShortKP = document.getElementById("btnShortKP");
  const isShortKP = btnShortKP ? btnShortKP.classList.contains("active") : false;
  
  const type = selType.value;
  const cfg = CONFIG[type];
  const isEconomy = cfg.isEconomy || false;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ chkMouseNew —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  const chkMouseNew = document.getElementById('chkMouseNew');
  if (!chkMouseNew) {
    console.error('chkMouseNew element not found in calculate function!');
    return;
  }
  
  // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–∞–Ω–¥—É—Å–∞
  const chkRamp = document.getElementById('chkRamp');

    /* ---   –û–ë–™–Ø–í–õ–Ø–ï–ú –°–†–ê–ó–£, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ ReferenceError   --- */
  const pkg = [];                  // —Å–ø–∏—Å–æ–∫ ¬´–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è¬ª
  let baseWinSize,  baseWinQty;    // –±–∞–∑–æ–≤—ã–µ –æ–∫–Ω–∞
  let baseDoorLabel, baseDoorQty;  // –±–∞–∑–æ–≤—ã–µ –¥–≤–µ—Ä–∏
  let heightNote = "";             // –∑–∞–º–µ—Ç–∫–∞ –æ –≤—ã—Å–æ—Ç–µ (–±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
  let partType = "none";           // —Ç–∏–ø –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
  let partLen = 0;                 // –¥–ª–∏–Ω–∞ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
  let floorCode = "plain";         // –∫–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ø–æ–ª–∞
  let importantNotes = [];         // –≤–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (—Å–≤–∞–∏, –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ —Ç.–¥.)
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ pkg —Å –µ–¥–∏–Ω–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
  function pushPkg(line) {
    if (!line) return;
    pkg.push(normalizeSpaces(line));
  }

  if (type === "house") {          // –∫–∞—Ä–∫–∞—Å–Ω—ã–π –¥–æ–º
  baseWinSize   = "80√ó80";
  baseWinQty    = 3;
  baseDoorQty   = 2;
  baseDoorLabel = baseDoorQty > 1 ? "–°–∞–º–æ–Ω–∞–±–æ—Ä–Ω—ã–µ –¥–≤–µ—Ä–∏" : "–°–∞–º–æ–Ω–∞–±–æ—Ä–Ω–∞—è –¥–≤–µ—Ä—å";
} else if (isEconomy) {           // —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∞
  baseWinSize   = "55√ó80";        // –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ –æ–∫–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  baseWinQty    = 1;
  baseDoorLabel = "–î–≤–µ—Ä—å –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –Ω–∞–±–æ—Ä–Ω–∞—è 75√ó175 —Å–º";
  baseDoorQty   = 1;
} else {                         // –±—ã—Ç–æ–≤–∫–∞ / —Ö–æ–∑–±–ª–æ–∫ (–æ–±—ã—á–Ω–∞—è)
  baseWinSize   = "60√ó90";
  baseWinQty    = 1;
  baseDoorLabel = "–î–≤–µ—Ä—å: —Å–∞–º–æ–Ω–∞–±–æ—Ä–Ω–∞—è 200√ó70‚Äì90 —Å–º";
  baseDoorQty   = 1;
}
  /* ----------------------------------------------------------- */

// --- —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã, –∫–∞–∫ –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ---
const wReal = parseFloat(inpWidth.value);   // —à–∏—Ä–∏–Ω–∞ –∏–∑ —Å–µ–ª–µ–∫—Ç–∞
const lReal = parseFloat(inpLength.value);  // –¥–ª–∏–Ω–∞ –∏–∑ —Å–µ–ª–µ–∫—Ç–∞

// --- —Ä–∞–∑–º–µ—Ä—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —Å–º–æ—Ç—Ä–∏–º –ø—Ä–∞–π—Å–æ–≤—É—é —Ü–µ–Ω—É ---
let wPrice = wReal;
let lPrice = lReal;


if (type !== "house") {                 // –±—ã—Ç–æ–≤–∫–∞ / —Ö–æ–∑–±–ª–æ–∫
  // –ù–û–í–û–ï: —à–∏—Ä–∏–Ω—ã-—Å–∏–Ω–æ–Ω–∏–º—ã –¥–ª—è –ø—Ä–∞–π—Å–∞
  if (wReal === 2.1) wPrice = 2.0;      // 2.1 —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ 2.0
  else if (wReal === 2.3) wPrice = 2.5; // 2.3 —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ 2.5

  // –∫–∞–∫ –∏ –±—ã–ª–æ: –¥–ª–∏–Ω–∞ 2.5 —Å—á–∏—Ç–∞–µ–º –ø–æ –ø—Ä–∞–π—Å—É –∫–∞–∫ 3
  if (lReal === 2.5) lPrice = 3;
}

  const w = wReal;   // ‚Üê ¬´–∫–æ—Ä–æ—Ç–∫–∏–µ¬ª –∏–º–µ–Ω–∞, –∫–∞–∫ —Ä–∞–Ω—å—à–µ
  const l = lReal;

    /* --- 4. –í–µ—Ä–∞–Ω–¥–∞ --- */
  // ‚îÄ‚îÄ‚îÄ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–µ—Ä–∞–Ω–¥—ã –∏ ¬´—Ç—ë–ø–ª–∞—è¬ª –ø–ª–æ—â–∞–¥—å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const vw = parseFloat(inpVerWidth.value) || 0;
const vd = parseFloat(inpVerDepth.value) || 0;

const isInsideVer = document.getElementById('chkInVer').checked; // —á–µ–∫–±–æ–∫—Å ¬´–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è¬ª
const verArea     = (vw > 0 && vd > 0) ? vw * vd : 0;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ –≤–µ—Ä–∞–Ω–¥–∞ –∏–∑ –ø—Ä–∞–π—Å–∞
const selectedVeranda = document.getElementById('selVeranda')?.value;
let verandaFromPrice = null;
if (selectedVeranda) {
  const verandaType = type === 'hoblok' ? 'hoblok' : 'bytovka';
  verandaFromPrice = VERANDA_CONFIG[verandaType]?.[selectedVeranda];
}

const warmArea    = isInsideVer ? (w * l - verArea)    // —Ç–æ–ª—å–∫–æ —Ç—ë–ø–ª–∞—è —á–∞—Å—Ç—å
                                : (w * l);             // –≤—Å—ë —Å—Ç—Ä–æ–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const verRoof = document.querySelector('input[name="verRoofType"]:checked')?.value
                || 'verRoof';

  let basePrice = 0, del = 0, finalInt, finalExt;

  /* ===== 8.2. –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ ===== */
  const area = w * l;
  // ‚îÄ‚îÄ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∞—à–∏–Ω –¥–ª—è –±—ã—Ç–æ–≤–æ–∫ –∏ —Ö–æ–∑–±–ª–æ–∫–æ–≤:
// 1 –º–∞—à–∏–Ω–∞ ‚Äî –ø–ª–æ—â–∞–¥—å ‚â§ 18–º¬≤ (–≤–∫–ª—é—á–∞—è –≤–µ—Ä–∞–Ω–¥—É)
// 2 –º–∞—à–∏–Ω—ã ‚Äî –ø–ª–æ—â–∞–¥—å > 18–º¬≤
const totalArea = warmArea + (verArea || 0); // –æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å + –≤–µ—Ä–∞–Ω–¥–∞
const isLargeGabarit = (totalArea > 18);
const veh = (type === "house") ? 1 : (isLargeGabarit ? 2 : 1);  // –¥–æ–º–∞ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º

// 1. –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–µ–∑–¥–∞
const minDeliv = (type === "house")
  ? 7000                      // –¥–ª—è –¥–æ–º–æ–≤
  : CONFIG[type].delivery.min; // 5000 (—Ö–æ–∑–±–ª–æ–∫) –∏–ª–∏ 6000 (–±—ã—Ç–æ–≤–∫–∞)

del = 0;                  // —Å—é–¥–∞ –ø–æ–ª–æ–∂–∏–º –∏—Ç–æ–≥ –¥–æ—Å—Ç–∞–≤–∫–∏
let hasRoute = false;         // –ø–æ—Å—Ç—Ä–æ–µ–Ω –ª–∏ –º–∞—Ä—à—Ä—É—Ç
let km = 0;                   // –∫–∏–ª–æ–º–µ—Ç—Ä–∞–∂

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;

// 2. –µ—Å–ª–∏ –∞–¥—Ä–µ—Å –µ—Å—Ç—å ‚Äî –ø—ã—Ç–∞–µ–º—Å—è –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
const address = inpAddr.value.trim();
if (address) {
  try {
    km = await getKm(address, isEconomy);        // –≤–µ—Ä–Ω—ë—Ç —á–∏—Å–ª–æ –∏–ª–∏ null
    if (km === null) {
      console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç");
      hasRoute = false;
    } else {
      hasRoute = true;
    }
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞:", error);
    hasRoute = false;
  }
}

// 3. –µ—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–µ—Ç (–ø—É—Å—Ç–æ–π –∞–¥—Ä–µ—Å) ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ = –º–∏–Ω–∏–º–∞–ª–∫–∞
if (!hasRoute) {
  if (isEconomy) {
    // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏
    const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
    const minCost = (deliveryType === 'manipulator') ? 10000 : 7000;
    // –î–æ–±–∞–≤–ª—è–µ–º 10% –Ω–∞—Ü–µ–Ω–∫—É –∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    const minCostWithMarkup = Math.round(minCost * 1.1);
    del = Math.ceil(minCostWithMarkup / 50) * 50; // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–æ—Ç ..." —Å –Ω–∞—Ü–µ–Ω–∫–æ–π, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫ 50‚ÇΩ
  } else {
    del = Math.ceil(minDeliv / 50) * 50; // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–æ—Ç ..." –±–µ–∑ –Ω–∞—Ü–µ–Ω–∫–∏, —Ç–æ–ª—å–∫–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫ 50‚ÇΩ
  }
} else {
  let rate;
  if (type === "house") {
    // –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞: —Ä–∞—Å—á–µ—Ç –ø–æ –ø–ª–æ—â–∞–¥–∏ (–≤–∫–ª—é—á–∞—è –≤–µ—Ä–∞–Ω–¥—É)
    const totalArea = warmArea + (verArea || 0); // –æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å + –≤–µ—Ä–∞–Ω–¥–∞
    const deliveryInfo = getHouseDeliveryRate(totalArea);
    rate = deliveryInfo.rate;
    let cost = rate * km;
    if (cost < minDeliv) cost = minDeliv;
    const cost50 = Math.ceil(cost / 50) * 50; // –ø–æ –ø—Ä–∞–π—Å—É –∫ 50
    del = cost50;                             // –±–µ–∑ –Ω–∞—Ü–µ–Ω–∫–∏, —Ç–æ–ª—å–∫–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫ 50 ‚ÇΩ
  } else if (isEconomy) {
    // –≠–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∞: –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ (–∏–∑ –ø—Ä–∞–π—Å–∞)
    const needsAssembly = document.getElementById('chkAssembly')?.checked;
    
    if (deliveryType === 'manipulator') {
      // –î–æ—Å—Ç–∞–≤–∫–∞ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–º: 150 —Ä—É–±/–∫–º, –º–∏–Ω. 10 000 —Ä—É–± (–∏–∑ –ø—Ä–∞–π—Å–∞)
      rate = 150;
      let cost = rate * km;
      if (cost < 10000) cost = 10000;
      // –î–æ–±–∞–≤–ª—è–µ–º 10% –Ω–∞—Ü–µ–Ω–∫—É –∫ –¥–æ—Å—Ç–∞–≤–∫–µ
      cost = Math.round(cost * 1.1 / 50) * 50;
      del = cost;
  } else {
      // –î–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞–º–∏: 130 —Ä—É–±/–∫–º, –º–∏–Ω. 7 000 —Ä—É–± (–∏–∑ –ø—Ä–∞–π—Å–∞)
      rate = 130;
      let cost = rate * km;
      if (cost < 7000) cost = 7000;
      // –î–æ–±–∞–≤–ª—è–µ–º 10% –Ω–∞—Ü–µ–Ω–∫—É –∫ –¥–æ—Å—Ç–∞–≤–∫–µ
      cost = Math.round(cost * 1.1 / 50) * 50;
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–±–æ—Ä–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ (—Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
      // –î–ª—è –≥–∞–∑–µ–ª–∏ —Å–±–æ—Ä–∫–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É
      if (needsAssembly && deliveryType !== 'kit') {
        cost += Math.round(CONFIG[type].delivery.assembly * 1.1); // 7000 + 10% = 7700
      }
      
      del = cost;
    }
  } else {
    // –û–±—ã—á–Ω—ã–µ –ª–∏–Ω–µ–π–∫–∏ (—Ö–æ–∑–±–ª–æ–∫, –±—ã—Ç–æ–≤–∫–∞)
    rate = (veh === 2) ? CONFIG[type].delivery.perKm2 : CONFIG[type].delivery.perKm1;
  let cost = rate * km;
  if (cost < minDeliv) cost = minDeliv;
  const cost50 = Math.ceil(cost / 50) * 50; // –ø–æ –ø—Ä–∞–π—Å—É –∫ 50
  del = cost50;                             // –±–µ–∑ –Ω–∞—Ü–µ–Ω–∫–∏, —Ç–æ–ª—å–∫–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫ 50 ‚ÇΩ
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ë–ê–ó–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
if (type === 'house') {
  const roof = document.querySelector('input[name="roof"]:checked').value;

  // –µ—Å–ª–∏ –≤–µ—Ä–∞–Ω–¥–∞ ¬´–≤–Ω—É—Ç—Ä–∏¬ª ‚Äì –∑–∞–±–∏—Ä–∞–µ–º –µ—ë –∫–≤–∞–¥—Ä–∞—Ç—É—Ä—É –∏–∑ —Ä–∞—Å—á—ë—Ç–∞
  const paidArea = isInsideVer ? warmArea : area;   // warmArea = (w*l - verArea)

  // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥–æ–º–æ–≤ —Å –ª–æ–º–∞–Ω–æ–π –∫—Ä—ã—à–µ–π
  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10,450‚ÇΩ/–º¬≤ (—Å –æ—Ç–¥–µ–ª–∫–æ–π –û–°–ë)
  // –° –≤–∞–≥–æ–Ω–∫–æ–π BC-–∫–ª–∞—Å—Å: 11,000‚ÇΩ/–º¬≤ (–≤–º–µ—Å—Ç–æ –û–°–ë)
  let ratePerSqm = RATE[roof].base; // 10,450‚ÇΩ/–º¬≤ (–û–°–ë)
  
  if (roof === 'lom' && selInRep && selInRep.value === 'osb_vag') {
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–º–µ–Ω–∞ –û–°–ë ‚Üí –≤–∞–≥–æ–Ω–∫–∞ B-C, –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 11,000‚ÇΩ/–º¬≤
    ratePerSqm = 11000;
  }

  basePrice = Math.ceil(paidArea * ratePerSqm / 10) * 10;

} else if (isEconomy) {                        // 2. —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∞
  // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –≤–µ—Ä–∞–Ω–¥–∞ –∏–∑ –ø—Ä–∞–π—Å–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë —Ü–µ–Ω—É (—É–∂–µ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
  if (verandaFromPrice) {
    basePrice = Math.round(verandaFromPrice.price / 50) * 50; // —Ç–æ–ª—å–∫–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫ 50
  } else {
    const tbl = CONFIG[type].basePrice;
    
    // –ü—Ä—è–º–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ —Ü–µ–Ω—É
    basePrice = tbl[`${wReal}x${lReal}`] ?? 0;
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–ø—É—Ç–∞–Ω–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
    if (!basePrice) basePrice = tbl[`${lReal}x${wReal}`] ?? 0;
    
    // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ —Ä–∞—Å—á–µ—Ç –ø–æ –ø–ª–æ—â–∞–¥–∏ –ù–ï –î–û–ü–£–°–¢–ò–ú - —Ç–æ–ª—å–∫–æ —Ä–∞–∑–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–π—Å–∞
    // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω - basePrice –æ—Å—Ç–∞–µ—Ç—Å—è 0
  }
  
  // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏: –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –≥–∞–∑–µ–ª—å, –¥–æ–±–∞–≤–ª—è–µ–º —Å–±–æ—Ä–∫—É –∫ –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–µ
  // –ù–û –ù–ï –¥–ª—è –≤–µ—Ä–∞–Ω–¥ –∏–∑ –ø—Ä–∞–π—Å–∞ - —Ç–∞–º —Å–±–æ—Ä–∫–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞
  if (deliveryType === 'kit' && isEconomy && !verandaFromPrice) {
    basePrice += Math.round(7000 * 1.1); // 7000 + 10% = 7700
  }
  
} else {                                        // 3. –±—ã—Ç–æ–≤–∫–∞ –∏–ª–∏ —Ö–æ–∑–±–ª–æ–∫ (–æ–±—ã—á–Ω–∞—è)
  const tbl   = (type === 'hoblok')
                ? CONFIG.hoblok.basePrice
                : CONFIG.bytovka.basePrice;

  // 2.1 –ø—Ä—è–º–∞—è –ø–æ–ø—ã—Ç–∫–∞
  basePrice   = tbl[`${wPrice}x${lPrice}`] ?? 0;

  // 2.2 –µ—Å–ª–∏ 0 ‚Äì –ø—Ä–æ–±—É–µ–º ¬´–ø–µ—Ä–µ–ø—É—Ç–∞–Ω–Ω—ã–µ¬ª —Å—Ç–æ—Ä–æ–Ω—ã
  if (!basePrice) basePrice = tbl[`${lPrice}x${wPrice}`] ?? 0;

  /* --- –ù–û–í–û–ï: —Ü–µ–Ω—ã –¥–ª—è —à–∏—Ä–∏–Ω—ã 2.5 –º  (–Ω–∞ 5 000 –¥–µ—à–µ–≤–ª–µ 3-–º–µ—Ç—Ä–æ–≤—ã—Ö) --- */
if (!basePrice && wPrice === 2.5) {
  // –±–µ—Ä—ë–º —Ü–µ–Ω—É –¥–ª—è 3√óL –∏ —É–º–µ–Ω—å—à–∞–µ–º –Ω–∞ 5 000 ‚ÇΩ
  const ref1 = tbl[`3x${lPrice}`];       // ¬´3 √ó L¬ª
  const ref2 = tbl[`${lPrice}x3`];       // ¬´L √ó 3¬ª (–µ—Å–ª–∏ L>W)
  const ref  = ref1 ?? ref2;
  if (ref) basePrice = ref - 5000;
}
/* ------------------------------------------------------------------- */


    // 2.3 –µ—Å–ª–∏ –≤—Å—ë –µ—â—ë 0 ‚Äî –ù–ï —Å–æ–±–∏—Ä–∞–µ–º –∏–∑ –º–æ–¥—É–ª–µ–π, –∞ —Å—á–∏—Ç–∞–µ–º –ø–æ –º¬≤ (–±—ã—Ç–æ–≤–∫–∞ –∏ —Ö–æ–∑–±–ª–æ–∫)
  if (!basePrice && (type === 'bytovka' || type === 'hoblok')) {
    const baseArea = (isInsideVer && vw && vd) ? (w * l - verArea) : (w * l);
    basePrice = Math.round(baseArea * NONSTD_RATE[type] / 100) * 100;
  }
}



  /* ===== 8.3. –î–æ–ø. –æ–ø—Ü–∏–∏ ===== */
  let extras = 0, linesExtra = [];
  // –§–ª–∞–≥: –±—ã–ª–∏ –ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–∫–Ω–∞ –ü–í–• (—á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –±–∞–∑–æ–≤—ã–µ ¬´–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –æ–∫–Ω–∞¬ª –∏–∑ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏)
  let pvcWindowsAdded = false;
  // –ö–æ–ø–∏–º —Å—Ç—Ä–æ–∫–∏ –æ–∫–æ–Ω –ü–í–•, —á—Ç–æ–±—ã –≤—Å—Ç–∞–≤–∏—Ç—å –∏—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä—è–¥–æ–º —Å –¥–≤–µ—Ä—è–º–∏
  const pvcWindowLines = [];
  
  // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–∫–æ–Ω –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö (–ø–æ —Ä–∞–∑–º–µ—Ä—É –∏ –∫–∞–º–µ—Ä–∞–º)
  const windowsGroup = {}; // –∫–ª—é—á: "–û–∫–Ω–æ –ü–í–• 60√ó90", –∑–Ω–∞—á–µ–Ω–∏–µ: {qty: —Å—É–º–º–∞, price: —Ü–µ–Ω–∞ –∑–∞ —à—Ç}

    // —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî —Å–æ–±–∏—Ä–∞–µ–º –≤ map
const extraMap = {};
function addExtra(sum, label, skipMarkup = false){
  sum = Math.round(sum);
  if(!sum || sum<=0) return;
  
  // –ï—Å–ª–∏ skipMarkup = true, –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Ü–µ–Ω–∫—É (—É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞)
  const finalSum = skipMarkup ? sum : grossInt(sum);
  extras += finalSum;
  extraMap[label] = (extraMap[label] || 0) + finalSum;
}
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–∫–Ω–∞ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö
  function addWindowExtra(price, caption, qty, skipMarkup = false) {
    if (!price || price <= 0) return;
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º –±–∞–∑–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)
    // –í–∞–∂–Ω–æ: –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –ø–æ–ª–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é (–≤–∫–ª—é—á–∞—è —Ä–∞–∑–º–µ—Ä), —á—Ç–æ–±—ã –æ–∫–Ω–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–∞–º–µ—Ä–∞–º–∏ –Ω–µ –æ–±—ä–µ–¥–∏–Ω—è–ª–∏—Å—å
    const baseCaption = caption.replace(/\s*\(\d+\s*—à—Ç\)\s*$/, '').trim();
    
    // –ï—Å–ª–∏ —ç—Ç–æ –æ–∫–Ω–æ –ü–í–• –∏–ª–∏ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ –æ–∫–Ω–æ - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º
    if (caption.includes('–û–∫–Ω–æ –ü–í–•') || caption.includes('–û–∫–Ω–æ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ')) {
      if (!windowsGroup[baseCaption]) {
        windowsGroup[baseCaption] = { qty: 0, pricePerUnit: price };
      }
      windowsGroup[baseCaption].qty += qty;
      // –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –±–µ—Ä–µ–º –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ)
    } else {
      // –î–ª—è –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–¥–≤–µ—Ä–∏ –∏ —Ç.–¥.) –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
      addExtra(price * qty, `${caption}`, skipMarkup);
    }
}
  /* --- –≠–ö–û–ù–û–ú-–õ–ò–ù–ï–ô–ö–ê: —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –¥–æ–ø. –æ–ø—Ü–∏–∏ --- */
  if (isEconomy) {
    // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º
    const sizeKey = `${wReal}x${lReal}`;
    
    // –¢–∏–ø –∫—Ä—ã—à–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã —Å +10%)
    const roofType = document.querySelector('input[name="economyRoof"]:checked')?.value;
    if (roofType === 'gable_length') {
      addExtra(22000, "–î–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞ –ø–æ –¥–ª–∏–Ω–µ", true); // 20000 + 10%, —É–∂–µ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π
    } else if (roofType === 'gable_width') {
      addExtra(16500, "–î–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞ –ø–æ —à–∏—Ä–∏–Ω–µ", true); // 15000 + 10%, —É–∂–µ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π
    }
    // –û–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è (single) - –±–µ–∑ –¥–æ–ø–ª–∞—Ç—ã
    
    // –£—Ç–µ–ø–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–ª–∫–∞ 50 –º–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Ç–æ–≤–æ–∫ —ç–∫–æ–Ω–æ–º)
    if (type === 'bytovka_economy' && document.getElementById('chkCeilingInsulation')?.checked) {
      const price = ECONOMY_EXTRAS.ceilingInsulation[sizeKey];
      if (price) addExtra(price, "–£—Ç–µ–ø–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–ª–∫–∞ 50 –º–º", true);
    }
    
    // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ (—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –æ–ø—Ü–∏—è)
    const interiorFinish = document.querySelector('input[name="interiorFinish"]:checked')?.value;
    if (interiorFinish === 'osb') {
      const price = ECONOMY_EXTRAS.interiorFinish.osb[sizeKey];
      if (price) addExtra(price, "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ –û–°–ü-9", true);
    } else if (interiorFinish === 'vagonka') {
      const price = ECONOMY_EXTRAS.interiorFinish.vagonka[sizeKey];
      if (price) addExtra(price, "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ –≤–∞–≥–æ–Ω–∫–∞ '–°'", true);
    }
    
    // –£—Ç–µ–ø–ª–µ–Ω–∏–µ 100 –º–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Ç–æ–≤–æ–∫ —ç–∫–æ–Ω–æ–º)
    if (type === 'bytovka_economy' && document.getElementById('chkInsulation100')?.checked) {
      const price = ECONOMY_EXTRAS.insulation100[sizeKey];
      if (price) addExtra(price, "–£—Ç–µ–ø–ª–µ–Ω–∏–µ 100 –º–º (—Å—Ç–µ–Ω—ã/–ø–æ–ª/–ø–æ—Ç–æ–ª–æ–∫)", true);
    }
    
    // –û–≥–Ω–µ–±–∏–æ–∑–∞—â–∏—Ç–∞ –ø–æ–ª–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ)
    if (document.getElementById('chkFireProtectionFloor')?.checked) {
      const price = ECONOMY_EXTRAS.fireProtection.floor[sizeKey];
      if (price) addExtra(price, "–û–≥–Ω–µ–±–∏–æ–∑–∞—â–∏—Ç–∞ –ø–æ–ª–∞", true);
    }
    
    // –û–≥–Ω–µ–±–∏–æ–∑–∞—â–∏—Ç–∞ –∫–∞—Ä–∫–∞—Å–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ)
    if (document.getElementById('chkFireProtectionFrame')?.checked) {
      const price = ECONOMY_EXTRAS.fireProtection.frame[sizeKey];
      if (price) addExtra(price, "–û–≥–Ω–µ–±–∏–æ–∑–∞—â–∏—Ç–∞ –∫–∞—Ä–∫–∞—Å–∞", true);
    }
    
    // –ü–∞—Ä–æ- –∏ –≤–µ—Ç—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Ç–æ–≤–æ–∫ —ç–∫–æ–Ω–æ–º)
    if (type === 'bytovka_economy' && document.getElementById('chkVaporBarrier')?.checked) {
      const price = ECONOMY_EXTRAS.vaporBarrier[sizeKey];
      if (price) addExtra(price, "–ü–∞—Ä–æ- –∏ –≤–µ—Ç—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è", true);
    }
    
    // –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã)
    const partitionsContainer = document.getElementById('partitionsContainerEconomy');
    if (partitionsContainer) {
      partitionsContainer.querySelectorAll('.partition-row').forEach(row => {
        const material = row.querySelector('.partition-material')?.value;
        const size = row.querySelector('.partition-size')?.value;
        const qty = parseInt(row.querySelector('.partition-qty')?.value) || 0;
        
        if (material && size && qty > 0) {
          const partitionPrices = {
            'organlit_2': 6600,    // 6000 + 10%
            'organlit_2.5': 7700,  // 7000 + 10%
            'organlit_3': 8250,    // 7500 + 10%
            'osb_2': 7700,         // 7000 + 10%
            'osb_2.5': 8800,       // 8000 + 10%
            'osb_3': 9900,         // 9000 + 10%
            'vagonka_2': 13200,    // 12000 + 10%
            'vagonka_2.5': 15950,  // 14500 + 10%
            'vagonka_3': 16500,    // 15000 + 10%
            'hoblok_2': 5500,      // 5000 + 10%
            'hoblok_2.5': 7150,    // 6500 + 10%
            'hoblok_3': 8250       // 7500 + 10%
          };
          
          const price = partitionPrices[size] || 0;
          if (price > 0) {
            const optionText = row.querySelector('.partition-size').selectedOptions[0].text;
            const materialText = row.querySelector('.partition-material').selectedOptions[0].text;
            const total = price * qty;
            // –£–±–∏—Ä–∞–µ–º —Ü–µ–Ω—É –∏–∑ optionText –¥–ª—è –ö–ü
            const cleanOptionText = optionText.replace(/ ‚Äî \d+[\s,]*\d*‚ÇΩ/, '');
            addExtra(total, `–°—Ç–µ–Ω–∞ ${materialText.toLowerCase()} ${cleanOptionText} (${qty} —à—Ç)`, true);
          }
        }
      });
    }
    
    // –û–∫–Ω–∞ / –¥–≤–µ—Ä–∏ (–Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏)
    const windowsContainerEconomy = document.getElementById('windowsContainerEconomy');
    if (windowsContainerEconomy) {
      windowsContainerEconomy.querySelectorAll(".window-row").forEach(row => {
        const kind = row.querySelector(".win-type").value;   // pvcWin | woodWin | pvcDoor | woodDoor
        const cam  = row.querySelector(".win-cam").value;
        const sel  = row.querySelector(".win-size");
        const code = sel.value;                 // —Å—Ç—Ä–æ–∫–∞-–∫–æ–¥ –∏–∑ <option value="‚Ä¶">
        const qty  = +row.querySelector(".win-qty").value || 1;
        if (!code) return;                      // –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ

        let price = 0, caption = "";

        switch (kind) {
        /* ---------- –û–ö–ù–ê ---------- */
        case "pvcWin": {                        // –æ–∫–Ω–æ –ü–í–•
          price   = ECONOMY_WINDOWS[code][cam];
          // –í–∫–ª—é—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–º–µ—Ä–∞—Ö –≤ caption –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
          const camText = cam === '1' ? '1-–∫–∞–º.' : cam === '2' ? '2-–∫–∞–º.' : '';
          caption = `–û–∫–Ω–æ –ü–í–• ${code}${camText ? ' ' + camText : ''}`;
          if (price) {
            addWindowExtra(price, caption, qty, true);
          pvcWindowLines.push(`‚Äì ${caption} (${qty} —à—Ç)`); // –ö–æ–ø–∏–º, –≤—Å—Ç–∞–≤–∏–º –ø–æ–∑–∂–µ —Ä—è–¥–æ–º —Å –¥–≤–µ—Ä—è–º–∏
          }
          pvcWindowsAdded = true;
          break;
        }

        case "woodWin": {                // –æ–∫–Ω–æ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ
        price   = ECONOMY_WOOD_PRICES.win[code];
        caption = `–û–∫–Ω–æ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ ${code}`;

        // –µ—Å–ª–∏ —ç—Ç–æ –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä ‚Äì –ø—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫
        if (code === baseWinSize) {
          baseWinQty += qty;
        } else {
          pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);
        }

        if (price) addWindowExtra(price, caption, qty, true);
        break;
      }

        /* ---------- –î–í–ï–†–ò ---------- */
        case "pvcDoor": {                       // –¥–≤–µ—Ä—å –ü–í–•
          price   = ECONOMY_WINDOWS[code][2] || ECONOMY_WINDOWS[code][1];
          caption = `–î–≤–µ—Ä—å –ü–í–• ${code}`;
          if (price) addExtra(price * qty, `${caption} (${qty} —à—Ç)`, true);
          pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);        // ‚Üê –î–û–ë–ê–í–õ–Ø–ï–ú
          break;
        }

        case "woodDoor": {               // –¥–≤–µ—Ä—å –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è
        price = ECONOMY_WOOD_PRICES.door[code];
        const cap = { 
          wooden_set:"–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –Ω–∞–±–æ—Ä–Ω–∞—è 75√ó175",
          wooden_swing:"–†–∞—Å–ø–∞—à–Ω–∞—è (—à–∏—Ä–∏–Ω–∞ 160)",
          interior_pine:"–ú–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è —Å–æ—Å–Ω–æ–≤–∞—è"
        }[code];
        caption = `–î–≤–µ—Ä—å –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è (${cap})`;

        if (code === "wooden_set") {          // –±–∞–∑–æ–≤–∞—è ¬´–Ω–∞–±–æ—Ä–Ω–∞—è¬ª
          baseDoorQty += qty;
        } else {
          pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);
        }

        if (price) addExtra(price * qty, `${caption} (${qty} —à—Ç)`, true);
        break;
      }

        case "metalDoor": {                     // –¥–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è
          price   = ECONOMY_METAL_PRICES[code];
          caption = "–î–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¢—É–ª–∞";
          if (price) addExtra(price * qty, `${caption} (${qty} —à—Ç)`, true);
          pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);        // ‚Üê –î–û–ë–ê–í–õ–Ø–ï–ú
          break;
        }
      }
      });
    }
    
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ–∫–Ω–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ extraMap
    Object.entries(windowsGroup).forEach(([baseCaption, data]) => {
      const totalPrice = data.pricePerUnit * data.qty;
      const finalSum = grossInt(totalPrice);
      extras += finalSum;
      extraMap[`${baseCaption} (${data.qty} —à—Ç)`] = finalSum;
    });
    
    // –ü—Ä–æ—á–µ–µ
    if (document.getElementById('chkSteps')?.checked) {
      addExtra(ECONOMY_EXTRAS.misc.steps, "–°—Ç—É–ø–µ–Ω–∏", true);
    }
    if (document.getElementById('chkRamp75')?.checked) {
      addExtra(ECONOMY_EXTRAS.misc.ramp_75, "–ü–∞–Ω–¥—É—Å 75 —Å–º", true);
    }
    if (document.getElementById('chkRamp160')?.checked) {
      addExtra(ECONOMY_EXTRAS.misc.ramp_160_180, "–ü–∞–Ω–¥—É—Å 160-180 —Å–º", true);
    }
    
    // –°–≤–∞–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ)
    const svaiType = document.getElementById('selEconomySvaiType')?.value;
    if (svaiType) {
      const w = parseFloat(inpWidth.value) || 0;
      const l = parseFloat(inpLength.value) || 0;
      const sizeKey = `${w}x${l}`;
      const recommendation = CONFIG[type].svai.recommendations[sizeKey];
      if (recommendation) {
        const prices = {
          "76x150": 4840,
          "76x200": 5390,
          "89x200": 6050,
          "89x250": 6490,
          "89x300": 7150
        };
        const price = prices[svaiType];
        if (price) {
          const totalPrice = price * recommendation;
          addExtra(totalPrice, `–°–≤–∞–∏ ${svaiType} (${recommendation} —à—Ç)`);
        }
      }
    }
    
    // –ü–∞–Ω–¥—É—Å (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ)
    if (chkRamp && chkRamp.checked) addExtra(RAMP, "–ü–∞–Ω–¥—É—Å");
    
    // –°–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
    if (chkMouse.checked) addExtra(FLOOR.mouse * warmArea, "–°–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª");
    
    // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—ã—á–Ω—É—é –ª–æ–≥–∏–∫—É –¥–æ–ø. –æ–ø—Ü–∏–π
}
  /* --- 1. –£—Ç–µ–ø–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ > –±–∞–∑–æ–≤–æ–≥–æ) --- */
  // --- 1. –£—Ç–µ–ø–ª–µ–Ω–∏–µ (—Å—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Ç–æ–≤–∫–∏ –∏ –¥–æ–º–∞) ---
if (!isEconomy && selType.value !== "hoblok" && selInsul.value !== "none") {
  // –±–∞–∑–æ–≤–∞—è —Ç–æ–ª—â–∏–Ω–∞: 50 –º–º —É –±—ã—Ç–æ–≤–∫–∏, 100 –º–º —É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
const baseInsulPrice = (type === "bytovka") ? 0 : INSUL.roll100;
const diff = INSUL[selInsul.value] - baseInsulPrice;
  if (diff > 0) addExtra(diff * warmArea, getLabel(selInsul.selectedOptions[0]));
}


  /* --- 2. –ö—Ä–æ–≤–ª—è (—Ü–≤–µ—Ç–Ω–æ–π/–º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞/–æ–Ω–¥—É–ª–∏–Ω) --- */
  if (!isEconomy && selRoofMat.value !== "galv") {
    let roofLabel = getLabel(selRoofMat.selectedOptions[0]);
    // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –≤—Å–µ—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫—Ä–æ–º–µ –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω–æ–≥–æ
    if (selectedProfColor) {
      const materialNames = {
        'profColor': '–¶–≤–µ—Ç–Ω–æ–π –ø—Ä–æ—Ñ–ª–∏—Å—Ç',
        'ondulin': '–û–Ω–¥—É–ª–∏–Ω',
        'tile_lom': '–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞ (–æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞)',
        'tile_gable': '–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞ (–¥–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞)'
      };
      const baseName = materialNames[selRoofMat.value] || roofLabel.split('(')[0].trim();
      roofLabel = `${baseName} ${selectedProfColor.name} (${selectedProfColor.code})`;
    }
    addExtra(ROOFMAT[selRoofMat.value] * warmArea, roofLabel);
  }

  /* --- 3. –î–æ–ø–ª–∞—Ç–∞ –∑–∞ –¥–≤—É—Å–∫–∞—Ç–Ω—É—é –∫—Ä—ã—à—É –¥–ª—è —Ö–æ–∑–±–ª–æ–∫–æ–≤/–±—ã—Ç–æ–≤–æ–∫ --- */
  if (!isEconomy && type !== "house") {
    const roof = document.querySelector('input[name="roof"]:checked').value;
    if (roof === "gable") {
      addExtra(1800 * warmArea, "–î–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞");
    }
  }


// --- –í–ï–†–êH–îA: –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏ –ª—é–±–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ ---
if (!isEconomy && vw > 0 && vd > 0) {
  // 3.1 —Ü–µ–Ω—É –±–µ—Ä—ë–º:    –æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è = 7 500 ‚ÇΩ/–º¬≤   |   –¥–≤—É—Å–∫–∞—Ç–Ω–∞—è = 9 000 ‚ÇΩ/–º¬≤
  //    verRoof —É–∂–µ "verRoof" –∏–ª–∏ "verGable" (7500 / 9000)
  const priceKey = verRoof;

  // 3.2 –ø–æ–¥–ø–∏—Å—å: –µ—Å–ª–∏ —á–µ–∫-–±–æ–∫—Å ¬´–≤–Ω—É—Ç—Ä.¬ª —Å—Ç–æ–∏—Ç ‚Äì –¥–æ–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–º–µ—Ç–∫—É
  const label = `–í–µ—Ä–∞–Ω–¥–∞ ${vw}√ó${vd} –º${ isInsideVer ? " (–≤–Ω—É—Ç—Ä.)" : "" }`;

  addExtra( VERANDA[priceKey] * verArea, label );
}




  /* --- 5. –®–ø—É–Ω—Ç-–ø–æ–ª, –≤—ã—Å–æ—Ç–∞ –∏ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª --- */
if (!isEconomy) {
  floorCode = document.getElementById('selFloor').value;
const floorExtra = FLOOR_MAT[floorCode] * warmArea;
if (floorExtra) addExtra(floorExtra, FLOOR_CAPT[floorCode]);

  // ‚ñ∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ã—á–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏)
const extraH = +inpExtraH.value || 0;        // –≤–≤–µ–¥–µ–Ω–æ –≤ —Å–º
if (extraH > 0) {
  const steps = Math.ceil(extraH / 10);
  // –£—á–∏—Ç—ã–≤–∞–µ–º –û–ë–©–£–Æ –ø–ª–æ—â–∞–¥—å —Å—Ç—Ä–æ–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è –≤–µ—Ä–∞–Ω–¥—É)
  const totalArea = w * l; // –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å –±–µ–∑ –≤—ã—á–µ—Ç–∞ –≤–µ—Ä–∞–Ω–¥—ã
  const addH  = steps * pricePer10cm(totalArea);
  addExtra(addH, `–í—ã—Å–æ—Ç–∞ +${extraH} —Å–º`);
  // heightNote –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –≤—ã—Å–æ—Ç—ã
}

// –°–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –ø–æ–∑–∂–µ –≤ –±–ª–æ–∫–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π


  /* --- 6. –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏ --- */
  if (!isEconomy) {
    const selPartitionType = document.getElementById('selPartitionType');
    const inpPartitionLength = document.getElementById('inpPartitionLength');
    
    if (selPartitionType && inpPartitionLength) {
      partType = selPartitionType.value;
      partLen  = parseFloat(inpPartitionLength.value) || 0;
      if (partType && partLen > 0) {
        // –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —Å PART_TITLE
        const partitionPrice = PART[partType] || 0;
        if (partitionPrice > 0) {
          addExtra(partitionPrice * partLen, `${PART_TITLE[partType]} (${partLen} –º)`);
        }
      }
    }
  }

  /* --- 8. –°–≤–∞–∏ (–ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê) --- */
  if (!isEconomy) {
    const selSvaiType = document.getElementById('selSvaiType');
    if (selSvaiType && selSvaiType.value) {
      const dim = selSvaiType.value;
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π –ø–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ (—Å —É—á–µ—Ç–æ–º –≤–µ—Ä–∞–Ω–¥—ã)
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º vw (—à–∏—Ä–∏–Ω–∞ –≤–µ—Ä–∞–Ω–¥—ã) –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ calculate()
      let verandaWidthForPiles = 0;
      if (type === 'house' && vw > 0 && !isInsideVer) {
        // –î–ª—è –∫–∞—Ä–∫–∞—Å–Ω–æ–≥–æ –¥–æ–º–∞: –≤–µ—Ä–∞–Ω–¥–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∏—Ä–∏–Ω—É —Å—Ç—Ä–æ–µ–Ω–∏—è
        verandaWidthForPiles = vw;
      } else if ((type === 'hoblok' || type === 'bytovka') && selectedVeranda) {
        // –î–ª—è —Ö–æ–∑–±–ª–æ–∫–æ–≤/–±—ã—Ç–æ–≤–æ–∫ —Å –≤–µ—Ä–∞–Ω–¥–æ–π –∏–∑ –ø—Ä–∞–π—Å–∞ - –≤–µ—Ä–∞–Ω–¥–∞ —É–∂–µ —É—á—Ç–µ–Ω–∞ –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö
        verandaWidthForPiles = 0;
      }
      
      const cnt = calculatePilesByRows(l, w, verandaWidthForPiles, isInsideVer);
      
      // –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –∑–∞ —Å–≤–∞—é (–ë–ï–ó –Ω–∞—Ü–µ–Ω–∫–∏)
      const pricePerPile = PILES_STANDARD[dim];
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—É
      let totalPrice;
      if (dim === "1.5√ó76" && cnt >= 16) {
        totalPrice = grossInt(3350 * cnt); // 3350‚ÇΩ/—à—Ç –¥–ª—è 16+ —à—Ç—É–∫ + 10%
      } else {
        totalPrice = grossInt(pricePerPile * cnt); // –æ–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ + 10%
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –¥–æ–ø—ã (–±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞)
      addExtra(totalPrice, `–°–≤–∞–π–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç ${dim} √ó ${cnt} —à—Ç`, true);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–µ—Å–ª–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –≤–µ—Ä–∞–Ω–¥—ã)
      const showWarning = !window.__updatePilesWithoutWarning;
      checkScrewPileBrigade(dim, cnt, showWarning);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ —Å–µ–ª–µ–∫—Ç–∞ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
      updatePileSelectText(selSvaiType, dim, cnt, pricePerPile);
      } else {
      // –ï—Å–ª–∏ —Å–≤–∞–∏ —É–±—Ä–∞–Ω—ã, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏
      screwPileWarningShown = false;
      lastPileType = null;
    }
  }

  /* --- 9. –ü–∞–Ω–¥—É—Å --- */
if (!isEconomy && chkRamp && chkRamp.checked) {
  addExtra(RAMP, "–ü–∞–Ω–¥—É—Å");
}

  /* --- 10. –°–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ª–∏–Ω–µ–µ–∫ --- */
if (!isEconomy && chkMouseNew.checked) {
  const price = grossInt(FLOOR.mouse) * warmArea; // –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Ü–µ–Ω–∫—É 10%
  addExtra(price, "–°–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª");
}

// 5-–ë–ò–°) —Ñ–∏–∫—Å–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ –æ–∫–Ω–∞ / –¥–≤–µ—Ä–∏ (–∏—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)

// ------------------------------------------------------------------

  /* --- 9. –û–∫–Ω–∞ / –¥–≤–µ—Ä–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã) --- */
if (!isEconomy) {
windowsContainer.querySelectorAll(".window-row").forEach(row => {
  const kind = row.querySelector(".win-type").value;   // pvcWin | woodWin | pvcDoor | woodDoor
  const cam  = row.querySelector(".win-cam").value;
  const sel  = row.querySelector(".win-size");
  const code = sel.value;                 // —Å—Ç—Ä–æ–∫–∞-–∫–æ–¥ –∏–∑ <option value="‚Ä¶">
  const qty  = +row.querySelector(".win-qty").value || 1;
  if (!code) return;                      // –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ

  let price = 0, caption = "";

  switch (kind) {
  /* ---------- –û–ö–ù–ê ---------- */
  case "pvcWin": {                        // –æ–∫–Ω–æ –ü–í–•
    price   = WINDOWS[code][cam];
    // –í–∫–ª—é—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–º–µ—Ä–∞—Ö –≤ caption –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
    const camText = cam === '1' ? '1-–∫–∞–º.' : cam === '2' ? '2-–∫–∞–º.' : '';
    caption = `–û–∫–Ω–æ –ü–í–• ${code}${camText ? ' ' + camText : ''}`;
    if (price) {
      addWindowExtra(price, caption, qty);
      pvcWindowLines.push(`‚Äì ${caption} (${qty} —à—Ç)`); // –ö–æ–ø–∏–º –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
    }
  pvcWindowsAdded = true;
    break;
  }

  case "woodWin": {                // –æ–∫–Ω–æ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ
  price   = WOOD_PRICES.win[code];
  caption = `–û–∫–Ω–æ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ ${code}`;

  // –µ—Å–ª–∏ —ç—Ç–æ –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä ‚Äì –ø—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫
  if (code === baseWinSize) {
    baseWinQty += qty;
  } else {
    pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);
  }

  if (price) addWindowExtra(price, caption, qty);
  break;
}

  /* ---------- –î–í–ï–†–ò ---------- */
  case "pvcDoor": {                       // –¥–≤–µ—Ä—å –ü–í–•
    price   = WINDOWS[code][2] || WINDOWS[code][1];
    caption = `–î–≤–µ—Ä—å –ü–í–• ${code}`;
    if (price) addExtra(price * qty, `${caption} (${qty} —à—Ç)`);
    pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);        // ‚Üê –î–û–ë–ê–í–õ–Ø–ï–ú
    break;
  }

  case "woodDoor": {               // –¥–≤–µ—Ä—å –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è
  price = WOOD_PRICES.door[code];
  const cap = { std:"–û–±—ã—á–Ω–∞—è", hinge:"–†–∞—Å–ø–∞—à–Ω–∞—è",
                hingeWarm:"–†–∞—Å–ø–∞—à–Ω–∞—è —É—Ç–µ–ø–ª—ë–Ω–Ω–∞—è", filen:"–§–∏–ª–µ–Ω—á–∞—Ç–∞—è" }[code];
  caption = `–î–≤–µ—Ä—å –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è (${cap})`;

  if (code === "std") {          // –±–∞–∑–æ–≤–∞—è ¬´—Å–∞–º–æ–Ω–∞–±–æ—Ä–Ω–∞—è¬ª
    baseDoorQty += qty;
  } else {
    pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);
  }

  if (price) addExtra(price * qty, `${caption} (${qty} —à—Ç)`);
  break;
}

  case "metalDoor": {                     // –¥–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è
    price   = METAL_PRICES[code];
    caption = { rf:"–î–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¢—É–ª–∞",
                rfThermo:"–î–≤–µ—Ä—å –†–§ (—Ç–µ—Ä–º–æ)",
                thermoLux:"–î–≤–µ—Ä—å —Ç–µ—Ä–º–æ–ª—é–∫—Å" }[code];
    if (price) addExtra(price * qty, `${caption} (${qty} —à—Ç)`);
    pushPkg(`‚Äì ${caption} (${qty} —à—Ç)`);        // ‚Üê –î–û–ë–ê–í–õ–Ø–ï–ú
    break;
  }
}

});
} // –∑–∞–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –æ–∫–æ–Ω/–¥–≤–µ—Ä–µ–π –¥–ª—è !isEconomy

  // –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ–∫–Ω–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ extraMap
  Object.entries(windowsGroup).forEach(([baseCaption, data]) => {
    const totalPrice = data.pricePerUnit * data.qty;
    const finalSum = grossInt(totalPrice);
    extras += finalSum;
    extraMap[`${baseCaption} (${data.qty} —à—Ç)`] = finalSum;
  });

  /* ===== 8.4. –õ–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–∫–∏ (–∑–∞–º–µ–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞) ===== */
  
  // –ï—Å–ª–∏ —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∞ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –æ—Ç–¥–µ–ª–∫–∏
  if (isEconomy) {
    // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é
    finalInt = null; // –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—Ç–¥–µ–ª–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    finalExt = "profGalv"; // –ø—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  } else {

// –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ¬´–æ–∫—Ä—É–≥–ª–∏—Ç—å –≤–≤–µ—Ä—Ö –¥–æ –±–ª–∏–∂–∞–π—à–∏—Ö 3 –º¬≤¬ª
const round3 = m => Math.ceil(m / 3) * 3;
const IMIT   = new Set(['imitB', 'imitA']);   // –≤—Å—ë, —á—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è ¬´–∏–º–∏—Ç–∞—Ü–∏–µ–π¬ª

/* --- 8.4.1. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ --- */
if (type === "hoblok") {
  /* ‚îÄ‚îÄ 1. –ë–µ–∑ –æ—Ç–¥–µ–ª–∫–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  if (selInRep.value === "none") {
    finalInt = null;           // –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–≤–æ–¥–∏–º –≤ ¬´–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é¬ª
    /* ‚îÄ‚îÄ 2. –¢–æ–ª—å–∫–æ –û–°–ë-3 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  } else if (selInRep.value === "osb_only") {
  // ¬´—á–∏—Å—Ç–∞—è –û–°–ë-3¬ª
  const cost = getOsbArea(w, l) * OSB_PLAIN;
  addExtra(cost, "–û–°–ë –ø–ª–∏—Ç–∞");   // ‚ú¶ —Ç–µ–ø–µ—Ä—å —Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å—å
  finalInt = "osb";

} else {  // osb_vag, osb_imit, osb_vagA, osb_block
  // —Å—Ç–æ–∏–º–æ—Å—Ç–∏ ¬´–¥–æ–≤–µ—Å—Ç–∏ –¥–æ –û–°–ë¬ª  +  ¬´–∑–∞–º–µ–Ω–∏—Ç—å –û–°–ë –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª¬ª
  const osbCost = getOsbArea(w, l) * OSB_PLAIN;   // —à–∞–≥ 1

  const codeMapIn = {                 // –∫–∞–∫–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    osb_vag:  "vagBC",
    osb_imit: "imitB",
    osb_vagA: "vagA",
    osb_block:"block"
  };
  const intTgt  = codeMapIn[selInRep.value];

  // —à–∞–≥ 2 ‚Äî –∑–∞–º–µ–Ω–∞ –û–°–ë ‚Üí –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª
  const priceIn = (REPLACEMENT_PRICES.osb || {})[intTgt] || 0;

  const h  = getWallHeight(type, "lom", false);   // –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–æ—Å–∫–∞—Ç
  const S  = wallArea(w, l, h) + w * l;           // —Å—Ç–µ–Ω—ã + –ø–æ—Ç–æ–ª–æ–∫
  const A  = ["imitB","imitA"].includes(intTgt) ? Math.ceil(S/3)*3 : S;

  const totalFinish = osbCost + priceIn * A;      // –≤—Å—ë –≤–º–µ—Å—Ç–µ

  addExtra(totalFinish, MATERIAL_NAME[intTgt]);   // üëâ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ –ö–ü
  finalInt = intTgt;
}
} else {
  /* ‚îÄ‚îÄ –°–¢–ê–†–´–ô –∫–æ–¥ –¥–ª—è –¥–æ–º–∞ –∏ –±—ã—Ç–æ–≤–∫–∏ ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚îÄ‚îÄ */
  if (selInRep.value !== "none") {
    const roof    = document.querySelector('input[name="roof"]:checked').value;
    const intBase = (type === "house")
      ? (roof === "lom" ? "osb" : "vagBC")
      : "osb";

    const codeMapIn = {
      osb_vag:"vagBC", osb_imit:"imitB", osb_vagA:"vagA", osb_block:"block",
      vag_imitBC:"imitB", vag_imitA:"imitA", vag_block:"block"
    };
    const intTgt  = codeMapIn[selInRep.value];
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥–æ–º–æ–≤ —Å –ª–æ–º–∞–Ω–æ–π –∫—Ä—ã—à–µ–π
    if (type === "house" && roof === "lom") {
      if (selInRep.value === 'osb_vag') {
        // –í–∞–≥–æ–Ω–∫–∞ B-C –∫–ª–∞—Å—Å–∞: –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ 11,000‚ÇΩ/–º¬≤ (—É–∂–µ —É—á—Ç–µ–Ω–æ –≤—ã—à–µ)
        // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–ª–∞—Ç—É, —Ç–æ–ª—å–∫–æ –º–µ–Ω—è–µ–º finalInt –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ö–ü
        finalInt = "vagBC";
      } else {
        // –î–ª—è –≤–∞–≥–æ–Ω–∫–∏ A –∫–ª–∞—Å—Å–∞ –∏ –¥—Ä—É–≥–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–ª–∞—Ç—É –∫–∞–∫ –æ–±—ã—á–Ω–æ
        const priceIn = (REPLACEMENT_PRICES[intBase] || {})[intTgt] || 0;
        const intH       = getWallHeight(type, roof, false);
        const wallSquare = wallArea(w, l, intH);
        const ceilSquare = w * l;
        let areaInTot    = wallSquare + ceilSquare;
        if (IMIT.has(intTgt)) areaInTot = round3(areaInTot);

        addExtra(priceIn * areaInTot,
                 `${MATERIAL_NAME[intBase]} ‚Üí ${MATERIAL_NAME[intTgt]}`);
        finalInt = intTgt;
      }
    } else {
      // –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞–µ–≤
      const priceIn = (REPLACEMENT_PRICES[intBase] || {})[intTgt] || 0;

      const intH       = getWallHeight(type, roof, false);
      const wallSquare = wallArea(w, l, intH);
      const ceilSquare = w * l;
      let areaInTot    = wallSquare + ceilSquare;
      if (IMIT.has(intTgt)) areaInTot = round3(areaInTot);

      addExtra(priceIn * areaInTot,
               `${MATERIAL_NAME[intBase]} ‚Üí ${MATERIAL_NAME[intTgt]}`);
      finalInt = intTgt;
    }
  } else {
    finalInt = (type === "house")
      ? (document.querySelector('input[name="roof"]:checked').value === "lom"
           ? "osb" : "vagBC")
      : "osb";
  }
}

/* --- 8.4.2. –ù–∞—Ä—É–∂–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ --- */
if (selOutRep.value !== "none") {
  const roof     = document.querySelector('input[name="roof"]:checked').value;
  const extBase  = (type === "house")
      ? (roof === "lom" ? "vagBC" : "imitB")
      : "vagBC";

  const codeMapOut = {
  vag_ext:"vagBC",                     // ‚Üê –±–∞–∑–æ–≤–∞—è B-C, –∑–∞–º–µ–Ω—ã –Ω–µ—Ç
  imitBC_ext:"imitB", imitA_ext:"imitA",
  block_ext:"block", osb_extA:"vagA", vag_extA:"vagA",profGalv:  "profGalv"
};
  const extTgt   = codeMapOut[selOutRep.value] || "vagA";
  const priceOut = (REPLACEMENT_PRICES[extBase] || {})[extTgt] || 0;

  const extH     = getWallHeight(type, roof, true);
const areaOut  = IMIT.has(extTgt) ? round3(wallArea(w, l, extH))
                                  : wallArea(w, l, extH);
  addExtra(priceOut * areaOut,
           `${MATERIAL_NAME[extBase]} ‚Üí ${MATERIAL_NAME[extTgt]}`);

  finalExt = extTgt;
} else {
  finalExt = (type === "house")
      ? (document.querySelector('input[name="roof"]:checked').value === "lom" ? "vagBC" : "imitB")
      : "vagBC";
}
  } // –∑–∞–∫—Ä—ã–≤–∞–µ–º else –¥–ª—è isEconomy

  /* ===== 8.5. –ò—Ç–æ–≥–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ö–ü ===== */
  
/* ‚îÄ‚îÄ‚îÄ –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å —É—á—ë—Ç–æ–º –≤–µ—Ä–∞–Ω–¥—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
// –µ—Å–ª–∏ –≤–≤–µ–ª–∏ –æ–±–∞ —Ä–∞–∑–º–µ—Ä–∞ ‚Äì –¥–æ–±–∞–≤–ª—è–µ–º —Ö–≤–æ—Å—Ç  ¬´+ –≤–µ—Ä–∞–Ω–¥–∞ ‚Ä¶√ó‚Ä¶¬ª
let verTitle = "";
if (vw > 0 && vd > 0){
  verTitle = isInsideVer
    ? `, –≤–∫–ª—é—á–∞—è –≤–µ—Ä–∞–Ω–¥—É ${vw}√ó${vd}`
    : ` + –≤–µ—Ä–∞–Ω–¥–∞ ${vw}√ó${vd}`;
}

// –∏—Ç–æ–≥–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ö–ü
let total = basePrice + del + extras;

// –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ —Ü–µ–Ω—ã —É–∂–µ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞
if (isEconomy) {
  total = Math.round(total / 50) * 50; // —Ç–æ–ª—å–∫–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫ 50
}
const roofType = document.querySelector('input[name="roof"]:checked')?.value || "lom";
// –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å —É—á–µ—Ç–æ–º –≤–µ—Ä–∞–Ω–¥—ã –∏–∑ –ø—Ä–∞–π—Å–∞
let title;
if (verandaFromPrice) {
  // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –≤–µ—Ä–∞–Ω–¥–∞ –∏–∑ –ø—Ä–∞–π—Å–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä
  const totalSize = `${w}√ó${l}`;
  const mainSize = verandaFromPrice.main;
  const verandaSize = verandaFromPrice.veranda;
  title = `${selType.options[selType.selectedIndex].text} ${totalSize} (${mainSize} + –≤–µ—Ä–∞–Ω–¥–∞ ${verandaSize}) ‚Äî –ø–æ–¥ –∫–ª—é—á`;
} else if (type === "house") {
  title = `–ö–∞—Ä–∫–∞—Å–Ω—ã–π –¥–æ–º ${roofType === "lom" ? "—Å –Ω–∏–∑–∫–∏–º —Å–∫–∞—Ç–æ–º –∫—Ä—ã—à–∏" : "—Å –¥–≤—É—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–µ–π"} ${w}√ó${l}${verTitle} ‚Äî –ø–æ–¥ –∫–ª—é—á`;
} else {
  // –î–ª—è –±—ã—Ç–æ–≤–æ–∫ –∏ —Ö–æ–∑–±–ª–æ–∫–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –∫—Ä—ã—à–∏
  const roofText = roofType === "gable" ? "—Å –¥–≤—É—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–µ–π" : "—Å –æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–µ–π";
  title = `${selType.options[selType.selectedIndex].text} ${roofText} ${w}√ó${l}${verTitle} ‚Äî –ø–æ–¥ –∫–ª—é—á`;
}


/* ‚îÄ‚îÄ‚îÄ –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –±–ª–æ–∫ ¬´–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è¬ª ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const lines = [
  `üè† *${title}*`,
  ``,
  `üèóÔ∏è *–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è:*`,
  ``
];
/* ===== 8.6. –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è (—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) ===== */

  // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ (–ø–æ –ø—Ä–∞–π—Å—É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
  if (isEconomy) {
    // 1) –¢–∏–ø —Å—Ç—Ä–æ–µ–Ω–∏—è
    const buildingType = type === 'hoblok_economy' ? '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π —Ö–æ–∑–±–ª–æ–∫' : '–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –±—ã—Ç–æ–≤–∫–∞';
    pushPkg(`‚Äì –¢–∏–ø: ${buildingType}`);
    
    // 2) –†–∞–∑–º–µ—Ä—ã
    pushPkg(`‚Äì –í–Ω–µ—à–Ω–∏–π —Ä–∞–∑–º–µ—Ä: ${w}√ó${l} –º`);
    
    // 3) –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞
    pushPkg("‚Äì –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞: 1 –∫–æ–º–Ω–∞—Ç–∞");
    
    // 4) –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–∞
    pushPkg("‚Äì –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–∞: 1,95√ó2,14 –º");
    
    // 5) –ö–∞—Ä–∫–∞—Å
    pushPkg("‚Äì –û–±–≤—è–∑–æ—á–Ω—ã–π –±—Ä—É—Å: 90√ó90 –º–º, –æ–±—Ä–µ–∑–Ω–æ–π, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ 25%");
    pushPkg("‚Äì –ö–∞—Ä–∫–∞—Å: 45√ó45 –º–º –æ–±—Ä–µ–∑–Ω–æ–π, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏");
    
    // 6) –í–Ω–µ—à–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞
    pushPkg("‚Äì –í–Ω–µ—à–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞: –≤–∞–≥–æ–Ω–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –° (–Ω–µ–±–æ–ª—å—à–∏–µ –¥—ã—Ä–∫–∏ –æ—Ç —Å—É—á–∫–æ–≤ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–µ–Ω–æ–π)");
    
    // 7) –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ (–±–∞–∑–æ–≤–∞—è –ø–æ –ø—Ä–∞–π—Å—É –∏–ª–∏ –∑–∞–º–µ–Ω–µ–Ω–Ω–∞—è –æ–ø—Ü–∏–µ–π)
    const interiorFinish = document.querySelector('input[name="interiorFinish"]:checked')?.value;
    
    if (type === 'hoblok_economy') {
      if (interiorFinish === 'osb') {
        pushPkg("‚Äì –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞: –û–°–ü-9");
      } else if (interiorFinish === 'vagonka') {
        pushPkg("‚Äì –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞: –≤–∞–≥–æ–Ω–∫–∞ '–°'");
      } else {
        pushPkg("‚Äì –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞: –Ω–µ—Ç");
      }
    } else {
      if (interiorFinish === 'osb') {
        pushPkg("‚Äì –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞: –û–°–ü-9");
      } else if (interiorFinish === 'vagonka') {
        pushPkg("‚Äì –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞: –≤–∞–≥–æ–Ω–∫–∞ '–°'");
      } else {
        pushPkg("‚Äì –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞: –æ—Ä–≥–∞–ª–∏—Ç (–î–í–ü) 0,35 –º–º");
      }
    }
    
    // 8) –ö—Ä—ã—à–∞
    const roofType = document.querySelector('input[name="economyRoof"]:checked')?.value;
    let roofText = "‚Äì –ö—Ä—ã—à–∞: –æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è";
    if (roofType === 'gable_length') {
      roofText = "‚Äì –ö—Ä—ã—à–∞: –¥–≤—É—Å–∫–∞—Ç–Ω–∞—è –ø–æ –¥–ª–∏–Ω–µ";
    } else if (roofType === 'gable_width') {
      roofText = "‚Äì –ö—Ä—ã—à–∞: –¥–≤—É—Å–∫–∞—Ç–Ω–∞—è –ø–æ —à–∏—Ä–∏–Ω–µ";
    }
    pushPkg(roofText);
    
    // 9) –ö—Ä–æ–≤–ª—è
    pushPkg("‚Äì –ö—Ä–æ–≤–ª—è: –ø—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π –°8");
    
    // 10) –ü–æ–ª
    if (type === 'bytovka_economy') {
      pushPkg("‚Äì –ü–æ–ª: –≤–µ—Ç—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è, —á–µ—Ä–Ω–æ–≤–æ–π (–æ–±—Ä–µ–∑–Ω–∞—è –¥–æ—Å–∫–∞ 2-–≥–æ —Å–æ—Ä—Ç–∞ 22 –º–º), —á–∏—Å—Ç–æ–≤–æ–π (–æ–±—Ä–µ–∑–Ω–∞—è –¥–æ—Å–∫–∞ 2-–≥–æ —Å–æ—Ä—Ç–∞ 22 –º–º), –û–°–ü-9");
    } else {
      pushPkg("‚Äì –ü–æ–ª: –æ–±—Ä–µ–∑–Ω–∞—è –¥–æ—Å–∫–∞ 2-–≥–æ —Å–æ—Ä—Ç–∞ 22 –º–º");
    }
    
    // 11) –£—Ç–µ–ø–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Ç–æ–≤–æ–∫ —ç–∫–æ–Ω–æ–º)
    if (type === 'bytovka_economy') {
      const hasInsulation100 = document.getElementById('chkInsulation100')?.checked;
      if (hasInsulation100) {
        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ —É—Ç–µ–ø–ª–µ–Ω–∏–µ 100 –º–º, –∑–∞–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤–æ–µ
        pushPkg("‚Äì –£—Ç–µ–ø–ª–∏—Ç–µ–ª—å: 100 –º–º –º–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ç–∞, —É—Ç–µ–ø–ª–µ–Ω—ã —Å—Ç–µ–Ω—ã, –ø–æ–ª, –ø–æ—Ç–æ–ª–æ–∫");
      } else {
        // –ë–∞–∑–æ–≤–æ–µ —É—Ç–µ–ø–ª–µ–Ω–∏–µ 50 –º–º
        pushPkg("‚Äì –£—Ç–µ–ø–ª–∏—Ç–µ–ª—å: 50 –º–º –º–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ç–∞, —É—Ç–µ–ø–ª–µ–Ω—ã —Å—Ç–µ–Ω—ã, –ø–æ–ª");
      }
    } else if (type === 'hoblok_economy') {
      // –•–æ–∑–±–ª–æ–∫–∏ —ç–∫–æ–Ω–æ–º –±–µ–∑ —É—Ç–µ–ø–ª–µ–Ω–∏—è
      pushPkg("‚Äì –£—Ç–µ–ø–ª–∏—Ç–µ–ª—å: –Ω–µ—Ç");
    } else {
      pushPkg("‚Äì –£—Ç–µ–ø–ª–∏—Ç–µ–ª—å: –Ω–µ—Ç");
    }
    
    // 12) –û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏ (–±–∞–∑–æ–≤—ã–µ –ø–æ –ø—Ä–∞–π—Å—É)
    pushPkg(`‚Äì –û–∫–Ω–∞: ${baseWinQty} —à—Ç –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ, —Ä–∞–∑–º–µ—Ä ${baseWinSize}, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –æ–¥–∏–Ω–∞—Ä–Ω–æ–µ`);
    pushPkg(`‚Äì –î–≤–µ—Ä—å: ${baseDoorQty} —à—Ç –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –Ω–∞–±–æ—Ä–Ω–∞—è, –æ–±—à–∏—Ç–∞ –≤–∞–≥–æ–Ω–∫–æ–π –°`);
    
    // 10) –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã)
    if (document.getElementById('chkCeilingInsulation')?.checked) {
      pushPkg("‚Äì –£—Ç–µ–ø–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–ª–∫–∞ 50 –º–º");
    }
    // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é –≤—ã—à–µ
    // –£—Ç–µ–ø–ª–µ–Ω–∏–µ 100 –º–º —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±–∞–∑–æ–≤—É—é –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é –≤—ã—à–µ
    if (document.getElementById('chkFireProtectionFloor')?.checked) {
      pushPkg("‚Äì –û–≥–Ω–µ–±–∏–æ–∑–∞—â–∏—Ç–∞ –ø–æ–ª–∞");
    }
    if (document.getElementById('chkFireProtectionFrame')?.checked) {
      pushPkg("‚Äì –û–≥–Ω–µ–±–∏–æ–∑–∞—â–∏—Ç–∞ –∫–∞—Ä–∫–∞—Å–∞");
    }
    if (type === 'bytovka_economy' && document.getElementById('chkVaporBarrier')?.checked) {
      pushPkg("‚Äì –ü–∞—Ä–æ- –∏ –≤–µ—Ç—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è");
    }
    if (document.getElementById('chkSteps')?.checked) {
      pushPkg("‚Äì –°—Ç—É–ø–µ–Ω–∏");
    }
    if (document.getElementById('chkRamp75')?.checked) {
      pushPkg("‚Äì –ü–∞–Ω–¥—É—Å 75 —Å–º");
    }
    if (document.getElementById('chkRamp160')?.checked) {
      pushPkg("‚Äì –ü–∞–Ω–¥—É—Å 160-180 —Å–º");
    }
    
    // 11) –°–≤–∞–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã)
    const svaiType = document.getElementById('selEconomySvaiType')?.value;
    if (svaiType) {
      const w = parseFloat(inpWidth.value) || 0;
      const l = parseFloat(inpLength.value) || 0;
      const sizeKey = `${w}x${l}`;
      const recommendation = CONFIG[type].svai.recommendations[sizeKey];
      if (recommendation) {
        const prices = {
          "76x150": 4840,
          "76x200": 5390,
          "89x200": 6050,
          "89x250": 6490,
          "89x300": 7150
        };
        const svaiPrice = prices[svaiType];
        if (svaiPrice) {
          const svaiTotal = svaiPrice * recommendation;
          pushPkg(`‚Äì –°–≤–∞–∏ ${svaiType} (${recommendation} —à—Ç): ${formatPrice(svaiTotal)} ‚ÇΩ`);
        }
      }
    }
    
    // 12) –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã)
    const windowsContainerEconomy = document.getElementById('windowsContainerEconomy');
    if (windowsContainerEconomy) {
      windowsContainerEconomy.querySelectorAll('.window-row').forEach(row => {
        const type = row.querySelector('.win-type')?.value;
        const size = row.querySelector('.win-size')?.value;
        const qty = parseInt(row.querySelector('.win-qty')?.value) || 0;
        
        if (type && size && qty > 0) {
          let price = 0;
          let label = "";
          
          if (type === 'woodWin') {
            price = ECONOMY_EXTRAS.windowsDoors.woodWindows[size] || 0;
            label = `–î–æ–ø. –æ–∫–Ω–æ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ ${size}`;
          } else if (type === 'pvcWin') {
            price = ECONOMY_EXTRAS.windowsDoors.pvcWindows[size] || 0;
            label = `–î–æ–ø. –æ–∫–Ω–æ –ü–í–• ${size}`;
          } else if (type === 'woodDoor') {
            price = ECONOMY_EXTRAS.windowsDoors.woodDoors[size] || 0;
            label = `–î–æ–ø. –¥–≤–µ—Ä—å –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è ${size}`;
          } else if (type === 'metalDoor') {
            price = ECONOMY_EXTRAS.windowsDoors.metalDoors[size] || 0;
            label = `–î–æ–ø. –¥–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è ${size}`;
          } else if (type === 'interiorDoor') {
            price = ECONOMY_EXTRAS.windowsDoors.interiorDoors[size] || 0;
            label = `–î–æ–ø. –¥–≤–µ—Ä—å –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è ${size}`;
          }
          
          if (price > 0) {
            const total = price * qty;
            pushPkg(`‚Äì ${label} (${qty} —à—Ç): ${formatPrice(total)} ‚ÇΩ`);
          }
        }
      });
    }
    
    // 13) –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã)
    const partitionsContainer = document.getElementById('partitionsContainerEconomy');
    if (partitionsContainer) {
      partitionsContainer.querySelectorAll('.partition-row').forEach(row => {
        const material = row.querySelector('.partition-material')?.value;
        const size = row.querySelector('.partition-size')?.value;
        const qty = parseInt(row.querySelector('.partition-qty')?.value) || 0;
        
        if (material && size && qty > 0) {
          const partitionPrices = {
            'organlit_2': 6600,    // 6000 + 10%
            'organlit_2.5': 7700,  // 7000 + 10%
            'organlit_3': 8250,    // 7500 + 10%
            'osb_2': 7700,         // 7000 + 10%
            'osb_2.5': 8800,       // 8000 + 10%
            'osb_3': 9900,         // 9000 + 10%
            'vagonka_2': 13200,    // 12000 + 10%
            'vagonka_2.5': 15950,  // 14500 + 10%
            'vagonka_3': 16500,    // 15000 + 10%
            'hoblok_2': 5500,      // 5000 + 10%
            'hoblok_2.5': 7150,    // 6500 + 10%
            'hoblok_3': 8250       // 7500 + 10%
          };
          
          const price = partitionPrices[size] || 0;
          if (price > 0) {
            const optionText = row.querySelector('.partition-size').selectedOptions[0].text;
            const materialText = row.querySelector('.partition-material').selectedOptions[0].text;
            // –£–±–∏—Ä–∞–µ–º —Ü–µ–Ω—É –∏–∑ optionText –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
            const cleanOptionText = optionText.replace(/ ‚Äî \d+[\s,]*\d*‚ÇΩ/, '');
            pushPkg(`‚Äì –°—Ç–µ–Ω–∞ ${materialText.toLowerCase()} ${cleanOptionText} (${qty} —à—Ç)`);
          }
        }
      });
    }
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
    const currentFormat = window.kpFormat || 'whatsapp';
    const groupedPkg = groupKomplektatsiya(pkg, currentFormat);
    groupedPkg.forEach(l => {
      // –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≥—Ä—É–ø–ø (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "‚Ä¢") –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
      if (l === '' || l.startsWith('‚Ä¢')) {
        lines.push(l);
      } else {
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è–µ–º —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "‚Äì " –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        let line = l.startsWith('‚Äì') ? l : '‚Äì ' + l;
        lines.push(line);
      }
    });
    
} else {
  // –û–±—ã—á–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
// 0) –ö–∞—Ä–∫–∞—Å (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å)
pushPkg("‚Äì –ö–∞—Ä–∫–∞—Å: –±—Ä—É—Å 50√ó100 –º–º (1 —Å–æ—Ä—Ç, —Ö–≤–æ–π–Ω—ã–π)");
pushPkg("‚Äì –ü–æ–ª–æ–∑—å—è: 150√ó100 –º–º");

// 1) –û—Ç–¥–µ–ª–∫–∞ (–æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π –±–ª–æ–∫)
if (finalInt) {
  // –ï—Å–ª–∏ –µ—Å—Ç—å –∏ –Ω–∞—Ä—É–∂–Ω–∞—è, –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤ –æ–¥–∏–Ω –±–ª–æ–∫
  pushPkg(`‚Äì –û—Ç–¥–µ–ª–∫–∞`);
  pushPkg(`  –ù–∞—Ä—É–∂–Ω–∞—è: ${MATERIAL_NAME[finalExt]}`);
  pushPkg(`  –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è: ${MATERIAL_NAME[finalInt]}`);
} else {
  // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞—Ä—É–∂–Ω–∞—è ‚Äî –≤—ã–≤–æ–¥–∏–º –∫–∞–∫ —Ä–∞–Ω—å—à–µ
  pushPkg(`‚Äì –ù–∞—Ä—É–∂–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞: ${MATERIAL_NAME[finalExt]}`);
}


// 3) –ö—Ä—ã—à–∞ (–¥–ª—è –±—ã—Ç–æ–≤–æ–∫ –∏ —Ö–æ–∑–±–ª–æ–∫–æ–≤)
if (type !== "house") {
  const roofText = roofType === "gable" ? "–¥–≤—É—Å–∫–∞—Ç–Ω–∞—è" : "–æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è";
  pushPkg(`‚Äì –ö—Ä—ã—à–∞: ${roofText}`);
}

// 4) –£—Ç–µ–ø–ª–µ–Ω–∏–µ
if (type !== "hoblok") {
  let label;
  if (selInsul.value === "none") {
    // –ë–∞–∑–æ–≤–æ–µ —É—Ç–µ–ø–ª–µ–Ω–∏–µ
    label = (type === "bytovka"
      ? "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ç–∞ 50 –º–º"
      : "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ç–∞ 100 –º–º");
  } else {
    // –í—ã–±—Ä–∞–Ω–Ω–æ–µ —É—Ç–µ–ø–ª–µ–Ω–∏–µ
    label = getLabel(selInsul.selectedOptions[0]);
    // –£–±–∏—Ä–∞–µ–º "+ –≤–µ—Ç—Ä–æ-–≤–ª–∞–≥–æ–∏–∑–æ–ª—è—Ü–∏—è" –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –µ—Å—Ç—å –≤ label (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏–ª)
    label = label.replace(/\s*\+\s*–≤–µ—Ç—Ä–æ-?–≤–ª–∞–≥–æ–∏–∑–æ–ª—è—Ü–∏—è/gi, '').trim();
  }
  // –í–µ—Ç—Ä–æ-–≤–ª–∞–≥–æ–∏–∑–æ–ª—è—Ü–∏—è –í–°–ï–ì–î–ê –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–µ–Ω–∏–π –∫—Ä–æ–º–µ —Ö–æ–∑–±–ª–æ–∫–æ–≤
  pushPkg(`‚Äì –£—Ç–µ–ø–ª–µ–Ω–∏–µ: ${label} + –≤–µ—Ç—Ä–æ-–≤–ª–∞–≥–æ–∏–∑–æ–ª—è—Ü–∏—è`);
}
// 5) –ö—Ä–æ–≤–ª—è
  // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—Ä–æ–≤–ª–∏ —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
  let roofLabel = getLabel(selRoofMat.selectedOptions[0]);
  if (selRoofMat.value !== 'galv' && selectedProfColor) {
    const materialNames = {
      'profColor': '–¶–≤–µ—Ç–Ω–æ–π –ø—Ä–æ—Ñ–ª–∏—Å—Ç',
      'ondulin': '–û–Ω–¥—É–ª–∏–Ω',
      'tile_lom': '–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞ (–æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞)',
      'tile_gable': '–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞ (–¥–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞)'
    };
    const baseName = materialNames[selRoofMat.value] || roofLabel.split('(')[0].trim();
    roofLabel = `${baseName} ${selectedProfColor.name} (${selectedProfColor.code})`;
  }
  pushPkg(`‚Äì –ö—Ä–æ–≤–ª—è: ${roofLabel}`);
// 5) –û–∫–Ω–∞ (–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏ –¥–≤–µ—Ä–∏ –±–∞–∑–æ–≤—ã–µ
let hasUserWindow = false;                    // –Ω–æ–≤–æ–µ –∏–º—è
// -----------------------------------------------------------------

windowsContainer.querySelectorAll(".window-row").forEach(row => {
  const size = row.querySelector(".win-size").value;
  const kind = row.querySelector(".win-type").value;   // pvcWin | woodWin | ‚Ä¶
  if (size && (kind === "pvcWin" || kind === "woodWin")) hasUserWindow = true;
});
// 6) –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞ (–±–∞–∑–∞ –¥–ª—è –¥–æ–º–∞) + –≤–æ–∑–º–æ–∂–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
let basePartitionLen = 0;     // –±–∞–∑–æ–≤–∞—è –¥–ª–∏–Ω–∞ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≤ –º–µ—Ç—Ä–∞—Ö
let extraPartitionLen = 0;    // –¥–æ–ø. –¥–ª–∏–Ω–∞ –∏–∑ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if (type === "house") {
  const roof = document.querySelector('input[name=\"roof\"]:checked')?.value || 'gable';
  // –ü–æ –¢–ó:
  // - –ù–∏–∑–∫–∏–π —Å–∫–∞—Ç: –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞ –≤–¥–æ–ª—å –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã
  // - –î–≤—É—Å–∫–∞—Ç–Ω–∞—è –∫—Ä—ã—à–∞: –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞ –ø–æ –º–µ–Ω—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ
  basePartitionLen = (roof === 'lom') ? Math.max(w, l) : Math.min(w, l);
}

// 7) –î–æ–ø-—ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if (vw > 0 && vd > 0){
  pushPkg(`‚Äì –í–µ—Ä–∞–Ω–¥–∞: ${vw}√ó${vd} –º (${isInsideVer ? '–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è' : '–ø—Ä–∏—Å—Ç—Ä–æ–π–∫–∞'})`);
}
const chkMouseNewKP = document.getElementById('chkMouseNew');
if (!isEconomy && chkMouseNewKP && chkMouseNewKP.checked) {
  pushPkg("‚Äì –°–µ—Ç–∫–∞ ¬´–∞–Ω—Ç–∏-–º—ã—à—å¬ª");
}
// –ü–∞–Ω–¥—É—Å –¥–ª—è –æ–±—ã—á–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
if (!isEconomy && chkRamp && chkRamp.checked) {
  pushPkg("‚Äì –ü–∞–Ω–¥—É—Å");
}

// –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
if (!isEconomy) {
  const selPartitionTypeKP = document.getElementById('selPartitionType');
  const inpPartitionLengthKP = document.getElementById('inpPartitionLength');
  
  if (selPartitionTypeKP && inpPartitionLengthKP) {
    const partTypeKP = selPartitionTypeKP.value;
    const partLenKP = parseFloat(inpPartitionLengthKP.value) || 0;
    
    if (partTypeKP && partLenKP > 0) {
      // –í –ö–ü –Ω–µ –≤—ã–≤–æ–¥–∏–º –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π ‚Äî —Å—É–º–º–∏—Ä—É–µ–º —Å –±–∞–∑–æ–≤–æ–π
      extraPartitionLen += partLenKP;
      // –°—Ç–æ–∏–º–æ—Å—Ç—å —É–∂–µ —É—á—Ç–µ–Ω–∞ —Ä–∞–Ω–µ–µ —á–µ—Ä–µ–∑ addExtra, –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    }
  }
}

// –í—ã–≤–æ–¥–∏–º –µ–¥–∏–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞–º (–±–∞–∑–∞ + –¥–æ–ø—ã), –µ—Å–ª–∏ –µ—Å—Ç—å –±–∞–∑–∞ –∏–ª–∏ –¥–æ–ø—ã
if ((basePartitionLen || extraPartitionLen) && type === 'house') {
  const totalPartition = (basePartitionLen + extraPartitionLen);
  const totalStr = Number.isInteger(totalPartition) ? String(totalPartition) : totalPartition.toFixed(1).replace('.', ',');
  pushPkg(`‚Äì –°—Ç–µ–Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è: ${totalStr} –º`);
}

if (!isEconomy) {
  const selSvaiType = document.getElementById('selSvaiType');
  if (selSvaiType && selSvaiType.value) {
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∞–π –ø–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ (—Å —É—á–µ—Ç–æ–º –≤–µ—Ä–∞–Ω–¥—ã)
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º vw (—à–∏—Ä–∏–Ω–∞ –≤–µ—Ä–∞–Ω–¥—ã) –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ calculate()
    let verandaWidthForPiles = 0;
    if (type === 'house' && vw > 0 && !isInsideVer) {
      // –î–ª—è –∫–∞—Ä–∫–∞—Å–Ω–æ–≥–æ –¥–æ–º–∞: –≤–µ—Ä–∞–Ω–¥–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∏—Ä–∏–Ω—É —Å—Ç—Ä–æ–µ–Ω–∏—è
      verandaWidthForPiles = vw;
    } else if ((type === 'hoblok' || type === 'bytovka') && selectedVeranda) {
      // –î–ª—è —Ö–æ–∑–±–ª–æ–∫–æ–≤/–±—ã—Ç–æ–≤–æ–∫ —Å –≤–µ—Ä–∞–Ω–¥–æ–π –∏–∑ –ø—Ä–∞–π—Å–∞ - –≤–µ—Ä–∞–Ω–¥–∞ —É–∂–µ —É—á—Ç–µ–Ω–∞ –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö
      verandaWidthForPiles = 0;
    }
    const pileCnt = calculatePilesByRows(l, w, verandaWidthForPiles, isInsideVer);
    
    // –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–∞ –ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
    // –°–≤–æ–∏–º–∏ —Å–∏–ª–∞–º–∏ –º–æ–∂–µ–º: –¥–æ 12 —Å–≤–∞–π –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ò —Ç–æ–ª—å–∫–æ —Ç–∏–ø—ã 1.5√ó76 –∏–ª–∏ 2.0√ó76
    // –û—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞ –Ω—É–∂–Ω–∞: –µ—Å–ª–∏ > 12 —Å–≤–∞–π –ò–õ–ò —Ç–∏–ø –Ω–µ 1.5√ó76 –∏ –Ω–µ 2.0√ó76
    const isOwnTeamType = (selSvaiType.value === "1.5√ó76" || selSvaiType.value === "2.0√ó76");
    const isOwnTeamCount = (pileCnt <= 12);
    const needsSeparateTeamForKit = !isOwnTeamType || !isOwnTeamCount;
    
    // –ó–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫—É –Ω–∞ –∑–∞–ø—è—Ç—É—é –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö —Å–≤–∞–π –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (3.0 ‚Üí 3,0)
    const svaiDim = selSvaiType.value.replace(/\./g, ',');
    pushPkg(`‚Äì –°–≤–∞–π–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç: ${svaiDim} √ó ${pileCnt} —à—Ç`);
    
    if (needsSeparateTeamForKit) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ importantNotes, –∞ –Ω–µ –≤ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é
      importantNotes.push('–ú–æ–Ω—Ç–∞–∂ —Å–≤–∞–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π –±—Ä–∏–≥–∞–¥–æ–π');
      importantNotes.push('–î–æ—Å—Ç–∞–≤–∫–∞: 60 ‚ÇΩ/–∫–º –æ—Ç –ú—ã—Ç–∏—â, —Å—á–∏—Ç–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ');
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ PDF
    window.__kpNeedsSeparateTeamForKit = needsSeparateTeamForKit;
  } else {
    // –ï—Å–ª–∏ —Å–≤–∞–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞ –Ω–µ –Ω—É–∂–Ω–∞
    window.__kpNeedsSeparateTeamForKit = false;
  }
} else {
  // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç
  const selEconomySvaiType = document.getElementById('selEconomySvaiType');
  if (selEconomySvaiType && selEconomySvaiType.value) {
    const w = parseFloat(inpWidth.value) || 0;
    const l = parseFloat(inpLength.value) || 0;
    const sizeKey = `${w}x${l}`;
    const recommendation = CONFIG[type].svai.recommendations[sizeKey];
    if (recommendation) {
      // –ó–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫—É –Ω–∞ –∑–∞–ø—è—Ç—É—é –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö —Å–≤–∞–π –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (3.0 ‚Üí 3,0)
      const economySvaiDim = selEconomySvaiType.value.replace(/\./g, ',');
      pushPkg(`‚Äì –°–≤–∞–π–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç: ${economySvaiDim} √ó ${recommendation} —à—Ç`);
      
      // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ —Å–≤–∞–∏ –≤—Å–µ–≥–¥–∞ —Ç—Ä–µ–±—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –±—Ä–∏–≥–∞–¥—ã
      window.__kpNeedsSeparateTeamForKit = true;
    } else {
      window.__kpNeedsSeparateTeamForKit = false;
    }
  } else {
    window.__kpNeedsSeparateTeamForKit = false;
  }
}

// –ë–∞–∑–æ–≤—ã–µ –æ–∫–Ω–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∏–≥–¥–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–∫–Ω–∞ –ü–í–•
if (!pvcWindowsAdded) {
  pushPkg(`‚Äì –û–∫–Ω–æ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ ${baseWinSize} (${baseWinQty} —à—Ç)`);
} else {
  // –ï—Å–ª–∏ –±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –ü–í–• –æ–∫–Ω–∞ ‚Äî –≤—ã–≤–æ–¥–∏–º –∏—Ö —Ç—É—Ç, —Ä—è–¥–æ–º —Å –¥–≤–µ—Ä—è–º–∏
  // –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ–∫–Ω–∞
  const windowsMap = {};
  pvcWindowLines.forEach(line => {
    // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–∫–Ω–∞ –±–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "‚Äì –û–∫–Ω–æ –ü–í–• 60√ó90 1-–∫–∞–º.")
    const match = line.match(/^‚Äì\s*(.+?)\s*\((\d+)\s*—à—Ç\)/);
    if (match) {
      const windowName = match[1].trim();
      const qty = parseInt(match[2]) || 1;
      if (windowsMap[windowName]) {
        windowsMap[windowName] += qty;
      } else {
        windowsMap[windowName] = qty;
      }
    } else {
      // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
      pushPkg(line);
    }
  });
  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞
  Object.entries(windowsMap).forEach(([windowName, totalQty]) => {
    pushPkg(`‚Äì ${windowName} (${totalQty} —à—Ç)`);
  });
}
// –ü–µ—Ä–µ—Ñ–æ—Ä–º–∏—Ä—É–µ–º baseDoorLabel —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–∫–ª–æ–Ω–µ–Ω–∏–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
if (type === "house" && baseDoorLabel.includes("–°–∞–º–æ–Ω–∞–±–æ—Ä–Ω")) {
  baseDoorLabel = baseDoorQty > 1 ? "–°–∞–º–æ–Ω–∞–±–æ—Ä–Ω—ã–µ –¥–≤–µ—Ä–∏" : "–°–∞–º–æ–Ω–∞–±–æ—Ä–Ω–∞—è –¥–≤–µ—Ä—å";
}
pushPkg(`‚Äì ${baseDoorLabel} (${baseDoorQty} —à—Ç)`);

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ù–û–í–´–ô –ë–õ–û–ö: –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ–ª–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
pushPkg("‚Äì " + FLOOR_CAPT[floorCode]);
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */


// 8) –í—ã—Å–æ—Ç–∞ –ø–æ–º–µ—â–µ–Ω–∏—è / –ø–æ—Ç–æ–ª–∫–∞ (—É—á–∏—Ç—ã–≤–∞–µ–º extraH)
const extraHcm = +inpExtraH.value || 0;               // –ø—Ä–∏–±–∞–≤–∫–∞ –≤ —Å–º

let heightLine;
if (type === "house") {
  // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å –≤—ã—Å–æ—Ç–æ–π –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
  const base = roofType === "lom" ? "2,1‚Äì2,4 –º" : "2,4 –º";
  if (extraHcm > 0) {
    heightLine = `${base} (+${extraHcm} —Å–º –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É)`;
  } else {
    heightLine = base;
  }
} else { // –±—ã—Ç–æ–≤–∫–∞ / —Ö–æ–∑–±–ª–æ–∫
  const base = roofType === "gable" ? "2,4 –º" : "2,10 –º";
  if (extraHcm > 0) {
    heightLine = `${base} (+${extraHcm} —Å–º –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É)`;
  } else {
    heightLine = base;
  }
}
// –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É —á–µ—Ä–µ–∑ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é
const heightPrefix = type === "house" ? "–ø–æ–º–µ—â–µ–Ω–∏—è" : "–ø–æ—Ç–æ–ª–∫–∞";
const finalHeightLine = "‚Äì –í—ã—Å–æ—Ç–∞ " + heightPrefix + ": " + heightLine;
// –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
pushPkg(finalHeightLine);


// ‚Äî –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –ø—É–Ω–∫—Ç—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –º–∞—Å—Å–∏–≤ ‚Äî
const currentFormat = window.kpFormat || 'whatsapp';
const groupedPkg = groupKomplektatsiya(pkg, currentFormat);
groupedPkg.forEach(l => {
  // –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≥—Ä—É–ø–ø (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "‚Ä¢") –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
  if (l === '' || l.startsWith('‚Ä¢')) {
    lines.push(l);
  } else {
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è–µ–º —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "‚Äì " –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    let line = l.startsWith('‚Äì') ? l : '‚Äì ' + l;
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏)
    line = line.replace(/[\u00A0\u2000-\u200B\u202F\u205F\u3000]/g, ' ');
    line = line.replace(/[ \t]+/g, ' ');
    line = line.replace(/ {2,}/g, ' ');
    lines.push(line.trim());
  }
});
} // –∑–∞–∫—Ä—ã–≤–∞–µ–º else –¥–ª—è isEconomy

// ‚îÄ‚îÄ‚îÄ –ü–ª–æ—â–∞–¥–∏: —Ç—ë–ø–ª–∞—è / –≤–µ—Ä–∞–Ω–¥–∞ / –æ–±—â–∞—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function nice(n){ return n.toFixed(1).replace('.', ','); }

const warmSq  = nice(warmArea);
const verSq   = nice(verArea);
const totalSq = nice(warmArea + verArea); 

lines.push('', 'üìê *–ü–ª–æ—â–∞–¥—å:*');      // –æ–¥–∏–Ω –ø—É—Å—Ç–æ–π –æ—Ç—Å—Ç—É–ø –ü–ï–†–ï–î –±–ª–æ–∫–æ–º

if (verArea > 0.01){
  lines.push(
    `‚Äì –¢—ë–ø–ª–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ: ${warmSq} –º¬≤`,
    `‚Äì –ü—Ä–∏—Å—Ç—Ä–æ–π–∫–∞ / –≤–µ—Ä–∞–Ω–¥–∞: ${verSq} –º¬≤`
  );
}
lines.push(`‚Äì –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å: ${totalSq} –º¬≤`);
/* ‚îÄ‚îÄ‚îÄ –ë–ª–æ–∫ ¬´–°—Ç–æ–∏–º–æ—Å—Ç—å¬ª ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
// –í –∫–æ—Ä–æ—Ç–∫–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç–æ–∏–º–æ—Å—Ç–∏
if (!isShortKP) {
  lines.push(
    ``,
    `üí∞ *–°—Ç–æ–∏–º–æ—Å—Ç—å:*`
  );

  lines.push(`‚Äì –ë–∞–∑–æ–≤–∞—è: ${formatPrice(basePrice)} ‚ÇΩ  `);

  if (hasRoute) {
    if (isEconomy) {
      // –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
      const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
      const assembly = document.getElementById('chkAssembly')?.checked;
      
      let deliveryText = "";
      if (deliveryType === 'manipulator') {
        deliveryText = `–î–æ—Å—Ç–∞–≤–∫–∞ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–º: ${formatPrice(del)} ‚ÇΩ`;
      } else {
        deliveryText = `–î–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞–º–∏: ${formatPrice(del)} ‚ÇΩ`;
      }
      
      if (assembly && deliveryType !== 'kit') {
        // –î–ª—è –≥–∞–∑–µ–ª–∏ —Å–±–æ—Ä–∫–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É
        deliveryText += `\n‚Äì –°–±–æ—Ä–∫–∞ –Ω–∞ —É—á–∞—Å—Ç–∫–µ: ${formatPrice(Math.round(CONFIG[type].delivery.assembly * 1.1))} ‚ÇΩ`;
      }
      
      lines.push(`‚Äì ${deliveryText}  `);
    } else {
    lines.push(`‚Äì –î–æ—Å—Ç–∞–≤–∫–∞: ${formatPrice(del)} ‚ÇΩ  `);
    }
  } else {
    if (isEconomy) {
      // –î–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–Ω—É—é —Å—É–º–º—É
      lines.push(`‚Äì –î–æ—Å—Ç–∞–≤–∫–∞: ${formatPrice(del)} ‚ÇΩ  `);
    } else {
      // –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–æ—Ç"
    lines.push(`‚Äì –î–æ—Å—Ç–∞–≤–∫–∞: –æ—Ç ${formatPrice(del)} ‚ÇΩ  `);
    }
  }

    linesExtra = Object.entries(extraMap).map(([label, sum]) => {
    // —É–±–∏—Ä–∞–µ–º ¬´(1 —à—Ç)¬ª –∏–∑ –ª–µ–π–±–ª–∞ –∏ –≤—ã—á–∏—Å–ª—è–µ–º count
    const cnt = +(label.match(/\((\d+) —à—Ç\)/)?.[1] || 0); 
    const cleanLabel = label.replace(/\s*\(\d+ —à—Ç\)/, "");
    const pcs = cnt > 0 ? ` (${cnt} —à—Ç)` : "";              // –≤—ã–≤–æ–¥–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞–¥–æ
    return `‚ñ™ ${cleanLabel}${pcs}: ${formatPrice(sum)} ‚ÇΩ`;
  });

  if (extras > 0) {
    lines.push(`‚Äì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏: ${formatPrice(extras)} ‚ÇΩ  `);
    
    // –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ö–ü –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–Ω—ã, –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ ‚Äî –±–µ–∑ —Ü–µ–Ω
    if (!isShortKP) {
      // –í –ø–æ–ª–Ω–æ–º –ö–ü: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –¥–æ–ø —Å —Ü–µ–Ω–æ–π (–±–µ–∑ –ø—É—Ç–µ–π –∑–∞–º–µ–Ω—ã)
      const currentIntName = (typeof finalInt !== 'undefined' && finalInt) ? MATERIAL_NAME[finalInt] : null;
      const currentExtName = (typeof finalExt !== 'undefined' && finalExt) ? MATERIAL_NAME[finalExt] : null;
      
      Object.entries(extraMap).forEach(([label, sum]) => {
        let name = String(label).trim();
        // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—É—Ç—å –∑–∞–º–µ–Ω—ã ¬´A ‚Üí B¬ª, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–∞–≤—É—é —á–∞—Å—Ç—å (–∏—Ç–æ–≥–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª/–æ–ø—Ü–∏—è)
        if (name.includes('‚Üí')) {
          const parts = name.split('‚Üí').map(s => s.trim());
          name = parts[parts.length - 1] || name;
        }
        // –£–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –•–í–û–°–¢ —Ü–µ–Ω—ã –≤ –∫–æ–Ω—Ü–µ (–ø–æ—Å–ª–µ –¥–≤–æ–µ—Ç–æ—á–∏—è –∏–ª–∏ ¬´‚Äî¬ª), –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
        name = name.replace(/[:‚Äî]\s*\d[\d\s]*\s*‚ÇΩ\s*$/u, '').trim();
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–º–∞–Ω—Ç–∏–∫—É –¥–ª—è –æ—Ç–¥–µ–ª–æ–∫, —á—Ç–æ–±—ã —Ä–∞–∑–ª–∏—á–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é/–Ω–∞—Ä—É–∂–Ω—É—é
        if (currentIntName && name === currentIntName) {
          name = `–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ ‚Äî ${name}`;
        } else if (currentExtName && name === currentExtName) {
          name = `–ù–∞—Ä—É–∂–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ ‚Äî ${name}`;
        }
        // –í—ã–≤–æ–¥–∏–º —Å —Ü–µ–Ω–æ–π
        lines.push(`‚Äì ${name}: ${formatPrice(sum)} ‚ÇΩ`);
      });
    } else {
      // –í –∫–æ—Ä–æ—Ç–∫–æ–º –ö–ü: —Å–ø–∏—Å–æ–∫ –±–µ–∑ —Ü–µ–Ω
      const currentIntName = (typeof finalInt !== 'undefined' && finalInt) ? MATERIAL_NAME[finalInt] : null;
      const currentExtName = (typeof finalExt !== 'undefined' && finalExt) ? MATERIAL_NAME[finalExt] : null;
      const linesExtraNames = Object.keys(extraMap).map((label) => {
        let name = String(label).trim();
        if (name.includes('‚Üí')) {
          const parts = name.split('‚Üí').map(s => s.trim());
          name = parts[parts.length - 1] || name;
        }
        name = name.replace(/[:‚Äî]\s*\d[\d\s]*\s*‚ÇΩ\s*$/u, '').trim();
        if (currentIntName && name === currentIntName) {
          name = `–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ ‚Äî ${name}`;
        } else if (currentExtName && name === currentExtName) {
          name = `–ù–∞—Ä—É–∂–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ ‚Äî ${name}`;
        }
        return name;
      }).filter(Boolean);
      lines.push(...linesExtraNames.map(n => `‚Äì ${n}`));
    }
  }
}
lines.push(
  ``,
  `üëâ *–ò—Ç–æ–≥–æ: ${formatPrice(total)} ‚ÇΩ*`
);

// –ë–ª–æ–∫ "–í–∞–∂–Ω–æ:" —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ (—Å–≤–∞–∏, –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ —Ç.–¥.)
if (importantNotes.length > 0) {
  lines.push(
    ``,
    `‚ö†Ô∏è *–í–∞–∂–Ω–æ:*`
  );
  importantNotes.forEach(note => {
    lines.push(`‚Äì ${note}`);
  });
}

/* ‚îÄ‚îÄ‚îÄ ¬´–ü–æ–¥–∞—Ä–∫–∏¬ª, —Å—Ä–æ–∫–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const now = new Date();
const ex  = new Date(now);
ex.setDate(now.getDate() + 5);
const DD   = String(ex.getDate()).padStart(2, "0");
const MM   = String(ex.getMonth() + 1).padStart(2, "0");
const YYYY = ex.getFullYear();

// –ü–æ–¥–∞—Ä–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å—Ç—Ä–æ–µ–Ω–∏—è
if (isEconomy) {
  // –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏ –ø–æ –ø—Ä–∞–π—Å—É
  const gifts = [];
  
  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ (–∏–∑ –ø—Ä–∞–π—Å–∞)
  if (type === 'bytovka_economy') {
    gifts.push("–ü–æ–ª –û–°–ü-9");
  }
  gifts.push("–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∏–∂–Ω–∏—Ö –ª–∞–≥");
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω—ã –ª–∏ —Å–≤–∞–∏ - –µ—Å–ª–∏ –¥–∞, —Ç–æ —É–±–∏—Ä–∞–µ–º –±–ª–æ–∫–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞
  const svaiType = document.getElementById('selEconomySvaiType')?.value;
  if (!svaiType) {
    gifts.push("–ë–ª–æ–∫–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞");
  }
  
  gifts.push("–≠–ª–µ–∫—Ç—Ä–∏–∫–∞ (1 –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—å + 1 —Ä–æ–∑–µ—Ç–∫–∞)");
  
  // –°–±–æ—Ä–∫–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ –≥–∞–∑–µ–ª—å—é
  const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
  if (deliveryType === 'kit') {
    gifts.push("–°–±–æ—Ä–∫–∞ –Ω–∞ —É—á–∞—Å—Ç–∫–µ");
  }
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –ø–æ —à–∏—Ä–∏–Ω–µ (–∏–∑ –ø—Ä–∞–π—Å–∞)
  if (wReal >= 2.5) {
    gifts.push("–°—Ç—É–ø–µ–Ω–∏");
    gifts.push("–í–µ—Ç—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è –ø–æ –∫—Ä—É–≥—É");
  }
  
  if (wReal >= 3) {
    gifts.push("–£—Ç–µ–ø–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–ª–∫–∞");
    gifts.push("–ö–∞—Ä–∫–∞—Å 40√ó100");
  }
  
  if (wReal >= 4) {
    gifts.push("–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ä–∫–∞—Å–∞");
  }
  
  lines.push(
    ``,
    `üéÅ *–ü–æ–¥–∞—Ä–∫–∏:*`,
    ...gifts.map(gift => `‚Äì ${gift}  `),
    ``,
    `üïí *–°—Ä–æ–∫ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:* 1‚Äì2 –¥–Ω—è  `,
    `üí≥ *–ë–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã ‚Äî –æ–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É*`,
    ``,
    `‚è≥ *–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ ${DD}.${MM}.${YYYY}*`
  );
} else {
  // –û–±—ã—á–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–Ω–µ–π–∫–∏
  const gifts = [];
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω—ã –ª–∏ —Å–≤–∞–∏ - –µ—Å–ª–∏ –¥–∞, —Ç–æ —É–±–∏—Ä–∞–µ–º –±–ª–æ–∫–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞
  const selSvaiType = document.getElementById('selSvaiType');
  if (!selSvaiType || !selSvaiType.value) {
    gifts.push(`‚Äì –§—É–Ω–¥–∞–º–µ–Ω—Ç –∏–∑ –±–ª–æ–∫–æ–≤ 40√ó20√ó20  `);
  }
  
  gifts.push(
    `‚Äì –°–±–æ—Ä–∫–∞ –∑–∞ 1 –¥–µ–Ω—å  `,
    `‚Äì –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–æ–∑—å–µ–≤ –∞–Ω—Ç–∏—Å–µ–ø—Ç–∏–∫–æ–º - –∑–∞—â–∏—Ç–∞ –æ—Ç –≥–Ω–∏–µ–Ω–∏—è  `,
    `‚Äì –°—Ç—É–ø–µ–Ω—å–∫–∏ –Ω–∞ –≤—Ö–æ–¥  `
  );
  
lines.push(
  ``,
  `üéÅ *–ü–æ–¥–∞—Ä–∫–∏:*`,
  ...gifts,
  ``,
  `üïí *–°—Ä–æ–∫ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:* 1‚Äì2 –¥–Ω—è  `,
  `üí≥ *–ë–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã ‚Äî –æ–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É*`,
  ``,
  `‚è≥ *–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ ${DD}.${MM}.${YYYY}*`
);
}
// ---------- –ë–õ–û–ö ¬´–ü–æ—á–µ–º—É –º—ã¬ª (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ —Ç–∏–ø) ----------
// –í –∫–æ—Ä–æ—Ç–∫–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –±–ª–æ–∫ "–ü–æ—á–µ–º—É –º—ã"
if (!isShortKP) {
  // –ï–¥–∏–Ω—ã–π –±–ª–æ–∫ ¬´–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å¬ª –¥–ª—è –≤—Å–µ—Ö –ª–∏–Ω–µ–µ–∫
    lines.push(
      "",
    "‚úÖ *–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å*",
    "‚Ä¢ –û–ø—ã—Ç 10+ –ª–µ—Ç",
    "‚Ä¢ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –±—Ä–∏–≥–∞–¥—ã",
    "‚Ä¢ –•–≤–æ–π–Ω—ã–π –ª–µ—Å, –º–∞—Ç–µ—Ä–∏–∞–ª—ã 1 —Å–æ—Ä—Ç–∞",
    "‚Ä¢ –í–∞–≥–æ–Ω–∫–∞ –±–µ–∑ —Å–∏–Ω–µ–≤—ã –∏ –≥–Ω–∏–ª–∏",
    "‚Ä¢ –£—Ç–µ–ø–ª–µ–Ω–∏–µ —Å –ø–∞—Ä–æ- –∏ –≤–µ—Ç—Ä–æ–∑–∞—â–∏—Ç–æ–π",
    "‚Ä¢ –¶–µ–Ω–∞ –Ω–∏–∂–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞",
    "‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è 2 –≥–æ–¥–∞"
  );
}
// --------------------------------------------

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Å—Å–∏–≤—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ generatePDF
// pkg –∏ lines —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ pushPkg –∏ normalizeSpaces
window.__kpPkg = pkg.slice();
window.__kpLines = lines.slice();

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —Ä—É—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏
const outElForSave = document.getElementById('out');
if (outElForSave) {
  window.__kpOriginalText = outElForSave.textContent || outElForSave.innerText || '';
}

  // –ö–†–ò–¢–ò–ß–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ —Å–≤–∞–π –í –°–ê–ú–û–ú –ö–û–ù–¶–ï calculate(), –ø–æ—Å–ª–µ –í–°–ï–• —Ä–∞—Å—á–µ—Ç–æ–≤
  // –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã –¥—Ä—É–≥–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
  if (!isEconomy) {
    const selSvaiType = document.getElementById('selSvaiType');
    if (selSvaiType && selSvaiType.value) {
      const dim = selSvaiType.value;
      let verandaWidthForPiles = 0;
      if (type === 'house' && vw > 0 && !isInsideVer) {
        verandaWidthForPiles = vw;
      } else if ((type === 'hoblok' || type === 'bytovka') && selectedVeranda) {
        verandaWidthForPiles = 0;
      }
      const cnt = calculatePilesByRows(l, w, verandaWidthForPiles, isInsideVer);
      const pricePerPile = PILES_STANDARD[dim];
      if (pricePerPile) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
        updatePileSelectText(selSvaiType, dim, cnt, pricePerPile);
        // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
        updateAllPileOptions(selSvaiType, verandaWidthForPiles, isInsideVer, l, w);
      }
    }
  }
// –î–æ–ø—ã: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∏ —Å—É–º–º—É –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞ –≤ PDF-–±–ª–æ–∫–µ ¬´–°—Ç–æ–∏–º–æ—Å—Ç—å¬ª
window.__kpExtrasList = (typeof linesExtra !== 'undefined' && Array.isArray(linesExtra)) ? linesExtra.slice() : [];
window.__kpExtrasSum = (typeof extras !== 'undefined') ? extras : 0;
// –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–ª—è PDF
window.__kpBasePrice = (typeof basePrice !== 'undefined') ? basePrice : 0;
window.__kpDelivery = (typeof del !== 'undefined') ? del : 0;
window.__kpTotal = (typeof total !== 'undefined') ? total : 0;
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è PDF
let deliveryTextForPDF = '';
if (hasRoute) {
  if (isEconomy) {
    const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
    if (deliveryType === 'manipulator') {
      deliveryTextForPDF = `–î–æ—Å—Ç–∞–≤–∫–∞ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–º: ${formatPrice(del)} ‚ÇΩ`;
    } else {
      deliveryTextForPDF = `–î–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞–º–∏: ${formatPrice(del)} ‚ÇΩ`;
    }
  } else {
    deliveryTextForPDF = `–î–æ—Å—Ç–∞–≤–∫–∞: ${formatPrice(del)} ‚ÇΩ`;
  }
} else {
  if (isEconomy) {
    deliveryTextForPDF = `–î–æ—Å—Ç–∞–≤–∫–∞: ${formatPrice(del)} ‚ÇΩ`;
  } else {
    deliveryTextForPDF = `–î–æ—Å—Ç–∞–≤–∫–∞: –æ—Ç ${formatPrice(del)} ‚ÇΩ`;
  }
}
window.__kpDeliveryText = deliveryTextForPDF;
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ–ø–æ–≤ –¥–ª—è PDF (–≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–∞–∫ –≤ WhatsApp, –Ω–æ –±–µ–∑ "‚Äì" –≤ –Ω–∞—á–∞–ª–µ)
// –í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è PDF, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∂–∏–º–∞ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ/–ø–æ–ª–Ω–æ–≥–æ –ö–ü
const extrasListForPDF = [];
if (extras > 0) {
  const currentIntName = (typeof finalInt !== 'undefined' && finalInt) ? MATERIAL_NAME[finalInt] : null;
  const currentExtName = (typeof finalExt !== 'undefined' && finalExt) ? MATERIAL_NAME[finalExt] : null;
  
  Object.entries(extraMap).forEach(([label, sum]) => {
    let name = String(label).trim();
    // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—É—Ç—å –∑–∞–º–µ–Ω—ã ¬´A ‚Üí B¬ª, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–∞–≤—É—é —á–∞—Å—Ç—å
    if (name.includes('‚Üí')) {
      const parts = name.split('‚Üí').map(s => s.trim());
      name = parts[parts.length - 1] || name;
    }
    // –£–±–∏—Ä–∞–µ–º —Ö–≤–æ—Å—Ç —Ü–µ–Ω—ã –≤ –∫–æ–Ω—Ü–µ
    name = name.replace(/[:‚Äî]\s*\d[\d\s]*\s*‚ÇΩ\s*$/u, '').trim();
    // –£–Ω–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Ñ–æ—Ä–º–∞—Ç: –∑–∞–º–µ–Ω—è–µ–º ":" –Ω–∞ "‚Üí" –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
    name = name.replace(/^([^:]+):\s*/, '$1 ‚Üí ');
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–º–∞–Ω—Ç–∏–∫—É –¥–ª—è –æ—Ç–¥–µ–ª–æ–∫
    if (currentIntName && name === currentIntName) {
      name = `–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ ‚Üí ${name}`;
    } else if (currentExtName && name === currentExtName) {
      name = `–ù–∞—Ä—É–∂–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ ‚Üí ${name}`;
    }
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–ù–∞–∑–≤–∞–Ω–∏–µ ‚Äî —Ü–µ–Ω–∞ ‚ÇΩ" (–¥–ª–∏–Ω–Ω–æ–µ —Ç–∏—Ä–µ –º–µ–∂–¥—É –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ü–µ–Ω–æ–π)
    extrasListForPDF.push(`${name} ‚Äî ${formatPrice(sum)} ‚ÇΩ`);
  });
}
window.__kpExtrasListForPDF = extrasListForPDF;
// –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (—Å–≤–∞–∏, –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ —Ç.–¥.) –¥–ª—è –±–ª–æ–∫–∞ "–í–∞–∂–Ω–æ:" –≤ PDF
window.__kpImportantNotes = (typeof importantNotes !== 'undefined' && Array.isArray(importantNotes)) ? importantNotes.slice() : [];

// –£–±–∏—Ä–∞–µ–º –∑–≤—ë–∑–¥–æ—á–∫–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ –ê–≤–∏—Ç–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –Ω–µ –¥–ª—è PDF)
let displayLines = lines.slice();
const currentFormat = window.kpFormat || 'whatsapp';
if (currentFormat === 'avito') {
  // –£–±–∏—Ä–∞–µ–º –∑–≤—ë–∑–¥–æ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ WhatsApp
  displayLines = displayLines.map(line => {
    // –£–±–∏—Ä–∞–µ–º –∑–≤—ë–∑–¥–æ—á–∫–∏ –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—Å—Ç–∞: *—Ç–µ–∫—Å—Ç* -> —Ç–µ–∫—Å—Ç
    return line.replace(/\*([^*]+)\*/g, '$1');
  });
}

// –í—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç —Å –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Ç–æ–ª—å–∫–æ –¥–ª—è –ê–≤–∏—Ç–æ (–¥–æ 950 ‚Äî –∑–µ–ª—ë–Ω—ã–π, –ø–æ—Å–ª–µ ‚Äî –∫—Ä–∞—Å–Ω—ã–π)
const outText = displayLines.join("\n");
const outEl = document.getElementById('out');
if (outEl) {
  // –§—É–Ω–∫—Ü–∏—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ –ê–≤–∏—Ç–æ
  if (currentFormat === 'avito') {
    const limit = 950;
    const len = outText.length;
    
    if (len <= limit) {
      // –í—Å—ë –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω
      // –ó–∞–º–µ–Ω—è–µ–º \n –Ω–∞ <br> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
      const escaped = escapeHtml(outText).replace(/\n/g, '<br>');
      outEl.innerHTML = `<span class="avito-ok">${escaped}</span>`;
    } else {
      // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏: –¥–æ –ª–∏–º–∏—Ç–∞ –∏ –ø–æ—Å–ª–µ (–ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ)
      const okPart = outText.slice(0, limit);
      const overPart = outText.slice(limit);
      
      // –ó–∞–º–µ–Ω—è–µ–º \n –Ω–∞ <br> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
      const escapedOk = escapeHtml(okPart).replace(/\n/g, '<br>');
      const escapedOver = escapeHtml(overPart).replace(/\n/g, '<br>');
      
      outEl.innerHTML = `<span class="avito-ok">${escapedOk}</span><span class="avito-over">${escapedOver}</span>`;
    }
  } else {
    // –î–ª—è WhatsApp –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –±–µ–∑ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
    const escaped = escapeHtml(outText).replace(/\n/g, '<br>');
    outEl.innerHTML = escaped;
  }
}

}

/* ------------------------------------------------------------------
   8.1. –≠–∫—Å–ø–æ—Ä—Ç –ö–ü –≤ PDF (–ø–æ –¢–ó: –æ–±–ª–æ–∂–∫–∞, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è, —Å—Ç–æ–∏–º–æ—Å—Ç—å, –ø–æ–¥–∞—Ä–∫–∏)
------------------------------------------------------------------ */

/**
 * –§—É–Ω–∫—Ü–∏—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –±–ª–æ–∫–∞–º
 * @param {Array} groups - –ú–∞—Å—Å–∏–≤ –≥—Ä—É–ø–ø {title: string, items: Array<string>}
 * @param {number} maxHeight - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –ø–∏–∫—Å–µ–ª—è—Ö
 * @param {string} subtitleText - –¢–µ–∫—Å—Ç –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
 * @returns {Array<HTMLElement>} - –ú–∞—Å—Å–∏–≤ div-—Å—Ç—Ä–∞–Ω–∏—Ü
 */
function paginateContent(groups, maxHeight = 700, subtitleText = '') {
  const pages = [];
  let currentPage = null;
  let currentPageInner = null;
  let currentHeight = 0;
  
  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  function createNewPage() {
    currentPage = document.createElement('div');
    currentPage.className = 'kp-page kp-page--inner';
    currentPage.style.position = 'absolute';
    currentPage.style.left = '-9999px';
    currentPage.style.width = '210mm';
    currentPage.style.minHeight = '297mm';
    
    currentPageInner = document.createElement('div');
    currentPageInner.className = 'kp-page-inner pdf-container';
    currentPage.appendChild(currentPageInner);
    
    currentHeight = 0;
    pages.push(currentPage);
  }
  
  // –ò–∑–º–µ—Ä—è–µ–º –≤—ã—Å–æ—Ç—É —ç–ª–µ–º–µ–Ω—Ç–∞
  function measureHeight(element) {
    const clone = element.cloneNode(true);
    const container = document.createElement('div');
    container.style.cssText = 'position: absolute; left: -9999px; visibility: hidden; width: 210mm; font-family: "Inter", sans-serif;';
    container.appendChild(clone);
    document.body.appendChild(container);
    // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
    const height = clone.offsetHeight || 0;
    document.body.removeChild(container);
    return height;
  }
  
  // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (–∫–∞–∫ –≤ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å—Ç–∫–µ)
  function createGroup(title, items) {
    const groupDiv = document.createElement('div');
    groupDiv.className = 'kp-spec-group';
    
    const titleEl = document.createElement('h3');
    titleEl.className = 'kp-spec-group-title';
    titleEl.textContent = title;
    groupDiv.appendChild(titleEl);
    
    const ul = document.createElement('ul');
    ul.className = 'kp-spec-list';
    
    items.forEach(item => {
      const li = document.createElement('li');
      // –£–±–∏—Ä–∞–µ–º —Ç–∏—Ä–µ –∏–∑ –Ω–∞—á–∞–ª–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ list-style-type
      let text = item.replace(/^[‚Äì-]\s*/, '').trim();
      li.textContent = text;
      ul.appendChild(li);
    });
    
    groupDiv.appendChild(ul);
    return groupDiv;
  }
  
  // –û–±–µ—Ä–Ω—É—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é –≤ page-section
  function wrapInPageSection(content) {
    const section = document.createElement('div');
    section.className = 'page-section page-complectation';
    if (content) {
      if (typeof content === 'string') {
        section.innerHTML = content;
      } else {
        section.appendChild(content);
      }
    }
    return section;
  }
  
  // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø (kp-spec-groups) - —Ç–µ–ø–µ—Ä—å –≤–Ω—É—Ç—Ä–∏ .kp-spec-card
  let groupsContainer = null;
  let hasTitleOnPage = false; // –§–ª–∞–≥: –µ—Å—Ç—å –ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ "–ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø" –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  let komplektatsiyaCard = null; // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä .kp-spec-card –¥–ª—è –≤—Å–µ–≥–æ –±–ª–æ–∫–∞ (–∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–ª—É—á–µ–Ω–∏—è .kp-spec-card (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
  function getKomplektatsiyaCard() {
    if (!komplektatsiyaCard) {
      komplektatsiyaCard = document.createElement('div');
      komplektatsiyaCard.className = 'kp-spec-card';
      
      const h2 = document.createElement('h2');
      h2.className = 'kp-spec-title';
      h2.textContent = '–ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø';
      komplektatsiyaCard.appendChild(h2);
      
      if (subtitleText) {
        const p = document.createElement('p');
        p.className = 'kp-spec-subtitle';
        p.textContent = subtitleText;
        komplektatsiyaCard.appendChild(p);
      }
      
      // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø (–∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
      const groupsWrapper = document.createElement('div');
      groupsWrapper.className = 'kp-spec-groups';
      komplektatsiyaCard.appendChild(groupsWrapper);
      groupsContainer = groupsWrapper;
    }
    return komplektatsiyaCard;
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
  function addTitleToPage() {
    if (hasTitleOnPage) return; // –£–∂–µ –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
    // –°–æ–∑–¥–∞–µ–º .kp-spec-card —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
    komplektatsiyaCard = getKomplektatsiyaCard();
    hasTitleOnPage = true;
    
    // –ò–∑–º–µ—Ä—è–µ–º –≤—ã—Å–æ—Ç—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫ currentHeight
    const titleHeight = measureHeight(komplektatsiyaCard);
    currentHeight += titleHeight;
  }
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –≥—Ä—É–ø–ø—É
  for (let i = 0; i < groups.length; i++) {
    const group = groups[i];
    const groupDiv = createGroup(group.title, group.items);
    const groupHeight = measureHeight(groupDiv);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≥—Ä—É–ø–ø–æ–π "–ü—Ä–æ—á–µ–µ" —Å 1-2 –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏
    const isLastProchee = (i === groups.length - 1) && 
                          (group.title === '–ü—Ä–æ—á–µ–µ' || group.title.includes('–ü—Ä–æ—á–µ–µ')) &&
                          group.items.length <= 2 &&
                          group.items.every(item => item.length < 100); // –ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Ç—Ä–æ–∫–∏
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≥—Ä—É–ø–ø—ã
    if (!currentPage || !currentPageInner) {
      createNewPage();
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–º–µ—â–∞–µ—Ç—Å—è –ª–∏ –≥—Ä—É–ø–ø–∞ –Ω–∞ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    const wouldOverflow = currentPage !== null && currentHeight + groupHeight > maxHeight;
    
    // –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç, –Ω–æ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –∫–æ—Ä–æ—Ç–∫–∞—è "–ü—Ä–æ—á–µ–µ" - –ø—Ä–æ–±—É–µ–º –≤—Ç–∏—Å–Ω—É—Ç—å –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    if (wouldOverflow && !isLastProchee) {
      // –ï—Å–ª–∏ –±—ã–ª .kp-spec-card —Å –≥—Ä—É–ø–ø–∞–º–∏, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –Ω–∞ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–æ–±–µ—Ä–Ω—É—Ç—ã–π –≤ page-section, –∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
      if (komplektatsiyaCard && groupsContainer && groupsContainer.children.length > 0) {
        const section = wrapInPageSection(komplektatsiyaCard);
        currentPageInner.appendChild(section);
      }
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      createNewPage();
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      komplektatsiyaCard = null;
      groupsContainer = null;
      currentHeight = 0;
      hasTitleOnPage = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      addTitleToPage();
    } else if (wouldOverflow && isLastProchee) {
      // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –∫–æ—Ä–æ—Ç–∫–∞—è "–ü—Ä–æ—á–µ–µ" –∏ –æ–Ω–∞ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç - –ø—Ä–æ–±—É–µ–º —É–º–µ–Ω—å—à–∏—Ç—å maxHeight
      // –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–ø—É—Å—Ç—å –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ)
    }
    
    // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –≥—Ä—É–ø–ø–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —Å–æ–∑–¥–∞–µ–º .kp-spec-card —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
    if (!hasTitleOnPage) {
      addTitleToPage();
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø –∏–∑ .kp-spec-card
    if (!groupsContainer && komplektatsiyaCard) {
      groupsContainer = komplektatsiyaCard.querySelector('.kp-spec-groups');
    }
    
    // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ (–Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    if (!groupsContainer) {
      groupsContainer = document.createElement('div');
      groupsContainer.className = 'kp-spec-groups';
      if (komplektatsiyaCard) {
        komplektatsiyaCard.appendChild(groupsContainer);
      }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    groupsContainer.appendChild(groupDiv);
    currentHeight += groupHeight;
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º .kp-spec-card –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (–æ–±–µ—Ä–Ω—É—Ç—ã–π –≤ page-section, –∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
  if (komplektatsiyaCard && groupsContainer && groupsContainer.children.length > 0) {
    // –û–±–µ—Ä—Ç—ã–≤–∞–µ–º –≤ page-section –¥–ª—è –∑–∞–ø—Ä–µ—Ç–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ (–∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
    const section = wrapInPageSection(komplektatsiyaCard);
    currentPageInner.appendChild(section);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤–Ω–∏–∑—É –±–µ–ª–æ–π –∑–æ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
    // –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –±–µ–ª–∞—è –∑–æ–Ω–∞ –Ω–∏–∂–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ–Ω—å—à–µ–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    const companyInfoDiv = document.createElement('div');
    companyInfoDiv.className = 'company-info';
    companyInfoDiv.style.position = 'absolute'; // –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ currentPageInner
    // –ü–æ–¥–Ω–∏–º–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã —Ç–∞–∫ –∂–µ, –∫–∞–∫ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ª–∏—Å—Ç–µ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–µ–ª–æ–π —á–∞—Å—Ç–∏)
    // –ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ª–∏—Å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–Ω—è—Ç—ã –≤—ã—à–µ, –∑–¥–µ—Å—å —Ç–æ–∂–µ –ø–æ–¥–Ω–∏–º–∞–µ–º
    companyInfoDiv.style.bottom = '30px'; // –ü–æ–¥–Ω–∏–º–∞–µ–º –≤—ã—à–µ, –∫–∞–∫ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ª–∏—Å—Ç–µ
    companyInfoDiv.style.left = '40px'; // –û—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –∫–∞–∫ —É padding –∫–∞—Ä—Ç–æ—á–∫–∏
    companyInfoDiv.style.right = '40px'; // –û—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞ –∫–∞–∫ —É padding –∫–∞—Ä—Ç–æ—á–∫–∏
    companyInfoDiv.style.textAlign = 'center';
    companyInfoDiv.style.borderTop = '1px solid #e5e7eb'; // –õ–µ–≥–∫–∞—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
    companyInfoDiv.style.paddingTop = '20px'; // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –æ—Ç –ª–∏–Ω–∏–∏
    companyInfoDiv.style.paddingBottom = '0px'; // –ë–ï–ó –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É
    companyInfoDiv.style.marginBottom = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É
    companyInfoDiv.style.marginTop = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–≤–µ—Ä—Ö—É
    companyInfoDiv.style.backgroundColor = '#fff'; // –ë–µ–ª—ã–π —Ñ–æ–Ω
    companyInfoDiv.style.zIndex = '10'; // –ü–æ–≤–µ—Ä—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    companyInfoDiv.style.boxSizing = 'border-box'; // –ß—Ç–æ–±—ã padding —É—á–∏—Ç—ã–≤–∞–ª—Å—è
    
    const companyInfoText = document.createElement('div');
    companyInfoText.style.fontSize = '13px';
    companyInfoText.style.fontWeight = '400';
    companyInfoText.style.color = '#8A8A8A'; // –°–µ—Ä—ã–π —Ü–≤–µ—Ç –∫–∞–∫ —É —Å–ª–æ–≥–∞–Ω–æ–≤
    companyInfoText.style.letterSpacing = '0.02em';
    companyInfoText.style.lineHeight = '1';
    companyInfoText.style.whiteSpace = 'nowrap';
    companyInfoText.style.marginBottom = '0px';
    companyInfoText.style.paddingBottom = '0px';
    companyInfoText.style.marginTop = '0px';
    companyInfoText.style.paddingTop = '0px';
    companyInfoText.style.display = 'block';
    companyInfoText.innerHTML = '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è <span style="color: #8A8A8A; font-weight: 500;">+7 (495) 132-38-30</span> ¬∑ <span style="color: #8A8A8A; font-weight: 500;">resdoma.ru</span>';
    companyInfoDiv.appendChild(companyInfoText);
    
    // –î–µ–ª–∞–µ–º currentPageInner position: relative –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    currentPageInner.style.position = 'relative';
    currentPageInner.appendChild(companyInfoDiv);
  }
  
  // –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∞—è –≥—Ä—É–ø–ø–∞ "–ü—Ä–æ—á–µ–µ" (1-2 —Å—Ç—Ä–æ–∫–∏),
  // –∏ –µ—Å—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã - —É–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º "–ü—Ä–æ—á–µ–µ" –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é
  if (pages.length > 1) {
    const lastPage = pages[pages.length - 1];
    const lastPageInner = lastPage.querySelector('.kp-page-inner');
    if (lastPageInner) {
      const lastPageGroups = lastPageInner.querySelectorAll('.kp-spec-group');
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ "–ü—Ä–æ—á–µ–µ" —Å 1-2 –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏
      if (lastPageGroups.length === 1) {
        const lastGroup = lastPageGroups[0];
        const groupTitle = lastGroup.querySelector('.kp-spec-group-title')?.textContent || '';
        const groupItems = lastGroup.querySelectorAll('.kp-spec-list li');
        
        const isShortProchee = (groupTitle === '–ü—Ä–æ—á–µ–µ' || groupTitle.includes('–ü—Ä–æ—á–µ–µ')) &&
                               groupItems.length <= 2 &&
                               Array.from(groupItems).every(li => li.textContent.length < 100);
        
        if (isShortProchee) {
          // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–∑ –º–∞—Å—Å–∏–≤–∞
          pages.pop();
          // –£–¥–∞–ª—è–µ–º –∏–∑ DOM
          if (lastPage.parentNode) {
            lastPage.parentNode.removeChild(lastPage);
          }
          
          // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
          const prevPage = pages[pages.length - 1];
          const prevPageInner = prevPage.querySelector('.kp-page-inner');
          if (prevPageInner) {
            // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π page-section –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É —Ç—É–¥–∞
            const lastSection = prevPageInner.querySelector('.page-section:last-child');
            if (lastSection) {
              const groupsContainer = lastSection.querySelector('.kp-spec-groups');
              if (groupsContainer) {
                groupsContainer.appendChild(lastGroup.cloneNode(true));
              }
            }
          }
        }
      }
    }
  }
  
  return pages;
}

/**
 * –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è PDF —Å—Ç—Ä–∞–Ω–∏—Ü (—Å–∫—Ä—ã—Ç—ã–π)
 */
function createPDFContainer() {
  let container = document.getElementById('pdfContainer');
  if (!container) {
    container = document.createElement('div');
    container.id = 'pdfContainer';
    container.style.cssText = 'display: none; position: absolute; left: -9999px;';
    document.body.appendChild(container);
  } else {
    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    container.innerHTML = '';
  }
  return container;
}


async function generatePDF() {
  // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ –ª–∏ —É–∂–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞)
  if (window.__pdfGenerating) {
    console.warn('PDF —É–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤');
    return;
  }
  window.__pdfGenerating = true;
  
  // –í–ê–ñ–ù–û: –û—á–∏—â–∞–µ–º pdfContainer –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  const existingContainer = document.getElementById('pdfContainer');
  if (existingContainer) {
    existingContainer.innerHTML = '';
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ö–ü —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ
  const outElement = document.getElementById("out");
  if (!outElement || !outElement.textContent.trim()) {
    alert("‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –ö–ü!");
    console.warn('–ö–ü –Ω–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ, –≤—ã—Ö–æ–¥ –∏–∑ generatePDF');
    window.__pdfGenerating = false;
    return;
  }
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å—Ç—Ä–æ–µ–Ω–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–∫–æ–Ω–∫–∏
  const selType = document.getElementById("selType");
  const buildingType = selType ? selType.value : "house"; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ–º

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
  const btnPDF = document.getElementById("btnPDF");
  const originalText = btnPDF ? btnPDF.textContent : '';
  if (btnPDF) {
    btnPDF.disabled = true;
    btnPDF.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...';
  }

  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ #out –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω –≤—Ä—É—á–Ω—É—é
    // –ï—Å–ª–∏ –¥–∞, –ø–∞—Ä—Å–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ #out, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã
    let kpPkg = window.__kpPkg || [];
    let kpLines = window.__kpLines || [];
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ #out
    const currentOutText = (outElement.textContent || outElement.innerText || '').trim();
    const originalOutText = (window.__kpOriginalText || '').trim();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ #out –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ
    // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –∑–Ω–∞—á–∏—Ç –±—ã–ª–∏ —Ä—É—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏
    const isManuallyEdited = currentOutText !== originalOutText && currentOutText.length > 0;
    
    if (isManuallyEdited) {
      // –ü–∞—Ä—Å–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ #out - –∏—Å–ø–æ–ª—å–∑—É–µ–º HTML –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
      const outHtmlContent = outElement.innerHTML || '';
      
      // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = outHtmlContent;
      
      // –ü–æ–ª—É—á–∞–µ–º —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫)
      // –ó–∞–º–µ–Ω—è–µ–º <br> –Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
      const htmlWithBreaks = outHtmlContent.replace(/<br\s*\/?>/gi, '\n');
      tempDiv.innerHTML = htmlWithBreaks;
      const plainText = tempDiv.textContent || tempDiv.innerText || '';
      
      // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É
      const linesFromOut = plainText.split(/\n|\r\n?/).map(line => {
        // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        return line.trim();
      }).filter(line => line.length > 0); // –£–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
      
      // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é (—Å—Ç—Ä–æ–∫–∏ –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "‚Äì", "-" –∏–ª–∏ "‚Ä¢")
      const pkgFromOut = linesFromOut.filter(line => {
        const trimmed = line.trim();
        return trimmed.startsWith('‚Äì') || trimmed.startsWith('-') || trimmed.startsWith('‚Ä¢');
      }).map(line => {
        // –£–±–∏—Ä–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã —Å–ø–∏—Å–∫–∞ –∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        return line.replace(/^[‚Äì\-‚Ä¢]\s*/, '').trim();
      });
      
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      kpLines = linesFromOut;
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é –∏–∑ #out —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞, –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é
      if (pkgFromOut.length > 0) {
        kpPkg = pkgFromOut;
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML - —Ç–æ–ª—å–∫–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–±–µ–ª–æ–≤
    function escapeHtml(text) {
      if (!text) return "";
      let str = String(text);
      // –¢–æ–ª—å–∫–æ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML —Å–∏–º–≤–æ–ª—ã, –ø—Ä–æ–±–µ–ª—ã —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã
      str = str.replace(/&/g, '&amp;');
      str = str.replace(/</g, '&lt;');
      str = str.replace(/>/g, '&gt;');
      str = str.replace(/"/g, '&quot;');
      str = str.replace(/'/g, '&#39;');
      return str;
    }
    
    // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é normalizeSpaces
    function normalizeText(input) {
      if (!input) return "";
      let text = String(input);
      
      // 0. –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ - —É–±–∏—Ä–∞–µ–º –í–°–ï –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
      text = text.replace(/\u00A0/g, ' '); // –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã Unicode
      text = text.replace(/&nbsp;/g, ' '); // HTML –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
      text = text.replace(/[\u2000-\u200B\u202F\u205F\u3000]/g, ' '); // –¥—Ä—É–≥–∏–µ –≤–∏–¥—ã –ø—Ä–æ–±–µ–ª–æ–≤
      text = text.replace(/[ \t\r\n]+/g, ' '); // –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã, —Ç–∞–±—ã, –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ -> –æ–¥–∏–Ω –ø—Ä–æ–±–µ–ª
      text = text.replace(/ {2,}/g, ' '); // –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã -> –æ–¥–∏–Ω
      
      // 1. –£–ë–†–ê–¢–¨: –∑–≤—ë–∑–¥–æ—á–∫–∏ *, ‚Ä¢, —Å–º–∞–π–ª—ã
      text = text.replace(/\*/g, '');
      text = text.replace(/‚Ä¢/g, '');
      text = text.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gum, '');
      
      // 2. –£–ë–†–ê–¢–¨: –ø—Ä–æ–±–µ–ª—ã –ø–µ—Ä–µ–¥ –∑–Ω–∞–∫–∞–º–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è (–≤–∞–∂–Ω–æ: –°–ª–æ–≤–æ: –≤–º–µ—Å—Ç–æ –°–ª–æ–≤–æ :)
      // –ù–ï —Ç—Ä–æ–≥–∞–µ–º —Å–∫–æ–±–∫–∏ - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–±–µ–ª—ã –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π
      text = text.replace(/\s+:/g, ':'); // –ø—Ä–æ–±–µ–ª –ø–µ—Ä–µ–¥ –¥–≤–æ–µ—Ç–æ—á–∏–µ–º
      text = text.replace(/\s+,/g, ','); // –ø—Ä–æ–±–µ–ª –ø–µ—Ä–µ–¥ –∑–∞–ø—è—Ç–æ–π
      text = text.replace(/\s+\./g, '.'); // –ø—Ä–æ–±–µ–ª –ø–µ—Ä–µ–¥ —Ç–æ—á–∫–æ–π
      
      // 3. –ó–ê–ú–ï–ù–ò–¢–¨: –¥–µ—Ñ–∏—Å "-" –Ω–∞ –¥–ª–∏–Ω–Ω–æ–µ —Ç–∏—Ä–µ "‚Äî"
      text = text.replace(/(\s|^)-(\s|$)/g, '$1‚Äî$2');
      text = text.replace(/(\s|^)-/g, '$1‚Äî');
      text = text.replace(/-(\s|$)/g, '‚Äî$1');
      
      // 4. –ó–ê–ú–ï–ù–ò–¢–¨: "–º2" ‚Üí "–º¬≤"
      text = text.replace(/–º2/g, '–º¬≤');
      text = text.replace(/–º\s*2/g, '–º¬≤');
      
      // 5. –ü–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–±–µ–ª (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç), –Ω–æ –ù–ï –¥–ª—è –¥—Ä–æ–±–µ–π —Ç–∏–ø–∞ 2,1
      text = text.replace(/,([^\d\s])/g, ', $1');
      
      // 6. –ü–æ—Å–ª–µ –¥–≤–æ–µ—Ç–æ—á–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–±–µ–ª (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
      text = text.replace(/:(\S)/g, ': $1');
      
      // 7. –§–ò–ù–ê–õ–¨–ù–ê–Ø –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –≤–∏–¥–æ–≤ –ø—Ä–æ–±–µ–ª–æ–≤
      text = text.replace(/\u00A0/g, ' ');
      text = text.replace(/&nbsp;/g, ' ');
      text = text.replace(/[\u2000-\u200B\u202F\u205F\u3000]/g, ' ');
      text = text.replace(/[ \t\r\n]+/g, ' ');
      text = text.replace(/ {2,}/g, ' ');
      
      // 8. –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
      return text.trim();
    }
    
    // –ó–∞—â–∏—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ—Ç –Ω–µ–∫—Ä–∞—Å–∏–≤—ã—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ (–≤–∏—Å—è—á–∏–µ –ø—Ä–µ–¥–ª–æ–≥–∏, —Ç–∏—Ä–µ)
    function protectTitleLineBreaks(text) {
      if (!text) return text;
      // –ù–µ —Ä–≤—ë–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å —Ç–∏—Ä–µ, —Ç–∏–ø–∞ "6√ó4 ‚Äì –ü–û–î –ö–õ–Æ–ß"
      text = text.replace(/\s‚Äì\s/g, '\u00A0‚Äì\u00A0');
      // –ü—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–ª–æ–≤ (1‚Äì2 –±—É–∫–≤—ã) –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏
      text = text.replace(/\b([–ê-–Ø–Å–∞-—è—ë]{1,2})\s+/g, (match, word) => {
        return word + '\u00A0';
      });
      return text;
    }
    
    // –ß–∏—Å—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –ö–ü –æ—Ç –≤–æ—Ç—Å–∞–ø-—Ä–∞–∑–º–µ—Ç–∫–∏ –∏ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ (—Å—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º normalizeText)
    function cleanupKpLine(text) {
      return normalizeText(text);
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª –∏ –≤–∞–ª—é—Ç—ã
    function formatCurrency(amount) {
      // –ó–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫—É –Ω–∞ –ø—Ä–æ–±–µ–ª –≤ —á–∏—Å–ª–∞—Ö
      let formatted = amount.toString().replace(/\./g, ' ');
      // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª –ø–µ—Ä–µ–¥ ‚ÇΩ
      formatted = formatted.replace(/\s+/g, ' ').trim();
      return formatted;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å—Ç—Ä–æ–µ–Ω–∏—è –¥–ª—è —Å—É–º–º—ã –ø–æ–¥–∞—Ä–∫–æ–≤
    const selType = document.getElementById("selType");
    const buildingType = selType ? selType.value : '';
    const isHouse = buildingType === 'house';
    const giftsAmount = isHouse ? '50 000' : '15 000';
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏–∑ localStorage
    const managerName = localStorage.getItem('houseCalcUser') || '';
    
    // –ü–∞—Ä—Å–∏–º —Ç–µ–∫—Å—Ç –ö–ü –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–≤–∫–ª—é—á–∞—è "–ü–æ—á–µ–º—É –º—ã" –¥–ª—è –æ–±–ª–æ–∂–∫–∏)
    let mainTitle = '';
    let pochemuMy = [];
    let currentSection = '';
    let skipTitle = true;
    
    // –õ—ë–≥–∫–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:
    // 1) –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–≥–∏ –Ω–µ –≤–∏—Å—è—Ç –Ω–∞ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏
    // 2) —Ç–∏—Ä–µ –Ω–µ –ø–µ—Ä–µ–µ–∑–∂–∞–µ—Ç –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
    function fixRussianTypography(text) {
      if (!text) return text;
      // –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–≥–∏: –≤, –∫, —Å, —É, –æ, –∞, –∏
      text = text.replace(/\b([–í–≤–ö–∫–°—Å–£—É–û–æ–ê–∞–ò–∏])\s+/g, '$1\u00A0');
      // –Ω–µ –¥–∞—ë–º –±—Ä–∞—É–∑–µ—Ä—É —Ä–∞–∑—Ä—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥/–ø–æ—Å–ª–µ —Ç–∏—Ä–µ
      text = text.replace(/\s+‚Äì\s+/g, '\u00A0‚Äì\u00A0');
      return text;
    }
    
    for (let i = 0; i < kpLines.length; i++) {
      const line = kpLines[i];
      const trimmed = line.trim();
      
      // –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–æ–≤–∞—Ä–∞
      if (trimmed.includes('–ø–æ–¥ –∫–ª—é—á') && (trimmed.includes('√ó') || trimmed.includes('x'))) {
        let cleaned = normalizeText(trimmed).replace(/‚Äî/g, '‚Äì');
        cleaned = fixRussianTypography(cleaned);
        mainTitle = cleaned.toUpperCase();
        skipTitle = false;
        continue;
      }
      if (skipTitle) continue;
      
      if (!trimmed) continue;
      
      // –°–Ω–∞—á–∞–ª–∞ —á–∏—Å—Ç–∏–º —Å—Ç—Ä–æ–∫—É –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      let clean = normalizeText(trimmed);
      if (!clean) continue;
      
      const lower = clean.toLowerCase();
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–¥–µ–ª—ã
      if (lower.includes('–ø–æ—á–µ–º—É –º—ã') || lower.includes('–ø–æ—á–µ–º—É –º—ã ‚Äî') || lower.includes('–ø–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å')) {
        currentSection = 'pochemuMy';
        continue;
      }
      
      // –°–æ–±–∏—Ä–∞–µ–º "–ü–æ—á–µ–º—É –º—ã"
      if (currentSection === 'pochemuMy' && (clean.startsWith('‚Äì') || clean.startsWith('-') || clean.startsWith('‚Ä¢'))) {
        pochemuMy.push(clean.replace(/^[‚Äì\\-‚Ä¢]\\s*/, ''));
      }
    }
    
    if (!mainTitle) {
      mainTitle = '–ö–û–ú–ú–ï–†–ß–ï–°–ö–û–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï';
    }
    
    // ========== –°–¢–†–ê–ù–ò–¶–ê 1: –û–ë–õ–û–ñ–ö–ê (–¢–ï–ú–ù–ê–Ø –ì–†–ê–§–ò–¢–û–í–ê–Ø –®–ê–ü–ö–ê) ==========
    // –í–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const coverPage = document.createElement('div');
    coverPage.className = 'kp-page kp-page--cover';
    coverPage.style.position = 'absolute';
    coverPage.style.left = '-9999px';
    coverPage.style.width = '210mm';
    coverPage.style.height = '297mm';
    
    // –ë–µ–ª–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–Ω—É—Ç—Ä–∏ (–¥–ª—è –æ–±–ª–æ–∂–∫–∏ - –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è, —Ç–∞–∫ –∫–∞–∫ —Ñ–æ–Ω —Ç–µ–º–Ω—ã–π)
    const coverInner = document.createElement('div');
    coverInner.className = 'kp-page-inner';
    coverInner.style.backgroundColor = 'transparent';
    coverInner.style.borderRadius = '0';
    coverInner.style.padding = '0'; // Padding —É–∂–µ –Ω–∞ .kp-page--cover (60px)
    
    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –æ–±–ª–æ–∂–∫–∏
    const coverContainer = document.createElement('div');
    coverContainer.className = 'kp-cover';
    
    // –õ–æ–≥–æ—Ç–∏–ø –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ - –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é
    const logoSection = document.createElement('div');
    logoSection.className = 'kp-cover-header';
    
    // –õ–æ–≥–æ—Ç–∏–ø - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞ (—Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º)
    const logoBlock = document.createElement('div');
    logoBlock.className = 'kp-logo-block';
    
    const logoContainer = document.createElement('div');
    logoContainer.className = 'kp-logo-wrapper';
    
    // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø –∫–∞–∫ base64 –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
    let logoBase64 = null;
    try {
      // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ fetch
      const logoResponse = await fetch('logo.png');
      if (logoResponse.ok) {
        const blob = await logoResponse.blob();
        const reader = new FileReader();
        logoBase64 = await new Promise((resolve, reject) => {
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(blob);
        });
      }
    } catch (e) {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback SVG
    }
    
    const logoImg = document.createElement('img');
    logoImg.className = 'kp-logo-img';
    logoImg.alt = '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è';
    
    // –ü—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ logo-clean.svg, –ø–æ—Ç–æ–º logo.png
    let logoLoaded = false;
    try {
      const logoCleanResponse = await fetch('logo-clean.svg');
      if (logoCleanResponse.ok && logoCleanResponse.status === 200) {
        const logoCleanBlob = await logoCleanResponse.blob();
        const reader = new FileReader();
        logoImg.src = await new Promise((resolve, reject) => {
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(logoCleanBlob);
        });
        logoLoaded = true;
      } else {
        // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (404), –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º
        logoLoaded = false;
      }
    } catch (e) {
      // logo-clean.svg –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –ø—Ä–æ–±—É–µ–º logo.png
      logoLoaded = false;
    }
    if (!logoLoaded) {
      if (logoBase64) {
        logoImg.src = logoBase64;
        // –£–±–∏—Ä–∞–µ–º —Ñ–∏–ª—å—Ç—Ä - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –ª–æ–≥–æ—Ç–∏–ø–∞
        logoLoaded = true;
      } else {
        // Fallback SVG –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
        const logoSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      logoSvg.setAttribute('width', '22mm');
      logoSvg.setAttribute('height', '22mm');
      logoSvg.setAttribute('viewBox', '0 0 60 60');
      logoSvg.style.display = 'block';
      
      const roof = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
      roof.setAttribute('points', '30,5 50,25 10,25');
      roof.setAttribute('fill', 'none');
      roof.setAttribute('stroke', 'white');
      roof.setAttribute('stroke-width', '2.5');
      
      const walls = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      walls.setAttribute('x', '10');
      walls.setAttribute('y', '25');
      walls.setAttribute('width', '40');
      walls.setAttribute('height', '30');
      walls.setAttribute('fill', 'none');
      walls.setAttribute('stroke', 'white');
      walls.setAttribute('stroke-width', '2.5');
      
      const window = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      window.setAttribute('x', '22');
      window.setAttribute('y', '32');
      window.setAttribute('width', '16');
      window.setAttribute('height', '16');
      window.setAttribute('fill', 'none');
      window.setAttribute('stroke', 'white');
      window.setAttribute('stroke-width', '2');
      
      const base = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      base.setAttribute('x1', '5');
      base.setAttribute('y1', '55');
      base.setAttribute('x2', '55');
      base.setAttribute('y2', '55');
      base.setAttribute('stroke', '#4ade80');
      base.setAttribute('stroke-width', '3');
      
      const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      circle.setAttribute('cx', '48');
      circle.setAttribute('cy', '18');
      circle.setAttribute('r', '4');
      circle.setAttribute('fill', '#fbbf24');
      
      logoSvg.appendChild(roof);
      logoSvg.appendChild(walls);
      logoSvg.appendChild(window);
      logoSvg.appendChild(base);
      logoSvg.appendChild(circle);
        logoContainer.appendChild(logoSvg);
        logoImg.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º img, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º SVG
      }
    }
    
    if (logoLoaded) {
      logoContainer.appendChild(logoImg);
    }
    
    // –¢–µ–∫—Å—Ç –∫–æ–º–ø–∞–Ω–∏–∏
    const logoText = document.createElement('div');
    logoText.className = 'kp-logo-text';

    const companyName = document.createElement('div');
    companyName.className = 'kp-company';
    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
    const companyText = normalizeText('–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è');
    companyName.textContent = companyText;
    const companyTagline = document.createElement('div');
    companyTagline.className = 'kp-company-sub';
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º
    companyTagline.innerHTML = '–î–æ–º–∏–∫–∏ <span style="display: inline-block; vertical-align: middle; line-height: 1; margin: 0 0.2em;">¬∑</span> –±—ã—Ç–æ–≤–∫–∏ <span style="display: inline-block; vertical-align: middle; line-height: 1; margin: 0 0.2em;">¬∑</span> —Ö–æ–∑–±–ª–æ–∫–∏';
    logoText.appendChild(companyName);
    logoText.appendChild(companyTagline);
    
    logoBlock.appendChild(logoContainer);
    logoBlock.appendChild(logoText);
    logoSection.appendChild(logoBlock);
    
    // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –æ–±–ª–æ–∂–∫–∏
    const coverMain = document.createElement('main');
    coverMain.className = 'kp-cover-main';
    
    // –û—á–∏—â–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç –¥—É–±–ª–µ–π –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
    let cleanTitle = normalizeText(mainTitle)
      .replace(/–°\s+–õ–û–ú–ê–ù–û–ô\s+–ö–†–´–®–ï–ô/gi, '') // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏
      .replace(/\s+/g, ' ') // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
      .trim();
    
    // –ï—Å–ª–∏ –Ω–µ—Ç "–ø–æ–¥ –∫–ª—é—á", –¥–æ–±–∞–≤–ª—è–µ–º
    if (!cleanTitle.includes('–ü–û–î –ö–õ–Æ–ß') && !cleanTitle.includes('‚Äì')) {
      cleanTitle = cleanTitle + ' ‚Äì –ü–û–î –ö–õ–Æ–ß';
    }
    
    // –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤
    cleanTitle = cleanTitle.replace(/\s+/g, ' ').trim();
    // –ó–∞—â–∏—â–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç –∫—Ä–∏–≤—ã—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ (—Ç–∏—Ä–µ –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–ª–æ–≤–∞)
    cleanTitle = protectTitleLineBreaks(cleanTitle);
    const titleText = document.createElement('h1');
    titleText.className = 'kp-title';
    titleText.textContent = cleanTitle;
    
    // –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ - "–ö–û–ú–ú–ï–†–ß–ï–°–ö–û–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï" –≤–º–µ—Å—Ç–æ "–°—Ç—Ä–æ–∏–º –∫–∞–∫ –¥–ª—è —Å–µ–±—è ‚Äî –±–µ–∑ —ç–∫–æ–Ω–æ–º–∏–∏."
    const subtitleText = document.createElement('div');
    subtitleText.className = 'kp-subtitle';
    subtitleText.textContent = '–ö–û–ú–ú–ï–†–ß–ï–°–ö–û–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï';
    
    coverMain.appendChild(titleText);
    coverMain.appendChild(subtitleText);
    
    // –ë–ª–æ–∫ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –Ω–∞ –æ–±–ª–æ–∂–∫–µ - 4 –ø—É–Ω–∫—Ç–∞ –≤ 2 —Å—Ç—Ä–æ–∫–∏ –ø–æ 2 –ø—É–Ω–∫—Ç–∞
    const benefitsTexts = [
      '–°–±–æ—Ä–∫–∞ –∑–∞ 1 –¥–µ–Ω—å',
      '–ë–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ì–û–°–¢',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è 2 –≥–æ–¥–∞'
    ];
    
    const benefitsBlock = document.createElement('div');
    benefitsBlock.className = 'kp-benefits';
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –≤ 2 –∫–æ–ª–æ–Ω–∫–∏
    const benefitsContainer = document.createElement('div');
    benefitsContainer.className = 'kp-benefits-grid';
    
    // –°–æ–∑–¥–∞–µ–º –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏
    const column1 = document.createElement('div');
    column1.className = 'kp-benefits-column';
    const column2 = document.createElement('div');
    column2.className = 'kp-benefits-column';
    
    // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É–Ω–∫—Ç—ã –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º (–ø–µ—Ä–≤—ã–µ 2 –≤ –ø–µ—Ä–≤—É—é, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –≤–æ –≤—Ç–æ—Ä—É—é)
    benefitsTexts.forEach((txt, index) => {
      const item = document.createElement('div');
      item.className = 'kp-benefit-item';
      
      // –ñ–µ–ª—Ç–∞—è –≥–∞–ª–æ—á–∫–∞
      const checkmark = document.createElement('span');
      checkmark.className = 'kp-benefit-checkmark';
      checkmark.innerHTML = '‚úì';
      
      // –¢–µ–∫—Å—Ç
      const text = document.createElement('span');
      text.className = 'kp-benefit-text';
      text.textContent = txt;
      
      item.appendChild(checkmark);
      item.appendChild(text);
      
      // –ü–µ—Ä–≤—ã–µ 2 –ø—É–Ω–∫—Ç–∞ –≤ –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–Ω–∫—É, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –≤–æ –≤—Ç–æ—Ä—É—é
      if (index < 2) {
        column1.appendChild(item);
      } else {
        column2.appendChild(item);
      }
    });
    
    benefitsContainer.appendChild(column1);
    benefitsContainer.appendChild(column2);
    
    benefitsBlock.appendChild(benefitsContainer);
    coverMain.appendChild(benefitsBlock);
    
    // –ö–æ–Ω—Ç—É—Ä –¥–æ–º–∏–∫–∞ –Ω–∞ —Ç–∏—Ç—É–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    // –í—ã–±–∏—Ä–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∞—Å—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å—Ç—Ä–æ–µ–Ω–∏—è –∏ –∫—Ä—ã—à–∏
    const roofTypeCover = (document.querySelector('input[name="roof"]:checked')?.value) || '';
    let houseImage;
    let coverHouseModifierClass;

    if (buildingType === 'house') {
      if (roofTypeCover === 'lom') {
        // –¥–æ–º —Å –Ω–∏–∑–∫–∏–º —Å–∫–∞—Ç–æ–º (—ç—Ç–∞–ª–æ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
        houseImage = './nskat.png';
        coverHouseModifierClass = 'cover-house--nskat';
      } else {
        // –¥–æ–º —Å –¥–≤—É—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–µ–π
        houseImage = './house.png';
        coverHouseModifierClass = 'cover-house--house';
      }
    } else {
      // —Ö–æ–∑–±–ª–æ–∫ / –±—ã—Ç–æ–≤–∫–∞
      if (roofTypeCover === 'gable') {
        // –±—ã—Ç–æ–≤–∫–∞ / —Ö–æ–∑–±–ª–æ–∫ —Å –¥–≤—É—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–µ–π
        houseImage = './dbytovka.png';
        coverHouseModifierClass = 'cover-house--dbytovka';
      } else {
        // –±—ã—Ç–æ–≤–∫–∞ / —Ö–æ–∑–±–ª–æ–∫ —Å –æ–¥–Ω–æ—Å–∫–∞—Ç–Ω–æ–π –∫—Ä—ã—à–µ–π
      houseImage = './bytovka.png';
      coverHouseModifierClass = 'cover-house--bytovka';
      }
    }

    const coverHouse = document.createElement('div');
    coverHouse.className = `cover-house ${coverHouseModifierClass}`;
    coverHouse.style.backgroundImage = `url("${houseImage}")`;

    coverMain.appendChild(coverHouse);
    
    // –ü—Ä–æ—Å—Ç–æ–π –±–ª–æ–∫ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º, —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –∏ —Å–∞–π—Ç–æ–º –Ω–∞ —Ç–∏—Ç—É–ª—å–Ω–∏–∫–µ
    const coverFooter = document.createElement('footer');
    coverFooter.className = 'kp-cover-footer';
    
    const managerDiv = document.createElement('div');
    managerDiv.className = 'kp-manager';
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏–∑ localStorage (–µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ)
    const finalManagerName = managerName || localStorage.getItem('houseCalcUser') || '';
    let managerLabel = finalManagerName;
    if (managerLabel) {
      managerLabel = managerLabel.charAt(0).toUpperCase() + managerLabel.slice(1);
    }
    // –¢–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —Å–∞–π—Ç –Ω–∞ —Ç–∏—Ç—É–ª—å–Ω–∏–∫–µ
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º
    const separator = '<span style="display: inline-block; vertical-align: middle; line-height: 1; margin: 0 0.3em; color: #e5e7eb;">¬∑</span>';
    const siteHtml = '<span class="kp-manager-site">resdoma.ru</span>';
    const managerText = managerLabel 
      ? `–í–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä: ${managerLabel} ${separator} +7 (495) 132-38-30 ${separator} ${siteHtml}`
      : `+7 (495) 132-38-30 ${separator} ${siteHtml}`;
    
    // –Ø–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ü–ï–†–ï–î —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
    managerDiv.style.color = '#e5e7eb';
    managerDiv.style.display = 'block';
    managerDiv.style.visibility = 'visible';
    managerDiv.style.fontSize = '13px';
    managerDiv.style.textAlign = 'center';
    managerDiv.style.marginTop = '0';
    managerDiv.style.marginBottom = '0';
    
    managerDiv.innerHTML = managerText;
    
    coverFooter.appendChild(managerDiv);
    
    // –°–æ–±–∏—Ä–∞–µ–º –æ–±–ª–æ–∂–∫—É
    coverContainer.appendChild(logoSection);
    coverContainer.appendChild(coverMain);
    coverContainer.appendChild(coverFooter); // –§—É—Ç–µ—Ä –≤–Ω—É—Ç—Ä–∏ coverContainer, —á—Ç–æ–±—ã –±—ã–ª —á–∞—Å—Ç—å—é flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    coverInner.appendChild(coverContainer);
    coverPage.appendChild(coverInner);
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
    const kpRoot = document.createElement('div');
    kpRoot.id = 'kp-root';
    kpRoot.className = 'pdf-root';
    kpRoot.style.position = 'absolute';
    kpRoot.style.left = '-9999px';
    kpRoot.style.backgroundColor = '#E5E7EB';
    kpRoot.style.fontFamily = '"Inter", sans-serif';
    kpRoot.style.color = '#111827';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–ª–æ–∂–∫—É –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    kpRoot.appendChild(coverPage);
    
    // –°–æ–∑–¥–∞–µ–º PDF
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å jsPDF (–≤–µ—Ä—Å–∏—è 2.5.1 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UMD —Ñ–æ—Ä–º–∞—Ç)
    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
    let attempts = 0;
    let jsPDF;
    
    while (!jsPDF && attempts < 20) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–∞ –∫ jsPDF
      if (typeof window !== 'undefined') {
        // –í–∞—Ä–∏–∞–Ω—Ç 1: window.jspdf.jsPDF (UMD —Ñ–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–∏ 2.5.1)
        if (window.jspdf && window.jspdf.jsPDF && typeof window.jspdf.jsPDF === 'function') {
          jsPDF = window.jspdf.jsPDF;
          break;
        }
        // –í–∞—Ä–∏–∞–Ω—Ç 2: window.jsPDF (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø)
        if (window.jsPDF && typeof window.jsPDF === 'function') {
          jsPDF = window.jsPDF;
          break;
        }
        // –í–∞—Ä–∏–∞–Ω—Ç 3: window.jspdf (–µ—Å–ª–∏ —ç—Ç–æ —Å–∞–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä)
        if (typeof window.jspdf === 'function') {
          jsPDF = window.jspdf;
          break;
        }
        // –í–∞—Ä–∏–∞–Ω—Ç 4: –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ window.jspdf
        if (window.jspdf && typeof window.jspdf === 'object') {
          for (const key in window.jspdf) {
            if (key.toLowerCase().includes('pdf') && typeof window.jspdf[key] === 'function') {
              jsPDF = window.jspdf[key];
              break;
            }
          }
          if (jsPDF) break;
        }
      }
      
      // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∂–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
      if (!jsPDF && attempts < 19) {
        await new Promise(resolve => setTimeout(resolve, 200));
      }
      attempts++;
    }
    
    if (!jsPDF) {
      // –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ eval (–µ—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–æ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
      try {
        if (typeof eval('jspdf') !== 'undefined') {
          const evalJsPDF = eval('jspdf');
          if (evalJsPDF && evalJsPDF.jsPDF) {
            jsPDF = evalJsPDF.jsPDF;
          }
        }
      } catch(e) {
        // eval –Ω–µ –ø–æ–º–æ–≥
      }
      
      if (!jsPDF) {
        console.error('jsPDF –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ jspdf.umd.min.js –≤ index.html. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5)');
        throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ jsPDF –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ jspdf.umd.min.js –≤ index.html. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5)');
      }
    }
    
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º html2canvas
    if (typeof html2canvas === 'undefined') {
      console.error('html2canvas –Ω–µ –Ω–∞–π–¥–µ–Ω!');
      throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ html2canvas –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ html2canvas.min.js –≤ index.html. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5)');
    }
    
    const pdf = new jsPDF({
      orientation: 'portrait',
      unit: 'mm',
      format: 'a4'
    });
    
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    const contentContainer = document.createElement('div');
    contentContainer.className = 'kp-page kp-page-main';
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ pkg –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
    // kpPkg —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ pushPkg
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É (–¥–ª—è PDF —Ñ–æ—Ä–º–∞—Ç –Ω–µ –≤–∞–∂–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º whatsapp)
    const groupedPkg = groupKomplektatsiya(kpPkg, 'whatsapp');
    let komplektatsiya = groupedPkg.map(item => {
      // –£–±–∏—Ä–∞–µ–º —Ç–∏—Ä–µ –≤ –Ω–∞—á–∞–ª–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
      return item.replace(/^[‚Äì-]\s*/, '');
    });
    // –ü–∞—Ä—Å–∏–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ö–ü
    let ploshchad = [];
    let gabarity = '';
    let vysota = '';
    let fundament = '';
    let uteplenie = '';
    let krovlya = '';
    let oknaDveri = [];
    let stoimost = [];
    let podarki = [];
    let usloviya = [];
    // pochemuMy —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω –≤—ã—à–µ, –Ω–µ –ø–µ—Ä–µ–æ–±—ä—è–≤–ª—è–µ–º
    let totalPrice = '';
    // currentSection –∏ skipTitle —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω—ã –≤—ã—à–µ, –Ω–µ –ø–µ—Ä–µ–æ–±—ä—è–≤–ª—è–µ–º
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
    currentSection = '';
    skipTitle = true;
    
    for (let i = 0; i < kpLines.length; i++) {
      const line = kpLines[i];
      const trimmed = line.trim();
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–æ–≤–∞—Ä–∞
      if (trimmed.includes('–ø–æ–¥ –∫–ª—é—á') && (trimmed.includes('√ó') || trimmed.includes('x'))) {
        skipTitle = false;
        continue;
      }
      if (skipTitle) continue;
      
      if (!trimmed) {
        // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å –∫–æ–Ω–µ—Ü —Ä–∞–∑–¥–µ–ª–∞, –Ω–æ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º currentSection
        continue;
      }
      
      // –°–Ω–∞—á–∞–ª–∞ —á–∏—Å—Ç–∏–º —Å—Ç—Ä–æ–∫—É –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      let clean = normalizeText(trimmed);
      if (!clean) continue;
      
      const lower = clean.toLowerCase();
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–¥–µ–ª—ã (–ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤)
      if (lower.includes('–∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è') && !lower.includes('‚Äì')) {
        currentSection = 'komplektatsiya';
        continue;
      }
      if (lower.includes('–ø–ª–æ—â–∞–¥—å') && !lower.includes('‚Äì')) {
        currentSection = 'ploshchad';
        continue;
      }
      if (lower.includes('—Å—Ç–æ–∏–º–æ—Å—Ç—å') && !lower.includes('‚Äì')) {
        currentSection = 'stoimost';
        continue;
      }
      if (lower.includes('–ø–æ–¥–∞—Ä–∫–∏') && !lower.includes('‚Äì')) {
        currentSection = 'podarki';
        continue;
      }
      if (lower.includes('–ø–æ—á–µ–º—É –º—ã') || lower.includes('–ø–æ—á–µ–º—É –º—ã ‚Äî')) {
        currentSection = 'pochemuMy';
        continue;
      }
      if (lower.includes('—Å—Ä–æ–∫ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è') || 
          lower.includes('–±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã') ||
          lower.includes('—Ä–∞–±–æ—Ç–∞–µ–º —Å') ||
          (lower.includes('–≥–∞—Ä–∞–Ω—Ç–∏—è') && !lower.includes('‚Äì'))) {
        if (currentSection !== 'pochemuMy') {
          currentSection = 'usloviya';
        }
      }
      
      // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º (–∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è —É–∂–µ –≤–∑—è—Ç–∞ –∏–∑ kpPkg, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º)
      if (currentSection === 'komplektatsiya' && (clean.startsWith('‚Äì') || clean.startsWith('-'))) {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º - –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è —É–∂–µ –≤–∑—è—Ç–∞ –∏–∑ kpPkg, –Ω–µ –ø–∞—Ä—Å–∏–º –∏–∑ lines
      } else if (currentSection === 'ploshchad' && (clean.startsWith('‚Äì') || clean.startsWith('-'))) {
        ploshchad.push(clean.replace(/^[‚Äì-]\s*/, ''));
        // –ò–∑–≤–ª–µ–∫–∞–µ–º –≥–∞–±–∞—Ä–∏—Ç—ã –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        const sizeMatch = mainTitle.match(/(\d+[√óx]\d+)/);
        if (sizeMatch) {
          gabarity = sizeMatch[1];
        }
      } else if (currentSection === 'stoimost') {
        if (lower.includes('–∏—Ç–æ–≥–æ')) {
          totalPrice = clean.replace(/üëâ/g, '').trim();
        } else if (clean.startsWith('‚Äì') || clean.startsWith('-')) {
          stoimost.push(clean.replace(/^[‚Äì-]\s*/, ''));
        }
      } else if (currentSection === 'podarki' && (clean.startsWith('‚Äì') || clean.startsWith('-'))) {
        podarki.push(clean.replace(/^[‚Äì-]\s*/, ''));
      } else if (currentSection === 'usloviya') {
        if (!lower.includes('–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ')) {
          usloviya.push(clean);
        }
      } else if (currentSection === 'pochemuMy' && (clean.startsWith('‚Äì') || clean.startsWith('-'))) {
        pochemuMy.push(clean.replace(/^[‚Äì-]\s*/, ''));
      }
      
      // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ (–¥–ª—è –∫—Ä–∞—Ç–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫)
      if (currentSection === 'komplektatsiya' || !currentSection) {
        if (clean.includes('–í—ã—Å–æ—Ç–∞') || clean.includes('–≤—ã—Å–æ—Ç–∞')) {
          vysota = clean.replace(/^[‚Äì-]\s*/, '');
        }
        if (clean.includes('—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç') || clean.includes('–§—É–Ω–¥–∞–º–µ–Ω—Ç') || clean.includes('–°–≤–∞–π–Ω—ã–π') || clean.includes('—Å–≤–∞–π–Ω—ã–π')) {
          fundament = clean.replace(/^[‚Äì-]\s*/, '');
        }
        if (clean.includes('–£—Ç–µ–ø–ª–µ–Ω–∏–µ') || clean.includes('—É—Ç–µ–ø–ª–µ–Ω–∏–µ') || clean.includes('–ú–∏–Ω. –≤–∞—Ç–∞') || clean.includes('–º–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ç–∞') || clean.includes('–º–∏–Ω–≤–∞—Ç–∞')) {
          uteplenie = clean.replace(/^[‚Äì-]\s*/, '');
        }
        if (clean.includes('–ö—Ä–æ–≤–ª—è') || clean.includes('–∫—Ä–æ–≤–ª—è') || clean.includes('–ü—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª') || clean.includes('–ø—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª') || clean.includes('–¶–≤–µ—Ç–Ω–æ–π –ø—Ä–æ—Ñ–ª–∏—Å—Ç')) {
          krovlya = clean.replace(/^[‚Äì-]\s*/, '');
        }
        if (clean.includes('–û–∫–Ω–æ') || clean.includes('–î–≤–µ—Ä—å') || clean.includes('–æ–∫–Ω–æ') || clean.includes('–¥–≤–µ—Ä—å')) {
          oknaDveri.push(clean.replace(/^[‚Äì-]\s*/, ''));
        }
      }
    }
    
    // –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç "–ü–û–ß–ï–ú–£ –ú–´" –¥–ª—è PDF - —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 8 –ø—É–Ω–∫—Ç–æ–≤
    if (pochemuMy.length > 0) {
      // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏
      pochemuMy = Array.from(new Set(pochemuMy));
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 8 –ø—É–Ω–∫—Ç–æ–≤
      const MAX_BENEFITS = 8;
      pochemuMy = pochemuMy.slice(0, MAX_BENEFITS);
    }
    
    // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è-–∑–∞–≥–ª—É—à–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    function fixPrepositions(text) {
      return text; // –¢–µ–∫—Å—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è —Ä–æ–≤–Ω–æ –∫–∞–∫ –≤ –¥–∞–Ω–Ω—ã—Ö
    }
    // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó
    let contentHtml = '';
    
    // –§—É–Ω–∫—Ü–∏—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑ –∂–∏—Ä–Ω—ã–º
    function emphasize(text) {
      if (!text) return '';
      let t = String(text);
      t = t.replace(/\b1\s*—Å–æ—Ä—Ç\b/gi, '<strong>1 —Å–æ—Ä—Ç</strong>');
      t = t.replace(/\b–û–°–ë\s*–≤–ª–∞–≥–æ—Å—Ç–æ–π–∫–∞—è\b/gi, '<strong>–û–°–ë –≤–ª–∞–≥–æ—Å—Ç–æ–π–∫–∞—è</strong>');
      t = t.replace(/\b–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è\s+–≤–∞—Ç–∞\s*100\s*–º–º\b/gi, '<strong>–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ç–∞ 100 –º–º</strong>');
      t = t.replace(/\b–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è\s+–≤–∞—Ç–∞\s*50\s*–º–º\b/gi, '<strong>–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ç–∞ 50 –º–º</strong>');
      t = t.replace(/–≤–µ—Ç—Ä–æ-?–≤–ª–∞–≥–æ–∏–∑–æ–ª—è—Ü–∏—è/gi, '<strong>–≤–µ—Ç—Ä–æ-–≤–ª–∞–≥–æ–∏–∑–æ–ª—è—Ü–∏—è</strong>');
      // 80√ó80 ‚Äî 3 —à—Ç.
      t = t.replace(/(\d+\s*[√óx]\s*\d+\s*‚Äî\s*\d+\s*—à—Ç\.?)/gi, '<strong>$1</strong>');
      // –î–∏–∞–ø–∞–∑–æ–Ω –≤—ã—Å–æ—Ç 2,1‚Äì2,4 –º
      t = t.replace(/(\d+[\.,]\d+\s*[‚Äì-]\s*\d+[\.,]\d+\s*–º)/gi, '<strong>$1</strong>');
      return t;
    }
    
    // 1. –ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø (—Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –≥—Ä—É–ø–ø—ã) - –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    // –ü–∞—Ä—Å–∏–º –≥—Ä—É–ø–ø—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ paginateContent
    let komplektatsiyaGroups = [];
    if (komplektatsiya.length > 0) {
      // –ü–∞—Ä—Å–∏–º —É–∂–µ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∑–∞–≥–æ–ª–æ–≤–∫–∏ –≥—Ä—É–ø–ø –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å "‚Ä¢")
      let currentGroup = null;
      let currentItems = [];
      
      komplektatsiya.forEach(item => {
        const trimmed = item.trim();
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä—É–ø–ø—ã (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "‚Ä¢" –∏ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–≤–µ–∑–¥–æ—á–∫–∏ –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ)
        if (trimmed.startsWith('‚Ä¢')) {
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –≥—Ä—É–ø–ø—É (—É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º)
          if (currentGroup) {
            // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø—ã
            const uniqueItems = [];
            const seenItems = new Set();
            currentItems.forEach(item => {
              // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (—É–±–∏—Ä–∞–µ–º —Ç–∏—Ä–µ, –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã)
              const normalized = item.replace(/^[‚Äì-]\s*/, '').trim().toLowerCase();
              if (!seenItems.has(normalized)) {
                seenItems.add(normalized);
                uniqueItems.push(item);
              }
            });
            komplektatsiyaGroups.push({ title: currentGroup, items: uniqueItems });
          }
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã (—É–±–∏—Ä–∞–µ–º "‚Ä¢" –∏ –∑–≤–µ–∑–¥–æ—á–∫–∏)
          currentGroup = trimmed.replace(/^‚Ä¢\s*\*?/, '').replace(/\*$/, '').trim();
          currentItems = [];
        } else if (trimmed) {
          // –≠–ª–µ–º–µ–Ω—Ç –≥—Ä—É–ø–ø—ã
          currentItems.push(trimmed);
        }
      });
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≥—Ä—É–ø–ø—É (—É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º)
      if (currentGroup) {
        // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø—ã
        const uniqueItems = [];
        const seenItems = new Set();
        currentItems.forEach(item => {
          // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (—É–±–∏—Ä–∞–µ–º —Ç–∏—Ä–µ, –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã)
          const normalized = item.replace(/^[‚Äì-]\s*/, '').trim().toLowerCase();
          if (!seenItems.has(normalized)) {
            seenItems.add(normalized);
            uniqueItems.push(item);
          }
        });
        komplektatsiyaGroups.push({ title: currentGroup, items: uniqueItems });
      }
      
      // –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∏: —Ä–∞–∑–º–µ—Ä + —Ä–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ —Ç–∏–ø–∞
      let summarySize = '';
      const m = mainTitle.match(/(\d+)[√óx](\d+)/);
      if (m) {
        summarySize = `${m[1]}√ó${m[2]} –º`;
      }
      let productNameGenitive = '';
      if (buildingType === 'house') productNameGenitive = '–ö–∞—Ä–∫–∞—Å–Ω–æ–≥–æ –¥–æ–º–∞';
      else if (buildingType === 'bytovka') productNameGenitive = '–ë—ã—Ç–æ–≤–∫–∏';
      else if (buildingType === 'hoblok') productNameGenitive = '–•–æ–∑–±–ª–æ–∫–∞';
      // –ü–æ –¢–ó: –≤—Å–µ–≥–¥–∞ –ø–∏—à–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
      const subtitleText = '–°—Ç—Ä–æ–∏–º –∫–∞–∫ –¥–ª—è —Å–µ–±—è ‚Äî –±–µ–∑ —ç–∫–æ–Ω–æ–º–∏–∏.';

      // –ù–û–í–´–ô –ü–û–î–•–û–î: –ò—Å–ø–æ–ª—å–∑—É–µ–º paginateContent –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
      // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è PDF (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω)
      let pdfContainer = document.getElementById('pdfContainer');
      if (!pdfContainer) {
        pdfContainer = createPDFContainer();
      }
      
      // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ paginateContent
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø" –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ paginateContent –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      const komplektatsiyaPages = paginateContent(komplektatsiyaGroups, 700, subtitleText);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      komplektatsiyaPages.forEach(page => {
        pdfContainer.appendChild(page);
      });
      
    }
    
      // 4. –°–¢–û–ò–ú–û–°–¢–¨ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ –∏ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è)
      const basePrice = window.__kpBasePrice || 0;
      const delivery = window.__kpDelivery || 0;
      const extrasSum = window.__kpExtrasSum || 0;
      const total = window.__kpTotal || 0;
      const deliveryText = window.__kpDeliveryText || '';
      const extrasListForPDF = window.__kpExtrasListForPDF || [];
          
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è PDF (–∏—Å–ø–æ–ª—å–∑—É–µ–º formatPrice, –∑–∞—Ç–µ–º –∑–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã)
      function formatPriceForPDF(price) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é formatPrice, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ—á–∫–∏ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Ç—ã—Å—è—á
        let formatted = formatPrice(price);
        // –ó–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã
        formatted = formatted.replace(/\./g, ' ');
        return formatted;
          }
          
      if (basePrice > 0 || total > 0) {
        contentHtml += '<div class="kp-spec-card">';
        contentHtml += '<h2 class="kp-spec-title">–°–¢–û–ò–ú–û–°–¢–¨</h2>';
      
        // –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –±–ª–æ–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–∫–∞–∫ kp-spec-groups –≤ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏)
        contentHtml += '<div class="kp-spec-groups">';
        
        // –ë–ª–æ–∫ –∫—Ä–∞—Ç–∫–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–∫–∞–∫ –≥—Ä—É–ø–ø–∞ –≤ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏)
        contentHtml += '<div class="kp-spec-group">';
        let basePriceFormatted = formatPriceForPDF(basePrice);
        let deliveryFormatted = '';
        if (deliveryText) {
          // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
          const deliveryMatch = deliveryText.match(/(\d[\d\s.]*)/);
          if (deliveryMatch) {
            const deliveryNum = parseInt(deliveryMatch[1].replace(/[^\d]/g, ''), 10);
            const formattedDeliveryNum = formatPriceForPDF(deliveryNum);
            // –ó–∞–º–µ–Ω—è–µ–º —á–∏—Å–ª–æ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–∞ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ
            deliveryFormatted = deliveryText.replace(/(\d[\d\s.]*)/, formattedDeliveryNum);
          } else {
            deliveryFormatted = deliveryText;
          }
          // –ó–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º ‚ÇΩ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª)
          deliveryFormatted = deliveryFormatted.replace(/(\d+)\.(\d+)/g, '$1 $2');
          deliveryFormatted = deliveryFormatted.replace(/\s+‚ÇΩ/g, '\u00A0‚ÇΩ');
          deliveryFormatted = deliveryFormatted.replace(/(\d+)\s+(\d+)\s*‚ÇΩ/g, '$1\u00A0$2\u00A0‚ÇΩ');
        }
        let extrasFormatted = formatPriceForPDF(extrasSum);
        let totalFormatted = formatPriceForPDF(total);

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–∫ –≤ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
        contentHtml += '<ul class="kp-spec-list">';
        contentHtml += `<li>–ë–∞–∑–æ–≤–∞—è: ${basePriceFormatted}\u00A0‚ÇΩ</li>`;
        if (deliveryText) {
          contentHtml += `<li>${escapeHtml(deliveryFormatted)}</li>`;
    }
        if (extrasSum > 0) {
          contentHtml += `<li>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏: ${extrasFormatted}\u00A0‚ÇΩ</li>`;
        }
        contentHtml += '</ul>';
        // –ò–¢–û–ì–û - –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º
        contentHtml += `<div style="margin-top: 12px; font-size: 15px; font-weight: 700; line-height: 1.35; color: #222426;">–ò–¢–û–ì–û: ${totalFormatted}\u00A0‚ÇΩ</div>`;
        contentHtml += `<div style="margin-top: 4px; font-size: 11px; font-weight: 400; line-height: 1.35; color: #6b7280; font-style: italic;">—Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –æ–ø—Ü–∏–π</div>`;
        contentHtml += '</div>'; // –∑–∞–∫—Ä—ã–≤–∞–µ–º kp-spec-group
        
        // –ë–ª–æ–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –¥–æ–ø–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å) - –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞
        if (extrasListForPDF.length > 0) {
          contentHtml += '<div class="kp-spec-group">';
          contentHtml += '<div class="kp-spec-group-title" style="margin-top: 14px; font-weight: 600;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</div>';
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Ü–µ–Ω –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é
          contentHtml += '<div style="margin-top: 4px;">';
          extrasListForPDF.forEach(extraLine => {
            let txt = extraLine;
            // –ó–∞–º–µ–Ω—è–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ —Ç–∏—Ä–µ "-" –Ω–∞ –¥–ª–∏–Ω–Ω–æ–µ "‚Äî" –ø–µ—Ä–µ–¥ —Ü–µ–Ω–æ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
            txt = txt.replace(/\s+-\s+(\d)/g, ' ‚Äî $1');
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤–∞–ª—é—Ç—É –≤ –¥–æ–ø–∞—Ö (–∑–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª –ø–µ—Ä–µ–¥ ‚ÇΩ)
            // formatPrice —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏, –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã
            txt = txt.replace(/\./g, ' ');
            txt = txt.replace(/\s+‚ÇΩ/g, '\u00A0‚ÇΩ');
            txt = txt.replace(/(\d+)\s+(\d+)\s*‚ÇΩ/g, '$1\u00A0$2\u00A0‚ÇΩ');
            
            // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
            const parts = txt.split(' ‚Äî ');
            if (parts.length === 2) {
              const name = parts[0].replace(/^[‚Äì-]\s*/, '').trim();
              const price = parts[1];
              // –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å: min-width –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å–ª–µ–≤–∞, –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Å—É–º–º–æ–π
              contentHtml += `<div style="display: flex; justify-content: space-between; align-items: baseline; font-size: 13px; line-height: 1.35; margin-bottom: 2px; color: #222426;">`;
              contentHtml += `<span style="flex: 1; min-width: 0; padding-right: 16px;">‚Äì ${escapeHtml(name)}</span>`;
              contentHtml += `<span style="flex-shrink: 0; text-align: right; white-space: nowrap; font-weight: 500;">${escapeHtml(price)}</span>`;
              contentHtml += `</div>`;
            } else {
              // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É, –≤—ã–≤–æ–¥–∏–º –∫–∞–∫ –µ—Å—Ç—å
              contentHtml += `<div style="font-size: 13px; line-height: 1.35; margin-bottom: 2px; color: #222426;">‚Äì ${escapeHtml(txt)}</div>`;
            }
          });
          contentHtml += '</div>';
          contentHtml += '</div>'; // –∑–∞–∫—Ä—ã–≤–∞–µ–º kp-spec-group
        }
        
        contentHtml += '</div>'; // –∑–∞–∫—Ä—ã–≤–∞–µ–º kp-spec-groups
        contentHtml += '</div>'; // –∑–∞–∫—Ä—ã–≤–∞–µ–º kp-spec-card
      }
    
      // 5. –ü–û–î–ê–†–ö–ò (–æ—Ä–∞–Ω–∂–µ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞, –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –∫–∞–∫ –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –Ω–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏)
      if (podarki.length > 0) {
        const giftsSum = isHouse ? '50 000' : '15 000';
        // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –æ—Ç –±–ª–æ–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–∫–∞–∫ –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –Ω–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ - 16px)
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å—ã kp-gifts –∏ gifts-box –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
        contentHtml += '<div class="kp-gifts gifts-box" style="margin-top: 16px;">';
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏ (padding —É–∂–µ –µ—Å—Ç—å –≤ CSS, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º margin-top)
        contentHtml += `<div style="font-size: 18px; font-weight: 700; line-height: 1.4; margin: 0 0 8px 0; color: white; text-transform: uppercase; letter-spacing: normal !important; word-spacing: normal !important;">–ü–û–î–ê–†–ö–ò –ù–ê –°–£–ú–ú–£ ${giftsSum}\u00A0‚ÇΩ</div>`;
        // –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ—Ä–∞–∑–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç—Å—Ç—É–ø–æ–º
        contentHtml += `<div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin: 0 0 16px 0; color: white; opacity: 0.95;">–≠—Ç–∏ –±–æ–Ω—É—Å—ã –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</div>`;
        
        // –°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
        podarki.forEach((item, index) => {
          const normalized = normalizeText(item);
          const fixedItem = fixPrepositions(normalized);
          // –ü–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –±–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å –æ—Ç—Å—Ç—É–ø–æ–º
          const marginBottom = index === podarki.length - 1 ? '0' : '4px';
          contentHtml += `<div style="font-size: 16px; margin: 0 0 ${marginBottom} 0; line-height: 1.55; color: white; letter-spacing: normal !important; word-spacing: normal !important; text-align: left;">‚Äì ${escapeHtml(fixedItem)}</div>`;
        });
        
        contentHtml += '</div>';
      }
    
    // –ë–ª–æ–∫ "–£–°–õ–û–í–ò–Ø + –ü–û–ß–ï–ú–£ –ú–´" –≤—ã–Ω–µ—Å–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (—Å–º. –Ω–∏–∂–µ –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
    
    // –†–∞–∑–±–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
    const tempDiv = document.createElement('div');
    tempDiv.style.position = 'absolute';
    tempDiv.style.left = '-9999px';
    tempDiv.style.width = '210mm';
    tempDiv.style.padding = '25mm 20mm';
    tempDiv.style.boxSizing = 'border-box';
    tempDiv.style.fontFamily = '"Inter", sans-serif';
    tempDiv.innerHTML = contentHtml;
    document.body.appendChild(tempDiv);
    
    await new Promise(resolve => setTimeout(resolve, 100));
    
    // –ù–∞—Ö–æ–¥–∏–º –±–ª–æ–∫–∏ –ø–æ –∫–ª–∞—Å—Å–∞–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
    // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è - –∏—â–µ–º div —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "–ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø"
    let komplektatsiyaDiv = null;
    const allDivs = tempDiv.querySelectorAll('div');
    for (let div of allDivs) {
      if (div.textContent && div.textContent.includes('–ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø')) {
        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π div, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å –±–ª–æ–∫ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
        komplektatsiyaDiv = div.parentElement;
        // –ï—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å –±–ª–æ–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º div
        if (!komplektatsiyaDiv || komplektatsiyaDiv === tempDiv) {
          komplektatsiyaDiv = div;
          // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π div, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å –±–ª–æ–∫
          let parent = div.parentElement;
          while (parent && parent !== tempDiv) {
            if (parent.querySelector('.kp-spec-card h2.kp-spec-title') || parent.querySelector('.kp-gifts')) {
              break;
            }
            komplektatsiyaDiv = parent;
            parent = parent.parentElement;
          }
        }
        break;
      }
    }
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π div —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –¥–æ –±–ª–æ–∫–æ–≤ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    if (!komplektatsiyaDiv) {
      const firstDiv = tempDiv.querySelector('div');
      if (firstDiv && !firstDiv.querySelector('.kp-spec-card h2.kp-spec-title') && !firstDiv.querySelector('.kp-gifts')) {
        komplektatsiyaDiv = firstDiv;
      }
    }
    
    // –ò—â–µ–º –±–ª–æ–∫ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (—Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç kp-spec-card —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –°–¢–û–ò–ú–û–°–¢–¨)
    const stoimostDiv = Array.from(tempDiv.querySelectorAll('.kp-spec-card')).find(card => 
      card.querySelector('h2.kp-spec-title') && card.querySelector('h2.kp-spec-title').textContent.includes('–°–¢–û–ò–ú–û–°–¢–¨')
    );
    const podarkiDiv = tempDiv.querySelector('.kp-gifts');
    
    // –í—ã—á–∏—Å–ª—è–µ–º –≤—ã—Å–æ—Ç—ã –±–ª–æ–∫–æ–≤
    const stoimostHeight = stoimostDiv ? stoimostDiv.offsetHeight : 0;
    const podarkiHeight = podarkiDiv ? podarkiDiv.offsetHeight : 0;
    
    // –ù–û–í–´–ô –ü–û–î–•–û–î: –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ —á–µ—Ä–µ–∑ paginateContent –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ pdfContainer
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏–∑ pdfContainer –≤ kpRoot
    const pdfContainer = document.getElementById('pdfContainer');
    if (pdfContainer) {
      const komplektatsiyaPages = pdfContainer.querySelectorAll('.kp-page');
      komplektatsiyaPages.forEach(page => {
        kpRoot.appendChild(page.cloneNode(true));
      });
    }
    
    // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ paginateContent –≤—ã—à–µ
    
    // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –ü–æ–¥–∞—Ä–∫–∏ –Ω–∞ –û–î–ù–£ —Å—Ç—Ä–∞–Ω–∏—Ü—É (–∫–∞–∂–¥–∞—è –≤ page-section)
    if (stoimostDiv || podarkiDiv) {
      // –°–æ–∑–¥–∞–µ–º –û–î–ù–£ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–∞—Ä–∫–æ–≤
      const costGiftsPage = document.createElement('div');
      costGiftsPage.className = 'kp-page kp-page--inner';
      costGiftsPage.style.position = 'absolute';
      costGiftsPage.style.left = '-9999px';
      costGiftsPage.style.width = '210mm';
      costGiftsPage.style.minHeight = '297mm';
      
      const costGiftsPageInner = document.createElement('div');
      costGiftsPageInner.className = 'kp-page-inner pdf-container';
      costGiftsPage.appendChild(costGiftsPageInner);
      
      // –ë–ª–æ–∫ –°—Ç–æ–∏–º–æ—Å—Ç—å - –æ–±–µ—Ä—Ç—ã–≤–∞–µ–º –≤ page-section
    if (stoimostDiv && stoimostHeight > 0) {
        const stoimostSection = document.createElement('div');
        stoimostSection.className = 'page-section page-price';
        stoimostSection.appendChild(stoimostDiv.cloneNode(true));
        costGiftsPageInner.appendChild(stoimostSection);
      }
      
      // –ë–ª–æ–∫ –ü–æ–¥–∞—Ä–∫–∏ - –æ–±–µ—Ä—Ç—ã–≤–∞–µ–º –≤ page-section (–∏–¥–µ—Ç –ø–æ—Å–ª–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
    if (podarkiDiv && podarkiHeight > 0) {
        const podarkiSection = document.createElement('div');
        podarkiSection.className = 'page-section page-gifts';
        podarkiSection.appendChild(podarkiDiv.cloneNode(true));
        costGiftsPageInner.appendChild(podarkiSection);
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤–Ω–∏–∑—É –±–µ–ª–æ–π –∑–æ–Ω—ã (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é/–ø–æ–¥–∞—Ä–∫–∞–º–∏ –±–µ–ª–∞—è –∑–æ–Ω–∞ –Ω–∏–∂–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ–Ω—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
      // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω—é—é –±–µ–ª—É—é –∫–∞—Ä—Ç–æ—á–∫—É (—Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–ª–∏ –ø–æ–¥–∞—Ä–∫–∏)
      const lastCard = stoimostDiv || podarkiDiv;
      if (lastCard) {
        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å —Ç–∞–∫–∏–º –∂–µ —Å—Ç–∏–ª–µ–º, –∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ö–ê–ö –ú–´ –†–ê–ë–û–¢–ê–ï–ú?"
        const companyInfoDiv = document.createElement('div');
        companyInfoDiv.className = 'company-info';
        companyInfoDiv.style.position = 'absolute'; // –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ costGiftsPageInner
        // –ü–æ–¥–Ω–∏–º–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã —Ç–∞–∫ –∂–µ, –∫–∞–∫ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ª–∏—Å—Ç–µ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–µ–ª–æ–π —á–∞—Å—Ç–∏)
        // –ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ª–∏—Å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–Ω—è—Ç—ã –≤—ã—à–µ, –∑–¥–µ—Å—å —Ç–æ–∂–µ –ø–æ–¥–Ω–∏–º–∞–µ–º
        companyInfoDiv.style.bottom = '30px'; // –ü–æ–¥–Ω–∏–º–∞–µ–º –≤—ã—à–µ, –∫–∞–∫ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ª–∏—Å—Ç–µ
        companyInfoDiv.style.left = '40px'; // –û—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –∫–∞–∫ —É padding –∫–∞—Ä—Ç–æ—á–∫–∏
        companyInfoDiv.style.right = '40px'; // –û—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞ –∫–∞–∫ —É padding –∫–∞—Ä—Ç–æ—á–∫–∏
        companyInfoDiv.style.textAlign = 'center';
        companyInfoDiv.style.borderTop = '1px solid #e5e7eb'; // –õ–µ–≥–∫–∞—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
        companyInfoDiv.style.paddingTop = '20px'; // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –æ—Ç –ª–∏–Ω–∏–∏
        companyInfoDiv.style.paddingBottom = '0px'; // –ë–ï–ó –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É
        companyInfoDiv.style.marginBottom = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É
        companyInfoDiv.style.marginTop = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–≤–µ—Ä—Ö—É
        companyInfoDiv.style.backgroundColor = '#fff'; // –ë–µ–ª—ã–π —Ñ–æ–Ω
        companyInfoDiv.style.zIndex = '10'; // –ü–æ–≤–µ—Ä—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        companyInfoDiv.style.boxSizing = 'border-box'; // –ß—Ç–æ–±—ã padding —É—á–∏—Ç—ã–≤–∞–ª—Å—è
        
        const companyInfoText = document.createElement('div');
        companyInfoText.style.fontSize = '13px';
        companyInfoText.style.fontWeight = '400';
        companyInfoText.style.color = '#8A8A8A'; // –°–µ—Ä—ã–π —Ü–≤–µ—Ç –∫–∞–∫ —É —Å–ª–æ–≥–∞–Ω–æ–≤
        companyInfoText.style.letterSpacing = '0.02em';
        companyInfoText.style.lineHeight = '1';
        companyInfoText.style.whiteSpace = 'nowrap';
        companyInfoText.style.marginBottom = '0px';
        companyInfoText.style.paddingBottom = '0px';
        companyInfoText.style.marginTop = '0px';
        companyInfoText.style.paddingTop = '0px';
        companyInfoText.style.display = 'block';
        companyInfoText.innerHTML = '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è <span style="color: #8A8A8A; font-weight: 500;">+7 (495) 132-38-30</span> ¬∑ <span style="color: #8A8A8A; font-weight: 500;">resdoma.ru</span>';
        companyInfoDiv.appendChild(companyInfoText);
        
        // –î–µ–ª–∞–µ–º costGiftsPageInner position: relative –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        costGiftsPageInner.style.position = 'relative';
        costGiftsPageInner.appendChild(companyInfoDiv);
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –±–ª–æ–∫
      if (costGiftsPageInner.children.length > 0) {
        kpRoot.appendChild(costGiftsPage);
      }
      }
      
    // –£–î–ê–õ–ï–ù–û: fallback –∫–æ–¥ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –±–ª–æ–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
    // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è - —á–µ—Ä–µ–∑ paginateContent
    // –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –ü–æ–¥–∞—Ä–∫–∏ - —á–µ—Ä–µ–∑ costGiftsPage
    // –£—Å–ª–æ–≤–∏—è - —á–µ—Ä–µ–∑ conditionsPage
    
    // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    document.body.removeChild(tempDiv);
    
    // ========== –û–¢–î–ï–õ–¨–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê: –ö–ê–ö –ú–´ –†–ê–ë–û–¢–ê–ï–ú? (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫) ==========
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–∞ –ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞ –¥–ª—è –º–æ–Ω—Ç–∞–∂–∞ —Å–≤–∞–π
    const needsSeparateTeamForKit = window.__kpNeedsSeparateTeamForKit || false;
    const montageDays = needsSeparateTeamForKit ? 2 : 1;
    const montageDaysText = montageDays === 1 ? '1 –¥–µ–Ω—å' : '2 –¥–Ω—è';
    
    // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ö–ê–ö –ú–´ –†–ê–ë–û–¢–ê–ï–ú?" - –≤–µ—Ä—Å—Ç–∫–∞ –∫–∞–∫ –Ω–∞ –¥—Ä—É–≥–∏—Ö –ª–∏—Å—Ç–∞—Ö
    const howWeWorkPage = document.createElement('div');
    howWeWorkPage.className = 'kp-page kp-page--inner';
    howWeWorkPage.style.position = 'absolute';
    howWeWorkPage.style.left = '-9999px';
    howWeWorkPage.style.width = '210mm';
    howWeWorkPage.style.minHeight = '297mm';
    // –î–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–≤–∞–ª–∞ –Ω—É–∂–µ–Ω position: relative
    // –ù–æ position —É–∂–µ absolute –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º relative –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    // –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, absolute —É–∂–µ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Ç–∞–∫ —á—Ç–æ –ø–æ–¥–≤–∞–ª –±—É–¥–µ—Ç –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ .kp-page
    
    const howWeWorkPageInner = document.createElement('div');
    howWeWorkPageInner.className = 'kp-page-inner pdf-container';
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–∞–∫ –Ω–∞ –¥—Ä—É–≥–∏—Ö –ª–∏—Å—Ç–∞—Ö (–±–µ–ª—ã–π —Ñ–æ–Ω, —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ, —Ç–µ–Ω—å)
    // –ù–ï –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª–∏ - –ø—É—Å—Ç—å –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è CSS –ø—Ä–∞–≤–∏–ª–∞ .kp-page--inner .kp-page-inner
    howWeWorkPageInner.style.setProperty('display', 'flex', 'important');
    howWeWorkPageInner.style.setProperty('flex-direction', 'column', 'important');
    // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –±–µ–ª—É—é –∫–∞—Ä—Ç–æ—á–∫—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –æ–Ω–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–ª–∞—Å—å —á—É—Ç—å –≤—ã—à–µ –Ω–∞–¥–ø–∏—Å–∏
    // –ù–∞–¥–ø–∏—Å—å –Ω–∞ bottom: 5px –æ—Ç –∫—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –≤—ã—Å–æ—Ç–∞ –Ω–∞–¥–ø–∏—Å–∏ ~60px (font-size 50px * line-height 1.2)
    // –í–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π –Ω–∞–¥–ø–∏—Å–∏: 5px + 60px = 65px –æ—Ç –Ω–∏–∑–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // –ë–µ–ª–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ 10px –≤—ã—à–µ –Ω–∞–¥–ø–∏—Å–∏ = 65px + 10px = 75px –æ—Ç –Ω–∏–∑–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // .kp-page-inner –∏–º–µ–µ—Ç padding 48px –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ—ç—Ç–æ–º—É:
    // min-height = –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (297mm) - 75px (–¥–æ –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è –∫–∞—Ä—Ç–æ—á–∫–∏) - 48px (–≤–µ—Ä—Ö–Ω–∏–π padding) = calc(297mm - 123px)
    // –ò–ª–∏ –ø—Ä–æ—â–µ: padding-bottom = 75px, —á—Ç–æ–±—ã –Ω–∏–∂–Ω–∏–π –∫—Ä–∞–π –∫–∞—Ä—Ç–æ—á–∫–∏ –±—ã–ª –Ω–∞ 75px –æ—Ç –Ω–∏–∑–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    howWeWorkPageInner.style.setProperty('min-height', 'calc(297mm - 123px)', 'important'); // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ—á—Ç–∏ –¥–æ –Ω–∞–¥–ø–∏—Å–∏
    howWeWorkPageInner.style.setProperty('max-height', 'none', 'important');
    howWeWorkPageInner.style.setProperty('padding-bottom', '75px', 'important'); // –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É, —á—Ç–æ–±—ã –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–ª–∞—Å—å –Ω–∞ 10px –≤—ã—à–µ –Ω–∞–¥–ø–∏—Å–∏
    // –î–µ–ª–∞–µ–º .kp-page-inner flex –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, —á—Ç–æ–±—ã –±–µ–ª–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –º–æ–≥–ª–∞ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å—Å—è
    howWeWorkPageInner.style.setProperty('display', 'flex', 'important');
    howWeWorkPageInner.style.setProperty('flex-direction', 'column', 'important');
    howWeWorkPage.appendChild(howWeWorkPageInner);
    
    // –°–æ–∑–¥–∞–µ–º .kp-spec-card (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –≤ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
    const howWeWorkCard = document.createElement('div');
    howWeWorkCard.className = 'kp-spec-card';
    howWeWorkCard.style.setProperty('border-radius', '24px', 'important'); // –Ø–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ —Å !important
    howWeWorkCard.style.setProperty('background', '#fff', 'important'); // –Ø–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–µ–ª—ã–π —Ñ–æ–Ω
    howWeWorkCard.style.setProperty('position', 'relative', 'important'); // –î–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    howWeWorkCard.style.setProperty('overflow', 'visible', 'important'); // –£–±–∏—Ä–∞–µ–º overflow, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    howWeWorkCard.style.setProperty('display', 'flex', 'important'); // Flex –¥–ª—è –ø—Ä–∏–∂–∞—Ç–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∫ –Ω–∏–∑—É
    howWeWorkCard.style.setProperty('flex-direction', 'column', 'important'); // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    howWeWorkCard.style.setProperty('flex', '1', 'important'); // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤—ã—Å–æ—Ç—É
    howWeWorkCard.style.setProperty('min-height', '100%', 'important'); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ 100%
    // –£–±–∏—Ä–∞–µ–º –Ω–∏–∂–Ω–∏–π padding —É –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º padding —è–≤–Ω–æ: –≤–µ—Ä—Ö –∏ –±–æ–∫–æ–≤—ã–µ –∫–∞–∫ –≤ CSS (28px 40px), –Ω–∏–∑ 0
    howWeWorkCard.style.setProperty('padding', '28px 40px 0', 'important'); // –ë–µ–∑ –Ω–∏–∂–Ω–µ–≥–æ padding —É –∫–∞—Ä—Ç–æ—á–∫–∏ - —Ç–µ–∫—Å—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –±—É–¥–µ—Ç —É —Å–∞–º–æ–≥–æ –∫—Ä–∞—è
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    const title = document.createElement('h2');
    title.className = 'kp-spec-title';
    title.textContent = '–ö–ê–ö –ú–´ –†–ê–ë–û–¢–ê–ï–ú?';
    howWeWorkCard.appendChild(title);
      
    // –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
    const subtitle = document.createElement('p');
    subtitle.className = 'kp-spec-subtitle';
    subtitle.textContent = '–° –Ω–∞–º–∏ —Å–ø–æ–∫–æ–π–Ω–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ.';
    howWeWorkCard.appendChild(subtitle);
    
    // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø
    const howWeWorkGroups = document.createElement('div');
    howWeWorkGroups.className = 'kp-spec-groups';
    
    // –ë–ª–æ–∫ "–°—Ä–æ–∫–∏"
    const srokiGroup = document.createElement('div');
    srokiGroup.className = 'kp-spec-group';
    const srokiTitle = document.createElement('h3');
    srokiTitle.className = 'kp-spec-group-title';
    srokiTitle.textContent = '–°—Ä–æ–∫–∏';
    srokiGroup.appendChild(srokiTitle);
    const srokiList = document.createElement('ul');
    srokiList.className = 'kp-spec-list';
    srokiList.innerHTML = `<li>–°—Ä–æ–∫ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è: 1 –¥–µ–Ω—å</li><li>–ú–æ–Ω—Ç–∞–∂ –Ω–∞ —É—á–∞—Å—Ç–∫–µ: ${montageDaysText}</li>`;
    srokiGroup.appendChild(srokiList);
    howWeWorkGroups.appendChild(srokiGroup);
    
    // –ë–ª–æ–∫ "–û–ø–ª–∞—Ç–∞"
    const oplataGroup = document.createElement('div');
    oplataGroup.className = 'kp-spec-group';
    const oplataTitle = document.createElement('h3');
    oplataTitle.className = 'kp-spec-group-title';
    oplataTitle.textContent = '–û–ø–ª–∞—Ç–∞';
    oplataGroup.appendChild(oplataTitle);
    const oplataList = document.createElement('ul');
    oplataList.className = 'kp-spec-list';
    oplataList.innerHTML = '<li>–ë–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã ‚Äî –æ–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É</li><li>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏</li>';
    oplataGroup.appendChild(oplataList);
    howWeWorkGroups.appendChild(oplataGroup);
    
    // –ë–ª–æ–∫ "–ì–∞—Ä–∞–Ω—Ç–∏—è"
    const garantiaGroup = document.createElement('div');
    garantiaGroup.className = 'kp-spec-group';
    const garantiaTitle = document.createElement('h3');
    garantiaTitle.className = 'kp-spec-group-title';
    garantiaTitle.textContent = '–ì–∞—Ä–∞–Ω—Ç–∏—è';
    garantiaGroup.appendChild(garantiaTitle);
    const garantiaList = document.createElement('ul');
    garantiaList.className = 'kp-spec-list';
    garantiaList.innerHTML = '<li>–ì–∞—Ä–∞–Ω—Ç–∏—è 2 –≥–æ–¥–∞ –Ω–∞ –º–æ–Ω—Ç–∞–∂ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</li>';
    garantiaGroup.appendChild(garantiaList);
    howWeWorkGroups.appendChild(garantiaGroup);
    
    // –ë–ª–æ–∫ "–ü–æ—á–µ–º—É —Å –Ω–∞–º–∏ —Å–ø–æ–∫–æ–π–Ω–æ"
    const pochemuGroup = document.createElement('div');
    pochemuGroup.className = 'kp-spec-group';
    const pochemuTitle = document.createElement('h3');
    pochemuTitle.className = 'kp-spec-group-title';
    pochemuTitle.textContent = '–ü–æ—á–µ–º—É —Å –Ω–∞–º–∏ —Å–ø–æ–∫–æ–π–Ω–æ';
    pochemuGroup.appendChild(pochemuTitle);
    const pochemuList = document.createElement('ul');
    pochemuList.className = 'kp-spec-list';
    pochemuList.innerHTML = `
      <li>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –±–æ–ª–µ–µ 10 –ª–µ—Ç</li>
      <li>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –±—Ä–∏–≥–∞–¥—ã, –±–µ–∑ —Å–ª—É—á–∞–π–Ω—ã—Ö —à–∞–±–∞—à–Ω–∏–∫–æ–≤</li>
      <li>–•–≤–æ–π–Ω—ã–π –ª–µ—Å, –º–∞—Ç–µ—Ä–∏–∞–ª—ã 1 —Å–æ—Ä—Ç–∞ –±–µ–∑ –æ–±–∑–æ–ª–∞</li>
      <li>–í–∞–≥–æ–Ω–∫–∞ –∏ –∏–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ –±–µ–∑ –≥–Ω–∏–ª–∏ ‚Äî –æ—Ç–±–∏—Ä–∞–µ–º –≤—Ä—É—á–Ω—É—é</li>
      <li>–£—Ç–µ–ø–ª–µ–Ω–∏–µ —Å –ø–∞—Ä–æ- –∏ –≤–µ—Ç—Ä–æ–∑–∞—â–∏—Ç–æ–π ‚Äî –Ω–µ —ç–∫–æ–Ω–æ–º–∏–º –Ω–∞ —Å–∫—Ä—ã—Ç—ã—Ö —Å–ª–æ—è—Ö</li>
      <li>–¶–µ–Ω–∞ –Ω–∏–∂–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏ —Ç–æ–º –∂–µ –Ω–∞–±–æ—Ä–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</li>
    `;
    pochemuGroup.appendChild(pochemuList);
    howWeWorkGroups.appendChild(pochemuGroup);
    
    // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º padding-bottom –≥—Ä—É–ø–ø–∞–º - –∫–æ–Ω—Ç–∞–∫—Ç—ã –±—É–¥—É—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω—ã
    howWeWorkCard.appendChild(howWeWorkGroups);
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏ - –≤–Ω—É—Ç—Ä–∏ –±–µ–ª–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏, –≤ —Å–∞–º–æ–º –Ω–∏–∑—É, —É –∫—Ä–∞—è, —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º –∫–∞–∫ —Å–ª–æ–≥–∞–Ω—ã
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä—è–º–æ —É –∫—Ä–∞—è –±–µ–ª–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
    const companyInfoDiv = document.createElement('div');
    companyInfoDiv.className = 'company-info';
    companyInfoDiv.style.position = 'absolute'; // –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞—Ä—Ç–æ—á–∫–∏
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π bottom –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —É –∫—Ä–∞—è
    // –û–ø—É—Å–∫–∞–µ–º –≤ 3 —Ä–∞–∑–∞ –Ω–∏–∂–µ: –±—ã–ª–æ -20px, —Ç–µ–ø–µ—Ä—å -60px
    companyInfoDiv.style.bottom = '-60px'; // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –±—ã–ª —É –∫—Ä–∞—è –∫–∞—Ä—Ç–æ—á–∫–∏ (–≤ 3 —Ä–∞–∑–∞ –Ω–∏–∂–µ)
    companyInfoDiv.style.transform = 'none'; // –£–±–∏—Ä–∞–µ–º transform, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ bottom
    companyInfoDiv.style.marginBottom = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É
    companyInfoDiv.style.left = '40px'; // –û—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –∫–∞–∫ —É padding –∫–∞—Ä—Ç–æ—á–∫–∏
    companyInfoDiv.style.right = '40px'; // –û—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞ –∫–∞–∫ —É padding –∫–∞—Ä—Ç–æ—á–∫–∏
    companyInfoDiv.style.textAlign = 'center';
    companyInfoDiv.style.borderTop = '1px solid #e5e7eb'; // –õ–µ–≥–∫–∞—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
    companyInfoDiv.style.paddingTop = '20px'; // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –æ—Ç –ª–∏–Ω–∏–∏
    companyInfoDiv.style.paddingBottom = '0px';
    companyInfoDiv.style.marginBottom = '0px';
    companyInfoDiv.style.marginTop = '0px';
    companyInfoDiv.style.height = 'auto'; // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞
    companyInfoDiv.style.backgroundColor = '#fff'; // –ë–µ–ª—ã–π —Ñ–æ–Ω
    companyInfoDiv.style.zIndex = '10'; // –ü–æ–≤–µ—Ä—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π margin-bottom —É —Ç–µ–∫—Å—Ç–∞, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª —Ç–æ—á–Ω–æ —É –∫—Ä–∞—è
    companyInfoDiv.style.boxSizing = 'border-box'; // –ß—Ç–æ–±—ã padding —É—á–∏—Ç—ã–≤–∞–ª—Å—è
    
    const companyInfoText = document.createElement('div');
    companyInfoText.style.fontSize = '13px'; // –†–∞–∑–º–µ—Ä –∫–∞–∫ —É –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞
    companyInfoText.style.fontWeight = '400';
    companyInfoText.style.color = '#8A8A8A'; // –°–µ—Ä—ã–π —Ü–≤–µ—Ç –∫–∞–∫ —É —Å–ª–æ–≥–∞–Ω–æ–≤ (–∫–∞–∫ .kp-spec-subtitle)
    companyInfoText.style.letterSpacing = '0.02em';
    companyInfoText.style.lineHeight = '1'; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π line-height - –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    companyInfoText.style.whiteSpace = 'nowrap'; // –í –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
    companyInfoText.style.marginBottom = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É
    companyInfoText.style.paddingBottom = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É
    companyInfoText.style.marginTop = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–≤–µ—Ä—Ö—É
    companyInfoText.style.paddingTop = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–≤–µ—Ä—Ö—É
    companyInfoText.style.display = 'block'; // –ë–ª–æ—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º transform –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤–Ω–∏–∑ - —Å–¥–≤–∏–≥–∞–µ–º –Ω–∞ padding-top –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (20px)
    // —á—Ç–æ–±—ã —Å–∞–º —Ç–µ–∫—Å—Ç –±—ã–ª —É –∫—Ä–∞—è –∫–∞—Ä—Ç–æ—á–∫–∏
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –±—ã–ª —Ç–æ—á–Ω–æ —É –∫—Ä–∞—è
    // –£–±–∏—Ä–∞–µ–º transform —É —Ç–µ–∫—Å—Ç–∞, —Ç–∞–∫ –∫–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è
    companyInfoText.style.marginTop = '0px'; // –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ —Å–≤–µ—Ä—Ö—É
    companyInfoText.style.transform = 'none'; // –ë–µ–∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∞–º —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è
    // –¢–µ–ª–µ—Ñ–æ–Ω –∏ —Å–∞–π—Ç —Ç–æ–∂–µ —Å–µ—Ä—ã–º, –Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á—É—Ç—å —Ç–µ–º–Ω–µ–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
    companyInfoText.innerHTML = '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è <span style="color: #8A8A8A; font-weight: 500;">+7 (495) 132-38-30</span> ¬∑ <span style="color: #8A8A8A; font-weight: 500;">resdoma.ru</span>';
    companyInfoDiv.appendChild(companyInfoText);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ –≤ –∫–æ–Ω–µ—Ü –±–µ–ª–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
    howWeWorkCard.appendChild(companyInfoDiv);
    
    // –û–±–µ—Ä—Ç—ã–≤–∞–µ–º –≤ page-section (–∫–∞–∫ –≤ –±–ª–æ–∫–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
    const howWeWorkSection = document.createElement('div');
    howWeWorkSection.className = 'page-section';
    howWeWorkSection.style.flexShrink = '0'; // –ù–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è
    howWeWorkSection.style.flex = '1'; // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤—ã—Å–æ—Ç—É
    howWeWorkSection.style.display = 'flex'; // Flex –¥–ª—è —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
    howWeWorkSection.style.flexDirection = 'column'; // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    howWeWorkSection.style.minHeight = '100%'; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ 100% –¥–ª—è —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è
    howWeWorkSection.appendChild(howWeWorkCard);
    
    howWeWorkPageInner.appendChild(howWeWorkSection);
    
    // –ü–æ–¥–≤–∞–ª (—Ç—ë–º–Ω–æ-—Å–∏–Ω—è—è –∑–æ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã) - –±–æ–ª—å—à–∞—è –±–µ–ª–∞—è –Ω–∞–¥–ø–∏—Å—å (–í–ù–ï .kp-page-inner, –≤–Ω—É—Ç—Ä–∏ .kp-page)
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é –≤ .kp-page, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –≤ —Ç–µ–º–Ω–æ-—Å–∏–Ω–µ–π –∑–æ–Ω–µ
    // –ë–µ–ª–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 75px –æ—Ç –Ω–∏–∑–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // –û–ø—É—Å–∫–∞–µ–º –Ω–∞–¥–ø–∏—Å—å –Ω–∏–∂–µ, –ø–æ—á—Ç–∏ –∫ –∫—Ä–∞—é, –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–≥–æ –≤–∏–¥–∞
    const footerDiv = document.createElement('div');
    footerDiv.className = 'kp-footer footer';
    footerDiv.style.position = 'absolute'; // –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ .kp-page
    // –ü–æ–¥–Ω–∏–º–∞–µ–º –Ω–∞–¥–ø–∏—Å—å –µ—â–µ –Ω–∞ 7px –≤—ã—à–µ
    // –ë—ã–ª–æ bottom: -23px, –ø–æ–¥–Ω–∏–º–∞–µ–º –Ω–∞ 7px: -23px + 7px = -16px
    footerDiv.style.bottom = '-16px'; // –ü–æ–¥–Ω—è–ª–∏ –µ—â–µ –Ω–∞ 7px –≤—ã—à–µ
    footerDiv.style.left = '0';
    footerDiv.style.right = '0';
    footerDiv.style.paddingTop = '0';
    footerDiv.style.paddingBottom = '0';
    footerDiv.style.textAlign = 'center';
    footerDiv.style.width = '100%';
    footerDiv.style.zIndex = '1';
    // –§–æ–Ω –Ω–µ –Ω—É–∂–µ–Ω, —Ç.–∫. —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–∂–µ —Ç–µ–º–Ω–æ-—Å–∏–Ω—è—è (#111827)
    
    // –ë–µ–ª–∞—è –Ω–∞–¥–ø–∏—Å—å - –∫—Ä–∞—Å–∏–≤–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑—É —Ç–µ–º–Ω–æ-—Å–∏–Ω–µ–π –∑–æ–Ω—ã, –∫–∞–ø—Å–æ–º
    const footerText = document.createElement('div');
    footerText.style.fontSize = '36px'; // –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
    footerText.style.fontWeight = '700';
    footerText.style.color = '#ffffff';
    footerText.style.letterSpacing = '0.05em'; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–µ–∂–±—É–∫–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
    footerText.style.lineHeight = '1.3';
    footerText.style.textShadow = 'none';
    footerText.style.textTransform = 'uppercase'; // –ö–∞–ø—Å–æ–º
    footerText.style.whiteSpace = 'nowrap'; // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫
    footerText.style.opacity = '0.95'; // –õ–µ–≥–∫–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç–∏
    footerText.textContent = '–î–∞–≤–∞–π—Ç–µ —Å—Ç—Ä–æ–∏—Ç—å –≤–º–µ—Å—Ç–µ üíõ';
    footerDiv.appendChild(footerText);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–≤–∞–ª –Ω–∞–ø—Ä—è–º—É—é –≤ .kp-page (–≤ —Ç–µ–º–Ω–æ-—Å–∏–Ω—é—é –∑–æ–Ω—É), –∞ –Ω–µ –≤ .kp-page-inner
    howWeWorkPage.appendChild(footerDiv);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    kpRoot.appendChild(howWeWorkPage);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ DOM
    document.body.appendChild(kpRoot);
    
    await new Promise(resolve => setTimeout(resolve, 300));
    
    // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç–¥–µ–ª—å–Ω–æ
    const pages = kpRoot.querySelectorAll('.kp-page');
    
    if (pages.length === 0) {
      console.error('–û–®–ò–ë–ö–ê: –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞!');
      throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PDF');
    }
    
    for (let i = 0; i < pages.length; i++) {
      const page = pages[i];
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const backgroundColor = getComputedStyle(page).backgroundColor || '#111827';
      
      // –î–ª—è –æ–±–ª–æ–∂–∫–∏ –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ–ª—å–∫–æ —Å–∞–π—Ç–∞ (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å),
      // —á—Ç–æ–±—ã –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ PDF –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
      let siteBox = null;
      if (page.classList.contains('kp-page--cover')) {
        const siteEl = page.querySelector('.kp-manager-site');
        if (siteEl) {
          const pageRect = page.getBoundingClientRect();
          const rect = siteEl.getBoundingClientRect();
          siteBox = {
            x: rect.left - pageRect.left,
            y: rect.top - pageRect.top,
            w: rect.width,
            h: rect.height
          };
        }
      }
      
      let canvas;
      try {
        canvas = await html2canvas(page, {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        logging: false,
        backgroundColor: backgroundColor,
        width: page.scrollWidth,
        height: page.scrollHeight,
        // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π onclone - –Ω–µ —Ç—Ä–æ–≥–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ —Å—Ç–∏–ª–∏, –æ–Ω–∏ —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ DOM
        onclone: (clonedDoc) => {
          // –ú–∞–∫—Å–∏–º—É–º - –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
          // –í—Å–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏ —à—Ä–∏—Ñ—Ç–æ–º –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ DOM (CSS) + normalizeSpaces
        }
      });
      } catch (canvasError) {
        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${i + 1}:`, canvasError);
        throw new Error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${i + 1}: ${canvasError.message || canvasError}`);
      }
      
      const imgData = canvas.toDataURL('image/jpeg', 0.95);
      
      if (i > 0) {
        pdf.addPage();
      }
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è PDF
      const imgWidth = pdfWidth;
      const imgHeight = (canvas.height * pdfWidth) / canvas.width;
      
      pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –ø–æ —Å–∞–π—Ç—É –Ω–∞ –æ–±–ª–æ–∂–∫–µ
      if (page.classList.contains('kp-page--cover') && siteBox) {
        const mmPerCssPx = pdfWidth / page.scrollWidth; // –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –º–∞—Å—à—Ç–∞–± –ø–æ X/Y
        const linkX = siteBox.x * mmPerCssPx;
        const linkY = siteBox.y * mmPerCssPx;
        const linkW = siteBox.w * mmPerCssPx;
        const linkH = siteBox.h * mmPerCssPx;
        try {
          pdf.link(linkX, linkY, linkW, linkH, { url: 'https://resdoma.ru' });
        } catch (e) {
          console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –≤ PDF:', e);
        }
      }
    }
    
    document.body.removeChild(kpRoot);
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
    const now = new Date();
    const dateStr = now.toLocaleDateString('ru-RU', { 
      day: '2-digit', 
      month: '2-digit', 
      year: 'numeric' 
    });
    const titleLine = kpLines.find(line => line.includes('–ø–æ–¥ –∫–ª—é—á') || line.includes('‚Äî'));
    let fileName = '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ_–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ';
    if (titleLine) {
      const match = titleLine.match(/(\d+[√óx]\d+)/);
      if (match) {
        fileName = `–ö–ü_${match[1]}_${dateStr.replace(/\./g, '_')}`;
      }
    }
    // –°–æ–∑–¥–∞–µ–º blob URL –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
    const pdfBlob = pdf.output('blob');
    const pdfUrl = URL.createObjectURL(pdfBlob);
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º PDF –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–±–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)
    const previewWindow = window.open(pdfUrl, '_blank');
    if (previewWindow) {
      previewWindow.focus();
    } else {
      console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å PDF –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ (–≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω popup)');
      alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å PDF. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.');
    }
    // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –±—Ä–∞—É–∑–µ—Ä–µ
    // pdf.save(fileName + '.pdf');
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
    if (btnPDF) {
      btnPDF.disabled = false;
      btnPDF.textContent = originalText;
    }
    
    // –û—á–∏—â–∞–µ–º blob URL —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –ø–∞–º—è—Ç—å)
    setTimeout(() => {
      URL.revokeObjectURL(pdfUrl);
    }, 300000);
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    window.__pdfGenerating = false;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF:', error);
    console.error('–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error.stack);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    let errorMessage = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF. ';
    if (error.message) {
      errorMessage += error.message;
    } else {
      errorMessage += '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5).';
    }
    alert(errorMessage);
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
    if (btnPDF) {
      btnPDF.disabled = false;
      btnPDF.textContent = originalText;
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    window.__pdfGenerating = false;
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF
(function() {
  function attachHandler() {
  const btnPDF = document.getElementById("btnPDF");
    if (!btnPDF) {
      console.warn('–ö–Ω–æ–ø–∫–∞ btnPDF –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞...');
      setTimeout(attachHandler, 100);
      return;
    }
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    const newBtn = btnPDF.cloneNode(true);
    btnPDF.parentNode.replaceChild(newBtn, btnPDF);
    
    newBtn.addEventListener("click", function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      if (typeof generatePDF !== 'function') {
        console.error('–§—É–Ω–∫—Ü–∏—è generatePDF –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞!');
        alert('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        return;
      }
      try {
        generatePDF().catch(err => {
          console.error('–û—à–∏–±–∫–∞ –≤ generatePDF:', err);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF: ' + (err.message || err));
        });
      } catch (err) {
        console.error('–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ generatePDF:', err);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ PDF: ' + (err.message || err));
      }
    });
  }
  
  // –ü—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', attachHandler);
  } else {
    attachHandler();
  }
})();
/* ------------------------------------------------------------------
   9. –£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∞–Ω–¥
------------------------------------------------------------------ */
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª–∏–Ω –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —à–∏—Ä–∏–Ω—ã
function updateAvailableLengths() {
  const type = selType.value;
  const cfg = CONFIG[type];
  
  if (!cfg.isEconomy) return;
  
  const selectedWidth = inpWidth.value;
  if (!selectedWidth) return;
  
  // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –¥–ª–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —à–∏—Ä–∏–Ω–æ–π
  const availableLengths = [...new Set(
    Object.keys(cfg.basePrice)
      .filter(key => key.startsWith(selectedWidth + 'x'))
      .map(key => key.split('x')[1])
  )].sort((a, b) => parseFloat(a) - parseFloat(b));
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –¥–ª–∏–Ω—É
  const currentLength = inpLength.value;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–ø–∞–¥–∞—à–∫—É –¥–ª–∏–Ω –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º
  inpLength.innerHTML = availableLengths.map(l => `<option>${l}</option>`).join("");
  inpLength.disabled = false;
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
  if (availableLengths.includes(currentLength)) {
    inpLength.value = currentLength;
  } else {
    inpLength.value = availableLengths[0];
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä–∞–Ω–¥—ã –∏ —Å–≤–∞–∏
  updateVerandaOptions();
  if (cfg.isEconomy) {
    updateSvaiRecommendation();
  }
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–µ—Ä–∞–Ω–¥ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º
function findMatchingVerandas(width, length, type) {
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–µ—Ä–∞–Ω–¥
  let verandaType;
  if (type === 'hoblok' || type === 'hoblok_economy') {
    verandaType = 'hoblok';
  } else if (type === 'bytovka' || type === 'bytovka_economy') {
    verandaType = 'bytovka';
  } else {
    return []; // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –≤–µ—Ä–∞–Ω–¥ –Ω–µ—Ç
  }
  
  const availableVerandas = VERANDA_CONFIG[verandaType] || {};
  const matches = [];
  
  // –ò—â–µ–º –≤–µ—Ä–∞–Ω–¥—ã, –≥–¥–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º
  for (const [key, config] of Object.entries(availableVerandas)) {
    const [mainW, mainL] = config.main.split('x').map(Number);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ —Ä–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è
    if (mainW === width && mainL === length) {
      matches.push({
        key: key,
        main: config.main,
        veranda: config.veranda,
        price: config.price,
        description: `${config.main} + –≤–µ—Ä–∞–Ω–¥–∞ ${config.veranda}`
      });
    }
  }
  
  return matches;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤–µ—Ä–∞–Ω–¥
function updateVerandaOptions() {
  const type = selType.value;
  const width = parseFloat(inpWidth.value) || 0;
  const length = parseFloat(inpLength.value) || 0;
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –≤–µ—Ä–∞–Ω–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è —ç–∫–æ–Ω–æ–º-–ª–∏–Ω–µ–π–∫–∏
  const verandaBlock = document.querySelector('.veranda-block');
  
  if (verandaBlock) {
    if (type === 'hoblok_economy' || type === 'bytovka_economy') {
      verandaBlock.style.display = 'block';
    } else {
      verandaBlock.style.display = 'none';
      return;
    }
  } else {
    return;
  }
  
  // –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –≤–µ—Ä–∞–Ω–¥—ã
  const matches = findMatchingVerandas(width, length, type);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç –≤–µ—Ä–∞–Ω–¥
  const verandaSelect = document.getElementById('selVeranda');
  
  if (verandaSelect) {
    verandaSelect.innerHTML = '<option value="">‚Äî –±–µ–∑ –≤–µ—Ä–∞–Ω–¥—ã ‚Äî</option>';
    
    if (matches.length > 0) {
      matches.forEach(match => {
        const option = document.createElement('option');
        option.value = match.key;
        const priceRounded = Math.round(match.price / 50) * 50; // —Ç–æ–ª—å–∫–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ (—Ü–µ–Ω–∞ —É–∂–µ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π 10%)
        // –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
        option.textContent = `${match.main} + ${match.veranda} ‚Äî ${formatPrice(priceRounded)} ‚ÇΩ`;
        verandaSelect.appendChild(option);
      });
    } else {
      const option = document.createElement('option');
      option.value = "";
      option.textContent = "–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–µ—Ä–∞–Ω–¥ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞";
      option.disabled = true;
      verandaSelect.appendChild(option);
    }
  }
}

/* ------------------------------------------------------------------
   10. –ì–µ–æ–∫–æ–¥–µ—Ä + –º–∞—Ä—à—Ä—É—Ç
------------------------------------------------------------------ */
async function getKm(address, isEconomy = false){
  try{
    if (typeof ymaps === 'undefined') {
      console.warn("–ö–∞—Ä—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
      return null;
    }
    
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–º–∏—Ç–æ–≤ API
    const now = Date.now();
    if (now - lastRequestTime < 60000) { // –º–µ–Ω—å—à–µ –º–∏–Ω—É—Ç—ã
      if (requestCount >= MAX_REQUESTS_PER_MINUTE) {
        console.warn("–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
        return null;
      }
    } else {
      requestCount = 0; // —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    const cacheKey = `${address}_${isEconomy}`;
    const cached = routeCache.get(cacheKey);
    if (cached && (now - cached.timestamp) < CACHE_EXPIRY) {
      displayCachedRoute(cached.route, cached.depot, cached.coords, address);
      // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
      const kmInfo = document.getElementById('kmInfo');
      if (kmInfo) {
        kmInfo.textContent = cached.km.toFixed(1).replace('.', ',') + ' –∫–º';
      }
      return cached.km;
    }
    
    requestCount++;
    lastRequestTime = now;
    
    // 1. –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞
    const res   = await ymaps.geocode(address,{results:1});
    const obj   = res.geoObjects.get(0);
    if(!obj){ alert("–ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"); return null; }

    const coords = obj.geometry.getCoordinates();   // —Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

    // 2. –í—ã–±–∏—Ä–∞–µ–º –±–∞–∑—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å—Ç—Ä–æ–µ–Ω–∏—è
    const depot = isEconomy ? DEPOT_ECONOMY : DEPOT;
    
    // 3. –°—Ç—Ä–æ–∏–º –º–∞—Ä—à—Ä—É—Ç ¬´–±–∞–∑–∞ ‚Üí –∫–ª–∏–µ–Ω—Ç¬ª
    // –û–±—Ö–æ–¥–∏–º –ø–ª–∞—Ç–Ω—ã–µ –¥–æ—Ä–æ–≥–∏ –∏ –ú–æ—Å–∫–≤—É (–µ–¥–µ–º –ø–æ –ú–ö–ê–î)
    const route = await ymaps.route([depot, coords], { 
      avoidTolls: true,        // –æ–±—Ö–æ–¥ –ø–ª–∞—Ç–Ω—ã—Ö –¥–æ—Ä–æ–≥
      avoidTraffic: true,      // –æ–±—Ö–æ–¥ –ø—Ä–æ–±–æ–∫
      avoidHighways: false     // —Ä–∞–∑—Ä–µ—à–∞–µ–º –ú–ö–ê–î
    });

    // 3. –î–ª–∏–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –≤ –∫–º
    const km = route.getLength() / 1000;

    // 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
    if (routeCache.size >= MAX_CACHE_SIZE) {
      // –£–¥–∞–ª—è–µ–º —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π —ç–ª–µ–º–µ–Ω—Ç
      const firstKey = routeCache.keys().next().value;
      routeCache.delete(firstKey);
    }
    
    routeCache.set(cacheKey, {
      route: route,
      depot: depot,
      coords: coords,
      km: km,
      timestamp: now
    });

    // 5. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–∞—Ä—à—Ä—É—Ç –Ω–∞ –∫–∞—Ä—Ç–µ
    displayRouteOnMap(route, depot, coords, address, isEconomy);

    // 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥ –ø–æ–ª–µ–º –∞–¥—Ä–µ—Å–∞
    const kmInfo = document.getElementById('kmInfo');
    if (kmInfo) {
      kmInfo.textContent = km.toFixed(1).replace('.', ',') + ' –∫–º';
    } else {
      console.error('–≠–ª–µ–º–µ–Ω—Ç kmInfo –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    }

    // 7. –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–∞
    createMapLink(coords, address);
 
    // 7. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–æ—Å—Ç–∞–≤–∫—É —Å –Ω–æ–≤—ã–º –∫–∏–ª–æ–º–µ—Ç—Ä–∞–∂–µ–º
    // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º calculate() –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
    // calculate() —É–∂–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω –ø–µ—Ä–µ–¥ getKm()
 
    // 8. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∏–ª–æ–º–µ—Ç—Ä–∞–∂
    return km;
  }catch(e){
    console.error("–û—à–∏–±–∫–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç:", e);
  return null;
}
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
function displayRouteOnMap(route, depot, coords, address, isEconomy) {
  try {
    
    // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç —Å —Ç–æ—á–∫–∞–º–∏
    map.geoObjects.removeAll();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç –Ω–∞ –∫–∞—Ä—Ç—É
    if (route) {
      map.geoObjects.add(route);
    } else {
      console.warn("–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");
    }
  
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –ê (–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ)
    const depotMarker = new ymaps.Placemark(depot, {
      balloonContent: isEconomy ? '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —ç–∫–æ–Ω–æ–º-—Å—Ç—Ä–æ–µ–Ω–∏–π' : '–û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞',
      iconCaption: isEconomy ? '–ê (–≠–∫–æ–Ω–æ–º)' : '–ê (–°—Ç–∞–Ω–¥–∞—Ä—Ç)'
    }, {
      preset: 'islands#redCircleDotIcon',
      iconColor: '#ff0000'
    });
    map.geoObjects.add(depotMarker);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –ë (–∫–ª–∏–µ–Ω—Ç)
    const clientMarker = new ymaps.Placemark(coords, {
      balloonContent: `–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏: ${address}`,
      iconCaption: '–ë (–ö–ª–∏–µ–Ω—Ç)'
    }, {
      preset: 'islands#blueCircleDotIcon',
      iconColor: '#0066cc'
    });
    map.geoObjects.add(clientMarker);
  
  // –ü–æ–¥–≥–æ–Ω—è–µ–º –∫–∞—Ä—Ç—É –∫ –º–∞—Ä—à—Ä—É—Ç—É
  try {
    if (route.getBounds && typeof route.getBounds === 'function') {
      map.setBounds(route.getBounds(), { checkZoomRange: true });
    } else {
      // –ï—Å–ª–∏ getBounds –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–µ–∫
      const bounds = [[Math.min(depot[0], coords[0]), Math.min(depot[1], coords[1])], 
                      [Math.max(depot[0], coords[0]), Math.max(depot[1], coords[1])]];
      map.setBounds(bounds, { checkZoomRange: true });
    }
  } catch (error) {
    console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–≥–Ω–∞—Ç—å –∫–∞—Ä—Ç—É –∫ –º–∞—Ä—à—Ä—É—Ç—É:", error);
  }
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞:", error);
  }
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
function displayCachedRoute(route, depot, coords, address) {
  displayRouteOnMap(route, depot, coords, address, depot === DEPOT_ECONOMY);
  // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–∞
  createMapLink(coords, address);
  // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º calculate() –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
}

// –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
function createMapLink(coords, address) {
  const mapLink = document.getElementById('mapLink');
  const kmSep = document.getElementById('kmSep');
  
  if (mapLink && kmSep && coords) {
    // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const lat = coords[0];
    const lon = coords[1];
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö: mode=whatshere —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —Ç–æ—á–∫–∏
    const mapUrl = `https://yandex.ru/maps/213/moscow/?ll=${lon},${lat}&mode=whatshere&whatshere%5Bpoint%5D=${lon},${lat}&whatshere%5Bzoom%5D=10&z=10`;
    
    mapLink.href = mapUrl;
    mapLink.textContent = 'üìç –ê–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ';
    mapLink.title = `–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–æ ${address}`;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏ —Å—Å—ã–ª–∫—É
    kmSep.style.display = 'inline';
    mapLink.style.display = 'inline';
    
  }
}

  // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function resetFilters() {
  selType.value = "house";
  handleTypeChange();
  inpAddr.value = "";
  out.textContent = "";
  map.geoObjects.removeAll();
  document.getElementById('kmInfo').textContent = '‚Äî'; 
  windowsContainer.innerHTML = "";
}

// –°–±—Ä–æ—Å —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞ –∏ –º–∞—Ä—à—Ä—É—Ç–∞
function clearDelivery() {
  inpAddr.value = "";
  map.geoObjects.removeAll();
  document.getElementById('kmInfo').textContent = '‚Äî';
  document.getElementById('mapLink').style.display = 'none';
  document.getElementById('kmSep').style.display   = 'none';
  document.getElementById('mapLink').removeAttribute('href');
  document.getElementById('mapLink').textContent = '';
  
  // –û—á–∏—â–∞–µ–º –∫—ç—à –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ
  routeCache.clear();
}


}
